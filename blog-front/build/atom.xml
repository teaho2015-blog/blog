<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.teaho.net/</id>
    <title>teaho2015</title>
    <updated>2024-12-08T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://blog.teaho.net/"/>
    <subtitle>Tea's Blog Blog</subtitle>
    <icon>https://blog.teaho.net/img/logo.png</icon>
    <rights>Copyright © 2025 teaho2015 Built with Docusaurus.</rights>
    <entry>
        <title type="html"><![CDATA[茅台2023财报速读]]></title>
        <id>https://blog.teaho.net/article/maotai2023sudu</id>
        <link href="https://blog.teaho.net/article/maotai2023sudu"/>
        <updated>2024-12-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[茅台2023财报速读]]></summary>
        <content type="html"><![CDATA[<p>结合以往看的财报知识，分析下茅台2023年财报。</p>
<br>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="资料来源">资料来源<a href="https://blog.teaho.net/article/maotai2023sudu#%E8%B5%84%E6%96%99%E6%9D%A5%E6%BA%90" class="hash-link" aria-label="Direct link to 资料来源" title="Direct link to 资料来源">​</a></h2>
<ul>
<li>巨潮资讯：<a href="http://www.cninfo.com.cn/" target="_blank" rel="noopener noreferrer">http://www.cninfo.com.cn/</a></li>
<li>官网</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="公司和行业现状体感">公司和行业现状体感<a href="https://blog.teaho.net/article/maotai2023sudu#%E5%85%AC%E5%8F%B8%E5%92%8C%E8%A1%8C%E4%B8%9A%E7%8E%B0%E7%8A%B6%E4%BD%93%E6%84%9F" class="hash-link" aria-label="Direct link to 公司和行业现状体感" title="Direct link to 公司和行业现状体感">​</a></h2>
<p>首先，白酒行业的利润应该都不错，我记忆中（以前哪个采访说到）净利润率50%以上，可算得上暴利。</p>
<p>其次，茅台如何制作呢？茅台酒一般经过：制曲、制酒、贮存、勾兑、检验、包装。
九次蒸煮、八次发酵、七次取酒。每轮次基酒会有不同风味。</p>
<p>茅台年分红有上升，且对比同行业（五粮液）高。</p>
<p>茅台股价近3年处于阴跌状态。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="综合阅读">综合阅读<a href="https://blog.teaho.net/article/maotai2023sudu#%E7%BB%BC%E5%90%88%E9%98%85%E8%AF%BB" class="hash-link" aria-label="Direct link to 综合阅读" title="Direct link to 综合阅读">​</a></h2>
<p>自己的投资理念(principle)。
基于如下分析：保守，容忍度低，倾向于清算价值估算法（我一般算每股清算价值）。看重管理能力下的现金流情况。</p>
<p>分五步骤看看。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="零重要事项提示和董事会分析">零、重要事项提示和董事会分析<a href="https://blog.teaho.net/article/maotai2023sudu#%E9%9B%B6%E9%87%8D%E8%A6%81%E4%BA%8B%E9%A1%B9%E6%8F%90%E7%A4%BA%E5%92%8C%E8%91%A3%E4%BA%8B%E4%BC%9A%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 零、重要事项提示和董事会分析" title="Direct link to 零、重要事项提示和董事会分析">​</a></h3>
<p>第2页，会计事务所出具的“标准无保留意见”的审计。ok可以继续往下看。<br>
<!-- -->重要提示没啥毛病。</p>
<p>看董事会报告：</p>
<p>首先，我看眼期末库存量上升了6%，销售额也上涨了。对比起来去库存周期没什么变化。</p>
<p>然后我翻查了董事会的行业趋势分析，看看管理者如何看优劣势和机会的。
我认为有点过于积极了(两页乐观，最后说风险20字谈及了宏观经济风险等)，尤其我翻阅对比2014年的茅台财报，个人认为缺少审慎和危机意识。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="一先看三大表各个科目有没异常">一、先看三大表，各个科目有没异常<a href="https://blog.teaho.net/article/maotai2023sudu#%E4%B8%80%E5%85%88%E7%9C%8B%E4%B8%89%E5%A4%A7%E8%A1%A8%E5%90%84%E4%B8%AA%E7%A7%91%E7%9B%AE%E6%9C%89%E6%B2%A1%E5%BC%82%E5%B8%B8" class="hash-link" aria-label="Direct link to 一、先看三大表，各个科目有没异常" title="Direct link to 一、先看三大表，各个科目有没异常">​</a></h3>
<p>简单说我的理解：</p>
<ul>
<li>资产负债表 反映企业财务状况。 看各类项目的漏洞：货币呀、经营资产、生产资产、投资资产等的情况。</li>
<li>利润表 反映企业近期的营业成果。 看收入、毛利率、净利率、费用率、营业利润率等情况。</li>
<li>现金流量表 反映展示企业筹资能力。反映一段时间内企业的偿还债务能力，反映是否能够健康经营。</li>
</ul>
<p>一般都是各类目翻看，然后google查。</p>
<p>资产负债表看四个要点：（从三个角度看，结构、历史、同行）</p>
<ul>
<li>生产资产/总资产</li>
<li>应收/总资产</li>
<li>货币资金/有息负债</li>
<li>非主业/总资产</li>
</ul>
<p>一般资产负债表要重点看（因为复式记账下明细多且搞外账和搞经历多个部门的凭证单据，搞起来成本大），
而利润表容易造假。现金流量表一般ERP软件是自动生成。</p>
<p>现金流量表的“经营现金流净额” / 利润表的“净利润” = 0.923，这个比值越大越稳定越好。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="二财务指标的分析">二、财务指标的分析<a href="https://blog.teaho.net/article/maotai2023sudu#%E4%BA%8C%E8%B4%A2%E5%8A%A1%E6%8C%87%E6%A0%87%E7%9A%84%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 二、财务指标的分析" title="Direct link to 二、财务指标的分析">​</a></h3>
<p>安全性指标：</p>
<ul>
<li>流动比率=流动资产/流动负债=4.6 &gt; 2</li>
<li>速动比率=速动资产/流动负债=4.6 &gt; 1</li>
<li>现金及现金等价物/有息负债=现金及现金等价物/(短期借款+一年内到期的非流动负债+长期借款+应付债券)=4463.24 &gt; 1</li>
</ul>
<p>可以看出比率比较高，流动资产没有充分使用。<br>
<!-- -->不得不说，茅台很少烧钱借钱。</p>
<p>营业能力指标：</p>
<ul>
<li>营业利润率=（营业收入-营业成本-三费）/营业收入<!-- -->
<ul>
<li>（147,693,604,994.14-11,867,273,851.78-4,648,613,585.82-9,729,389,252.31-157,371,873.01）/147,693,604,994.14 = 0.821233637</li>
</ul>
</li>
<li>净资产收益率=净利润/平均净资产= 64,786,396,951.58*2 /(171,584,366,864.08 + 161,880,997,981.23 - 14,681,509,236.35 - 13,214,280,942.48)<!-- -->
<ul>
<li>= 0.424</li>
<li>对比隔壁五粮液 = 0.394</li>
</ul>
</li>
</ul>
<p>ROE是衡量企业盈利能力的非常重要指标。（巴菲特钟爱这个指标）</p>
<p>成长性分析</p>
<ul>
<li>营业利润增长率=(本期营业利润-上期营业利润)/上期营业利润<!-- -->
<ul>
<li>= −0.0982</li>
</ul>
</li>
<li>净资产增长率=(本期净资产-上期净资产)/上期净资产<!-- -->
<ul>
<li>= 2.055</li>
</ul>
</li>
</ul>
<p>利润率同比去年有所降低，然后看起来茅台也降本增效了</p>
<p>管理层能力分析</p>
<ul>
<li>应收账款周转率=营业收入/平均应收账款 = 81,415,570,788.59/((17,178,545,925.65+20,670,923,010.62)/2) = 4.302<!-- -->
<ul>
<li>平均应收账款=(期初应收账款总额+期末应收账款总额)/2</li>
</ul>
</li>
<li>存货周转率=营业成本/存货平均余额 = 1.149<!-- -->
<ul>
<li>存货平均余额=（期初存货总额+期末存货总额）/2</li>
</ul>
</li>
<li>固定资产周转率=营业收入/固定资产净值 = 4.18</li>
</ul>
<p>这几个指标都是越大，说明管理者运作能力越好。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="三比对利润和现金流的变化趋势">三、比对利润和现金流的变化趋势<a href="https://blog.teaho.net/article/maotai2023sudu#%E4%B8%89%E6%AF%94%E5%AF%B9%E5%88%A9%E6%B6%A6%E5%92%8C%E7%8E%B0%E9%87%91%E6%B5%81%E7%9A%84%E5%8F%98%E5%8C%96%E8%B6%8B%E5%8A%BF" class="hash-link" aria-label="Direct link to 三、比对利润和现金流的变化趋势" title="Direct link to 三、比对利润和现金流的变化趋势">​</a></h3>
<p><img loading="lazy" alt="img_5.png" src="https://blog.teaho.net/assets/images/img_5-255cca95c260fe6ba2540ff8e32728fe.png" width="550" height="315" class="img_zKyM"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="四和竞争对手比一比">四、和竞争对手比一比<a href="https://blog.teaho.net/article/maotai2023sudu#%E5%9B%9B%E5%92%8C%E7%AB%9E%E4%BA%89%E5%AF%B9%E6%89%8B%E6%AF%94%E4%B8%80%E6%AF%94" class="hash-link" aria-label="Direct link to 四、和竞争对手比一比" title="Direct link to 四、和竞争对手比一比">​</a></h3>
<p>上面有对2023年五粮液财报的一些比对，这里略。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="总结">总结<a href="https://blog.teaho.net/article/maotai2023sudu#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>总体来看，贵州茅台2023年财报显示，尽管面临市场价格波动和行业竞争压力，公司依然实现了稳健增长。
年营收达到1505.6亿元，净利润775.2亿元，增速均超过18%。
值得注意的是，直销渠道收入显著增长，达到672亿元，占比接近50%。尽管净现比低于1，主要受高税费影响，但公司保持强劲的现金流和高毛利率（91.96%）。
整体来看，茅台在高端市场的地位依旧稳固，未来潜力仍然可观。我认为茅台的经营策略算是太保受了。</p>
<p>本文结合《手把手教你读财报》和一些理解写下，权当炒股的方法论。
再深入的话，可结合一些财务书籍和杜邦体系去做分析。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">Reference<a href="https://blog.teaho.net/article/maotai2023sudu#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2>
<p>[1]茅台2023年、2014年财报<br>
<!-- -->[2]<a href="https://baike.baidu.com/item/%E8%8C%85%E5%8F%B0%E9%85%92%E9%85%BF%E5%88%B6%E6%8A%80%E8%89%BA/3233042" target="_blank" rel="noopener noreferrer">茅台酒制作|百度百科</a><br>
<!-- -->[3]五粮液2023年财报<br>
<!-- -->[4]唐朝.手把手教你读财报.中国经济出版社</p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="finance" term="finance"/>
        <category label="statement" term="statement"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[欧洲旅游疑问集]]></title>
        <id>https://blog.teaho.net/article/europe</id>
        <link href="https://blog.teaho.net/article/europe"/>
        <updated>2024-11-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[欧洲建筑及时代风格和筷子的历史]]></summary>
        <content type="html"><![CDATA[<p>欧洲建筑及时代风格和筷子的历史。</p>
<p>前阵子去了欧洲法瑞意，去之前整理了欧洲建筑史和途径的在建筑史留下名字的建筑和艺术风格。<br>
回来后也顺带探讨了有别于其他地区，筷子成为中国主流餐具这一困扰我的问题。</p>
<br>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="前言">前言<a href="https://blog.teaho.net/article/europe#%E5%89%8D%E8%A8%80" class="hash-link" aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h2>
<p>该从哪个角度探讨欧洲建筑史呢？本人打算从时间线和时期去铺开。<br>
<!-- -->而对筷子的历史，我将从三个问题搜集资料，并从中试着回答为什么筷子最终登上舞台中央。
至于为何混搭两个不同的知识，后记我们再谈谈。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="途径的代表性建筑">途径的代表性建筑<a href="https://blog.teaho.net/article/europe#%E9%80%94%E5%BE%84%E7%9A%84%E4%BB%A3%E8%A1%A8%E6%80%A7%E5%BB%BA%E7%AD%91" class="hash-link" aria-label="Direct link to 途径的代表性建筑" title="Direct link to 途径的代表性建筑">​</a></h2>
<p>最终整理如图：
<img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/arch_history-894fddb7f0fa613f5299797ccf9acb5c.png" width="7724" height="1582" class="img_zKyM"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="总结">总结<a href="https://blog.teaho.net/article/europe#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h3>
<p>我途径的法意算是涵盖了建筑史上很多的代表性作品，在图片有标注一些风格特点。
需要说明，建筑风格并不按图中时间如此分界明显， 图中是列举它们的出现和繁盛时间。</p>
<p>一般分为古希腊时期、罗马时期、中世纪（哥特式、拜占庭式）、文艺复兴、巴洛克和洛可可风格、
18世纪的古典复兴、新艺术风格、现年的未来主义。因为一些建筑我没有途径或者现实较常见，
所以在图中没有提及一些重要分支：工艺风格、现代主义等。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="筷子成为主流的历史">筷子成为主流的历史<a href="https://blog.teaho.net/article/europe#%E7%AD%B7%E5%AD%90%E6%88%90%E4%B8%BA%E4%B8%BB%E6%B5%81%E7%9A%84%E5%8E%86%E5%8F%B2" class="hash-link" aria-label="Direct link to 筷子成为主流的历�史" title="Direct link to 筷子成为主流的历史">​</a></h2>
<p>搜集资料时，我重点关注回答这三个问题</p>
<ol>
<li>筷子餐具文化圈的分布范围。</li>
<li>筷子起源，据查最早出现时间。</li>
<li>为何成为餐具中的主流。</li>
</ol>
<p>首先当今三大饮食文化圈分别是：</p>
<ol>
<li>东亚的筷子取食圈 大致与儒家文化的影响范围相同。</li>
<li>欧美的刀叉取食圈 基本代表了西方基督教文明。</li>
<li>中东、南亚、东南亚的手指取食圈 主要受到伊斯兰教的影响。</li>
</ol>
<p>那么筷子最早有什么历史？
距今7000年前，挖掘出来的新石器时代的骨箸。为发掘的最早的筷子原型。</p>
<p>中国古人用手指取食，这一习俗延续到公元前5世纪或4世纪，也就是孔子很可能是用手进食的。我们至今仍称呼一个手指为食指。<br>
<!-- -->在中国作为饮食工具，匕勺（类似于勺子，略尖且凹的浅些）比筷子更早，且一段时间作为主流。而在1世纪左右，筷子不断挑战匕勺的主流地位，直到7世纪取而代之。<br>
<!-- -->注：韩国现在是勺加筷为主流。</p>
<p>锋利边缘的匕勺在唐代基本消失，取而代之是有弧度的勺箸。</p>
<p>筷子成为主流，我认为是饮食食物变化和文化演进的共同影响造成。</p>
<ol>
<li>饮食习惯：中国人喜热食，且崇尚“食不厌精”。
古代中国人最初用勺来取用谷物食品，从上古到唐代，主要粮食是小米，小米更常煮成粥，吃粥用勺子更方便，相比之下，用筷子拾取汤里的菜肴。
但后来，用小麦粉制成的食物越发受欢迎，比如面条、饺子、煎饼。自然更方便饮食的筷子成为主流。而南方因为食用稻米多些，所以这个转变据记载应该更早些。</li>
<li>儒家文化，认为刀等厨具不带进餐桌上更符合君子之风。</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="后记">后记<a href="https://blog.teaho.net/article/europe#%E5%90%8E%E8%AE%B0" class="hash-link" aria-label="Direct link to 后记" title="Direct link to 后记">​</a></h2>
<p>以往外出玩了解过木构建筑和园林的一些历史，这一次也选择本人感兴趣的建筑相关。</p>
<p>为什么会混搭一个筷子的问题呢？看到国外的刀叉，除了思念起美味的中餐。更勾起我起一个以往的问题。
马东说过：“中国人还在用筷子和汉语，文化组成结构就不变”。想着那就了解下为什么咱们是用筷子而不是刀叉吧。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">Reference<a href="https://blog.teaho.net/article/europe#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2>
<p>[1]密小斯.建筑也可以很好玩：欧洲篇：从古希腊到文艺复兴[M].中国:机械工业出版社<br>
<!-- -->[2]密小斯.建筑也可以很好玩：欧洲篇：从古典主义到近现代[M].中国:机械工业出版社<br>
<!-- -->[3]意大利风情<br>
<!-- -->[4]王晴佳.筷子：饮食与文化[M].中国:三联书店</p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="travel" term="travel"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[茶饮和酒饮的分类]]></title>
        <id>https://blog.teaho.net/article/tea-and-wink</id>
        <link href="https://blog.teaho.net/article/tea-and-wink"/>
        <updated>2024-06-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[茶饮和酒饮的分类]]></summary>
        <content type="html"><![CDATA[<p>最近自己有时调点鸡尾酒喝，翻看以前文档，发现15年大学那会好奇做过茶和酒的分类，这里整理重新发出来。</p>
<br>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="茶饮">茶饮<a href="https://blog.teaho.net/article/tea-and-wink#%E8%8C%B6%E9%A5%AE" class="hash-link" aria-label="Direct link to 茶饮" title="Direct link to 茶饮">​</a></h2>
<p><img loading="lazy" src="https://blog.teaho.net/assets/images/%E8%8C%B6-8271433ea6f0e5fa518716d1436c2b94.svg" width="1168" height="1776" class="img_zKyM"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="酒饮">酒饮<a href="https://blog.teaho.net/article/tea-and-wink#%E9%85%92%E9%A5%AE" class="hash-link" aria-label="Direct link to 酒饮" title="Direct link to 酒饮">​</a></h2>
<p><img loading="lazy" src="https://blog.teaho.net/assets/images/%E9%85%92%E7%B2%BE%E9%A5%AE%E6%96%99-a521a14a8df4ff57ebc70f01dddb6234.svg" width="1092" height="1702" class="img_zKyM"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="鸡尾酒">鸡尾酒<a href="https://blog.teaho.net/article/tea-and-wink#%E9%B8%A1%E5%B0%BE%E9%85%92" class="hash-link" aria-label="Direct link to 鸡尾酒" title="Direct link to 鸡尾酒">​</a></h2>
<p>自由古巴<br>
<!-- -->配方</p>
<ul>
<li>2.5份 朗姆酒</li>
<li>0.5份 柠檬汁</li>
<li>6份 可乐</li>
<li>冰块</li>
</ul>
<p>202311调，成品味道我挺喜欢。
<img loading="lazy" src="https://blog.teaho.net/assets/images/%E8%87%AA%E7%94%B1%E5%8F%A4%E5%B7%B4-65e41a0110c43b40309c4549241def6f.jpg" width="4000" height="3000" class="img_zKyM"></p>
<p>莫吉托<br>
<!-- -->配方</p>
<ul>
<li>2份 朗姆酒</li>
<li>2茶勺 糖浆</li>
<li>1.5份 柠檬汁</li>
<li>3份 苏打水</li>
<li>6片 薄荷叶</li>
<li>冰</li>
</ul>
<p>202401调，成品可能是自榨汁的青柠檬汁的缘故，有点混浊，而且整体味道很酸。
<img loading="lazy" src="https://blog.teaho.net/assets/images/%E8%8E%AB%E5%90%89%E6%89%98-ce1620cf3280f008fb0d270e1185b8a0.jpg" width="2441" height="1920" class="img_zKyM"></p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="drink" term="drink"/>
        <category label="tea" term="tea"/>
        <category label="wine" term="wine"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Thrift传输原理]]></title>
        <id>https://blog.teaho.net/article/thrift-rpc</id>
        <link href="https://blog.teaho.net/article/thrift-rpc"/>
        <updated>2024-05-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Thrift传输原理]]></summary>
        <content type="html"><![CDATA[<p>Thrift算是一种常见的RPC框架，我工作中也常常接触到。</p>
<br>
<blockquote>
<p>基于0.5.0版本</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="简介">简介<a href="https://blog.teaho.net/article/thrift-rpc#%E7%AE%80%EF%BF%BD%EF%BF%BD%E4%BB%8B" class="hash-link" aria-label="Direct link to 简介" title="Direct link to 简介">​</a></h2>
<p>Thrift作为一种接口定义语言（IDL）和二进制通信协议被应用在程序设计的服务创建和定义中，我们更常见称呼Thrift为RPC框架。
在使用Thrift中，我认为Thrift有如下特点：</p>
<ol>
<li>支持语言众多。拥有自成一体的IDL，各种语言C++、Java、Python等都有实现。</li>
<li>传输性能优秀。RPC性能对比不错，很多大公司，还有组件（Hadoop、Hive等）都使用它。</li>
</ol>
<p><img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/wiki_thrift-67b0c5a19cd16cda2c641006d6fed464.png" width="546" height="987" class="img_zKyM"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="组件职责和传输">组件职责和传输<a href="https://blog.teaho.net/article/thrift-rpc#%E7%BB%84%E4%BB%B6%E8%81%8C%E8%B4%A3%E5%92%8C%E4%BC%A0%E8%BE%93" class="hash-link" aria-label="Direct link to 组件职责和传输" title="Direct link to 组件职责和传输">​</a></h2>
<p>Thrift官网有介绍Thrift Server的网络层和各组件作用，我们跟着顺藤摸瓜：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Server</span><span class="token plain">                                    </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">single</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">threaded</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> event</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">driven etc</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Processor</span><span class="token plain">                                 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">compiler generated</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">                      </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Protocol</span><span class="token plain">                                  </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">JSON</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> compact etc</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">                       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Transport</span><span class="token plain">                                 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">raw </span><span class="token constant" style="color:hsl(29, 54%, 61%)">TCP</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">HTTP</span><span class="token plain"> etc</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">                       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/thrift_invoke_process-933b42345aedd4a5563dfd108c7ef059.png" width="1333" height="683" class="img_zKyM">
上图给出整体流程图，我这里一一说下：</p>
<ul>
<li><strong>Transport</strong> 网络传输封装，TCP、HTTP之类。最终传输层协议实现有在类中生成socket，也有会抽象一层TSocket去做。<!-- -->
<ul>
<li>TFramedTransport</li>
<li>TNonblockingTransport</li>
<li>THttpClient</li>
</ul>
</li>
<li><strong>Protocol</strong> 传输序列化协议<!-- -->
<ul>
<li>TBinaryProtocol</li>
<li>TCompactProtocol</li>
<li>TJSONProtocol</li>
</ul>
</li>
<li><strong>TProcessor</strong> thrift代码生成，传输及序列化流程处理</li>
<li><strong>TServer</strong> 处理网络流程执行，数据处理整个流程<!-- -->
<ul>
<li>TSimpleServer</li>
<li>TThreadPoolServer</li>
<li>TNonblockingCompleteServer</li>
</ul>
</li>
<li><strong>Client和TServiceClient</strong> thrift生成的代码，client端调用使用</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="协议分析">协议分析<a href="https://blog.teaho.net/article/thrift-rpc#%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 协议分析" title="Direct link to 协议分析">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="strict-binary协议">Strict Binary协议<a href="https://blog.teaho.net/article/thrift-rpc#strict-binary%E5%8D%8F%E8%AE%AE" class="hash-link" aria-label="Direct link to Strict Binary协议" title="Direct link to Strict Binary协议">​</a></h3>
<p>调用示例</p>
<div class="language-Thrift language-thrift codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-thrift codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">enum TypeEnum {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">UNKNOWN = 0;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">ADMIN = 1;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">NORMAL = 2;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">struct Req {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">1:i32 id;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">2:TypeEnum type;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">3:string name;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">4:map&lt;string, string&gt; parameters;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">5:bool fill_info;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">struct UserInfo {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">1:i32 id;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">2:TypeEnum type;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">3:string name;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">4:map&lt;string, string&gt; parameters;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">5:bool status;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">service SimpleThriftService {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">string knock(1:string msg);</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">UserInfo getUserInfo(1:Req req);</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-Java language-java codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token class-name" style="color:hsl(29, 54%, 61%)">TTransport</span><span class="token plain"> transport </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TSocket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"localhost"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">9090</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TProtocol</span><span class="token plain"> protocol </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TBinaryProtocol</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">transport</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">SimpleThriftService</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Client</span><span class="token plain"> client </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">SimpleThriftService</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Client</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">protocol</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">transport</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">open</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Req</span><span class="token plain"> req </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Req</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TypeEnum</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">NORMAL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"test"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">HashMap</span><span class="token generics punctuation" style="color:hsl(220, 14%, 71%)">&lt;</span><span class="token generics class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token generics punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token generics punctuation" style="color:hsl(220, 14%, 71%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token function" style="color:hsl(207, 82%, 66%)">put</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"k"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"v"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">false</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">UserInfo</span><span class="token plain"> userInfo </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token function" style="color:hsl(207, 82%, 66%)">getUserInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">req</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="分析字节码">分析字节码<a href="https://blog.teaho.net/article/thrift-rpc#%E5%88%86%E6%9E%90%E5%AD%97%E8%8A%82%E7%A0%81" class="hash-link" aria-label="Direct link to 分析字节码" title="Direct link to 分析字节码">​</a></h4>
<p>以使用最广的<code>strict Binary</code>协议为例，基于上面示例调用，进行了抓包，结合文档对字节码进行直观分析。
注：wireshark抓包的话自带了一些方便的标注。
这里只标注了client请求协议体，<strong>server reply返回的消息格式相同</strong>。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">//Message</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">80</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 10000000 00000001 首位1标识为strict binary protocol, 其余15位标识版本号</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 无用字节</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// message type消息类型 1：CALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> 0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 方法名长度 11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">67</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">65</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">74</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">55</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">73</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">65</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">72</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">49</span><span class="token plain"> 6e </span><span class="token number" style="color:hsl(29, 54%, 61%)">66</span><span class="token plain"> 6f </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 方法名：getUserInfo</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// seq id顺序id，client用这个号去处理消息的失序响应</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">//Struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0c </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：T_STRUCT</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 类型: T_STOP</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0c </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：T_STRUCT</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">08</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：I32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// int32值=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">08</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：I32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">02</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">02</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// int32值=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：BINARY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">03</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">04</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// BINARY field会带length，为4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">74</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">65</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">73</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">74</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//string值为test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0d </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：MAP</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">04</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//field id: 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//key type: BINARY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//value type: BINARY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//map的item数，该例子为1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//length：1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">6b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//值为 k</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//value length：1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">76</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 值为 v</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">02</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：BOOL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">05</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//field id: 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//值为FALSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//T_STOP 标识STRUCT结束</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//T_STOP 标识整体数据结束</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="协议格式">协议格式<a href="https://blog.teaho.net/article/thrift-rpc#%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F" class="hash-link" aria-label="Direct link to 协议格式" title="Direct link to 协议格式">​</a></h4>
<p><img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/strict_binary_protocol-e8c5a4ec5066a2ef4a41f8684f7b4a3a.png" width="713" height="483" class="img_zKyM"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="1-协议头">1. 协议头<a href="https://blog.teaho.net/article/thrift-rpc#1-%E5%8D%8F%E8%AE%AE%E5%A4%B4" class="hash-link" aria-label="Direct link to 1. 协议头" title="Direct link to 1. 协议头">​</a></h5>
<p>分为这四种消息类型</p>
<ul>
<li><em>Call</em>: 1 client发送的消息类型，指代需要响应的消息。</li>
<li><em>Reply</em>: 2  server回复响应的消息。</li>
<li><em>Exception</em>: 3 server异常消息。</li>
<li><em>Oneway</em>: 4  client发送的单向消息，不需要返回。</li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="2-协议体">2. 协议体<a href="https://blog.teaho.net/article/thrift-rpc#2-%E5%8D%8F%E8%AE%AE%E4%BD%93" class="hash-link" aria-label="Direct link to 2. 协议体" title="Direct link to 2. 协议体">​</a></h5>
<p><img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/binary_protocol_body-905212976e488df3563f01d7bb2c9a00.png" width="1163" height="363" class="img_zKyM"></p>
<ul>
<li>一般定长数据：i32、i64、BOOL等，采用TV模式，字段类型（1字节）+ field id（2字节）+ 值</li>
<li>变长数据：STRUCT、BINARY、MAP、LIST、SET等，采用TLV模式，字段类型（1字节）+ field id（2字节）+ field length (4字节) + 值</li>
</ul>
<p>定长数据类型</p>
<table><thead><tr><th style="text-align:center">数据类型</th><th style="text-align:center">字段类型（1个字节）</th><th style="text-align:center">类型尺寸（单位：字节）</th></tr></thead><tbody><tr><td style="text-align:center">bool</td><td style="text-align:center">2</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">byte</td><td style="text-align:center">3</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">double</td><td style="text-align:center">4</td><td style="text-align:center">8</td></tr><tr><td style="text-align:center">i16</td><td style="text-align:center">6</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">i32</td><td style="text-align:center">8</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">i64</td><td style="text-align:center">10</td><td style="text-align:center">8</td></tr></tbody></table>
<p>变长数据类型</p>
<table><thead><tr><th style="text-align:center">数据类型</th><th style="text-align:center">字段类型（1个字节）</th><th style="text-align:center">类型尺寸（长度 + 值）</th></tr></thead><tbody><tr><td style="text-align:center">string</td><td style="text-align:center">11</td><td style="text-align:center">4 + N</td></tr><tr><td style="text-align:center">struct</td><td style="text-align:center">12</td><td style="text-align:center">嵌套数据 + 1个字节停止符STOP（00）</td></tr><tr><td style="text-align:center">map</td><td style="text-align:center">13</td><td style="text-align:center">1 + 1 + 4 + n*(k+v)</td></tr><tr><td style="text-align:center">set</td><td style="text-align:center">14</td><td style="text-align:center">1 + 4 + N 【val类型 + item数 + 值】</td></tr><tr><td style="text-align:center">list</td><td style="text-align:center">15</td><td style="text-align:center">1 + 4 + N 【val类型 + item数 + 值】</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="老non-strictbinary协议">老（non-strict）Binary协议<a href="https://blog.teaho.net/article/thrift-rpc#%E8%80%81non-strictbinary%E5%8D%8F%E8%AE%AE" class="hash-link" aria-label="Direct link to 老（non-strict）Binary协议" title="Direct link to 老（non-strict）Binary协议">​</a></h3>
<p><img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/non-strict-binary-protocol-89591d96fc71ee77be46584901dd96ea.png" width="633" height="403" class="img_zKyM">
字段分析同上。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="compact协议">Compact协议<a href="https://blog.teaho.net/article/thrift-rpc#compact%E5%8D%8F%E8%AE%AE" class="hash-link" aria-label="Direct link to Compact协议" title="Direct link to Compact协议">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="协议格式-1">协议格式<a href="https://blog.teaho.net/article/thrift-rpc#%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F-1" class="hash-link" aria-label="Direct link to 协议格式" title="Direct link to 协议格式">​</a></h4>
<p><img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/compact-protocol-2578f8f409a8e41e1f183f934efa565c.png" width="633" height="393" class="img_zKyM"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="1-协议头-1">1. 协议头<a href="https://blog.teaho.net/article/thrift-rpc#1-%E5%8D%8F%E8%AE%AE%E5%A4%B4-1" class="hash-link" aria-label="Direct link to 1. 协议头" title="Direct link to 1. 协议头">​</a></h5>
<p>对比Binary协议，将消息类型和版本做了压缩，头字段排列做了优化。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="2-协议体-1">2. 协议体<a href="https://blog.teaho.net/article/thrift-rpc#2-%E5%8D%8F%E8%AE%AE%E4%BD%93-1" class="hash-link" aria-label="Direct link to 2. 协议体" title="Direct link to 2. 协议体">​</a></h5>
<p>协议体的压缩主要是通过<code>zigzag</code>和<code>var int</code>（protobuf也用到这两算法去做压缩），对<strong>数字类型</strong>和变长字段的<strong>length头</strong>做压缩。</p>
<p><strong>Zigzag</strong></p>
<p>作用：能够将有符号数压缩为无符号整数。从而减少存储和传输空间。<br>
<!-- -->int32算法：<code>(n &lt;&lt; 1) ^ (n &gt;&gt; 31)</code><br>
<!-- -->举例：处理整数 1和-1。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">原始：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000001</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">左移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000010</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">右移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">31</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">异或：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000010</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">原始：</span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">左移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111110</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">右移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">31</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">异或：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000001</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>经过编码后，-1转换为无符号整数，方便压缩。</p>
<p><strong>Var int</strong><br>
<!-- -->作用：能够将正整数压缩字节数，结合zigzag能够减少存储和传输空间。<br>
<!-- -->例子：转换数字123456 -&gt; 结果10111001 01100000</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">//算法：复制自TCompactProtocol</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">toVarint32</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token parameter">int n</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> i32buf </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token number" style="color:hsl(29, 54%, 61%)">5</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">int idx </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">~</span><span class="token number" style="color:hsl(29, 54%, 61%)">0x7F</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">i32buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token plain">idx</span><span class="token operator" style="color:hsl(207, 82%, 66%)">++</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">n</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">// writeByteDirect((byte)n);</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">break</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">// return;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">i32buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token plain">idx</span><span class="token operator" style="color:hsl(207, 82%, 66%)">++</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0x7F</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0x80</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">// writeByteDirect((byte)((n &amp; 0x7F) | 0x80));</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;&gt;&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">7</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> i32buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">数字</span><span class="token number" style="color:hsl(29, 54%, 61%)">123456</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00110000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00111001</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">次循环</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token number" style="color:hsl(29, 54%, 61%)">10111001</span><span class="token plain">  </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">次循环</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token number" style="color:hsl(29, 54%, 61%)">10111001</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01100000</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="img.png" src="https://blog.teaho.net/assets/images/varint-4d9712cd1e3954532b16638b364b6fe5.png" width="400" height="247" class="img_zKyM"></p>
<p><strong>需要注意</strong>：compact协议的对小数值数字，压缩能力好，但是对于大数，压缩能力有限。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="json协议">JSON协议<a href="https://blog.teaho.net/article/thrift-rpc#json%E5%8D%8F%E8%AE%AE" class="hash-link" aria-label="Direct link to JSON协议" title="Direct link to JSON协议">​</a></h3>
<p>json协议编码在Thrift不常用且不建议用，这里不打算说。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">Reference<a href="https://blog.teaho.net/article/thrift-rpc#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2>
<p>[1]<a href="https://en.wikipedia.org/wiki/Apache_Thrift" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Apache_Thrift</a><br>
<!-- -->[2]<a href="https://thrift.apache.org/docs/concepts.html" target="_blank" rel="noopener noreferrer">https://thrift.apache.org/docs/concepts.html</a><br>
<!-- -->[3]<a href="https://developer.aliyun.com/article/643859" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/article/643859</a><br>
<!-- -->[4]Thrift spec <span style="display:inline-flex;gap:0.25rem"><span></span><a href="https://github.com/apache/thrift/blob/master/doc/specs/thrift-rpc.md" target="_blank" rel="noopener noreferrer">https://github.com/apache/thrift/blob/master/doc/specs/thrift-rpc.md</a></span><br>
<!-- -->[5]<span style="display:inline-flex;gap:0.25rem"><span></span><a href="https://github.com/apache/thrift/blob/master/doc/specs/thrift-binary-protocol.md" target="_blank" rel="noopener noreferrer">https://github.com/apache/thrift/blob/master/doc/specs/thrift-binary-protocol.md</a></span><br>
<!-- -->[6]<a href="https://zhuanlan.zhihu.com/p/476213759" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/476213759</a><br>
<!-- -->[7]<a href="https://www.linux88.com/zigzag/" target="_blank" rel="noopener noreferrer">https://www.linux88.com/zigzag/</a></p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="thrift" term="thrift"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Sentinel core原理分析]]></title>
        <id>https://blog.teaho.net/article/sentinel-core</id>
        <link href="https://blog.teaho.net/article/sentinel-core"/>
        <updated>2022-04-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Sentinel core原理分析]]></summary>
        <content type="html"><![CDATA[<p>谈到微服务设计，我们常用到断路器，而今国内Java的断路器实现，Sentinel凭借它的丰富的语言支持、框架整合支持、生态协同，可谓首屈一指。它最重要的原理实现Sentinel-core，我们来细细窥探。</p>
<br>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="简介">简介<a href="https://blog.teaho.net/article/sentinel-core#%E7%AE%80%E4%BB%8B" class="hash-link" aria-label="Direct link to 简介" title="Direct link to 简介">​</a></h2>
<p>提到Sentinel，相信大家都知道联想到熔断、服务间流量控制等。我之前也分析过Hystrix、Spring cloud的断路器设计，可看<a href="https://spring-source-code-learning.gitbook.teaho.net/cloud/spring-cloud-circuitbreak" target="_blank" rel="noopener noreferrer">Spring Cloud的断路器--Spring Cloud Commons定义、Netflix Hystrix实现分析</a>.</p>
<p>官网对Sentinel熔断总结和抽象的很好：</p>
<blockquote>
<p>Sentinel 可以简单的分为 Sentinel 核心库和 Dashboard。</p>
<p>我们说的资源，可以是任何东西，服务，服务里的方法，甚至是一段代码。使用 Sentinel 来进行资源保护，主要分为几个步骤:</p>
<ol>
<li>定义资源</li>
<li>定义规则</li>
<li>检验规则是否生效</li>
</ol>
</blockquote>
<p>想了解Sentinel就绕不开Sph，SphU，SphO，CtSph等。我想有人会好奇这名字代表什么意思，<br>
<!-- -->官方说了Sph是一个魔法名(magic name)，原来指代信号量Semaphore，历史原因没法改。<br>
<!-- -->U、O网上传闻代表Unit、Operation。</p>
<p>下面说下初始化和执行流程。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="初始化">初始化<a href="https://blog.teaho.net/article/sentinel-core#%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="Direct link to 初始化" title="Direct link to 初始化">​</a></h2>
<p>Sentinel初始化会调用<code>InitExecutor.doInit()</code>这个方法。进行如下初始化：<br>
<img loading="lazy" alt="sentinel_init_logic_flow.jpg" src="https://blog.teaho.net/assets/images/sentinel_init_logic_flow-3c326b9c6862e121d7d90a3995d21f72.jpg" width="541" height="521" class="img_zKyM"></p>
<ol>
<li>通过SPI加载InitFunc（Sentinel SPI类似Spring SPI，有兴趣可看下@SPI注解和SPILoader类）。</li>
<li>排序</li>
<li>调用InitFunc集合的init方法</li>
</ol>
<p>我们看看这三个核心的InitFunc：</p>
<ul>
<li>CommandCenterInitFunc</li>
<li>HeartbeatSenderInitFunc</li>
<li>MetricCallbackInit</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="commandcenter">CommandCenter<a href="https://blog.teaho.net/article/sentinel-core#commandcenter" class="hash-link" aria-label="Direct link to CommandCenter" title="Direct link to CommandCenter">​</a></h3>
<p>CommandCenterInitFunc能够初始化CommandCenter。</p>
<p>CommandCenter可以理解为提供服务，我们可以通过这个服务接口和Sentinel core通讯，具体接口由CommandHandler提供。</p>
<blockquote>
<p>The simple command center provides service to exchange information.</p>
</blockquote>
<p>围绕CommandCenter有这些工具类：</p>
<ul>
<li>@CommandMapping</li>
<li>CommandHandler</li>
<li>CommandHandlerInterceptor</li>
</ul>
<p>CommandCenter有：</p>
<ul>
<li>SimpleHttpCommandCenter 基于java ServerSocket的简单http实现</li>
<li>NettyHttpCommandCenter  netty实现</li>
<li>SpringMvcHttpCommandCenter 基于Spring Boot的提供Spring MVC handlerMapping的实现。</li>
</ul>
<p>简单说下常用的SimpleHttpCommandCenter实现：</p>
<ol>
<li>启动单线程executor去执行server启动。</li>
<li>bizExecutor是处理请求的executor。</li>
<li>HttpEventTask读取HTTP报文，解析出CommandRequest，并执行CommandHandler。</li>
<li>返回数据。</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="heartbeatsender">HeartbeatSender<a href="https://blog.teaho.net/article/sentinel-core#heartbeatsender" class="hash-link" aria-label="Direct link to HeartbeatSender" title="Direct link to HeartbeatSender">​</a></h3>
<p>HeartbeatSenderInitFunc通过SPI初始化HeartbeatSender。<br>
<!-- -->HeartbeatSender是维持Sentinel core和Sentinel dashboard心跳的组件。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//通过SPI获取HeartbeatSender</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HeartbeatSender</span><span class="token plain"> sender </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HeartbeatSenderProvider</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getHeartbeatSender</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">sender </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">RecordLog</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">warn</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"[HeartbeatSenderInitFunc] WARN: No HeartbeatSender loaded"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//初始化定时任务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token function" style="color:hsl(207, 82%, 66%)">initSchedulerIfNeeded</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//获取心跳发送周期 1. 配置 2. 获取不到则用HeartbeatSender的interval</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    long interval </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">retrieveInterval</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token function" style="color:hsl(207, 82%, 66%)">setIntervalIfNotExists</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">interval</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//启动心跳任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token function" style="color:hsl(207, 82%, 66%)">scheduleHeartbeatTask</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> interval</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>HeartbeatSender的实现有：</p>
<ul>
<li>SimpleHttpHeartbeatSender 基于java Socket的http实现</li>
<li>HttpHeartbeatSender 使用netty http发送心跳</li>
<li>SpringMvcHttpHeartbeatSender 使用httpclient发送心跳</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="metriccallbackinit">MetricCallbackInit<a href="https://blog.teaho.net/article/sentinel-core#metriccallbackinit" class="hash-link" aria-label="Direct link to MetricCallbackInit" title="Direct link to MetricCallbackInit">​</a></h3>
<p><code>MetricEntryCallback</code>和<code>MetricExitCallback</code>通过<code>MetricCallbackInit</code>初始化。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">init</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">StatisticSlotCallbackRegistry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">addEntryCallback</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MetricEntryCallback</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getCanonicalName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">MetricEntryCallback</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">StatisticSlotCallbackRegistry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">addExitCallback</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MetricExitCallback</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getCanonicalName</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">MetricExitCallback</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可以通过StatisticSlotCallbackRegistry.addEntryCallback和addExitCallback，增加Sentinel规则监控。<br>
<!-- -->也可通过定义AdvancedMetricExtension接口SPI实现类来做到增加Sentinel规则监控。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="执行">执行<a href="https://blog.teaho.net/article/sentinel-core#%E6%89%A7%E8%A1%8C" class="hash-link" aria-label="Direct link to 执行" title="Direct link to 执行">​</a></h2>
<p>我们知道Sentinel一般使用<code>SphU.entry</code>作为入口。Sentinel core主流程可简单描述为：</p>
<ol>
<li>定义资源 （目前有两种string资源和Method资源）</li>
<li>定义规则（ProcessorSlot）</li>
<li>检验规则是否生效</li>
</ol>
<blockquote>
<p>Do all Rules checking about the resource.<br>
<!-- -->Each distinct resource will use a ProcessorSlot to do rules checking. Same resource will use same ProcessorSlot globally.</p>
</blockquote>
<p>SphU下面会执行如下语句：（Env.sph默认为CtSph。）</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//SphU</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Env</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">sph</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> trafficType</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> batchCount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//CtSph</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Entry</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">EntryType</span><span class="token plain"> type</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> int count</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Object</span><span class="token spread operator" style="color:hsl(207, 82%, 66%)">...</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BlockException</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">StringResourceWrapper</span><span class="token plain"> resource </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">StringResourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> type</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resource</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们接下来看下CtSph的核心流程：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">private</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Entry</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">entryWithPriority</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ResourceWrapper</span><span class="token plain"> resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> int count</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> boolean prioritized</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Object</span><span class="token spread operator" style="color:hsl(207, 82%, 66%)">...</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BlockException</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//1. 获取当前线程的上下文</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Context</span><span class="token plain"> context </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getContext</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//2. 如果超过了最大context数(2000),直接返回</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">context </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">instanceof</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">NullContext</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// The {@link NullContext} indicates that the amount of context has exceeded the threshold,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// so here init the entry only. No rule checking will be done.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CtEntry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//2. 如果是在最上层，初始化context</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">context </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Using default context.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            context </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InternalContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">internalEnter</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Constants</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">CONTEXT_DEFAULT_NAME</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Global switch is close, no rule checking will do.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Constants</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">ON</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CtEntry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//3. 获取slot调用链，以资源维度生成chain</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ProcessorSlot</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Object</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> chain </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">lookProcessChain</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         * Means amount of resources (slot chain) exceeds {@link Constants.MAX_SLOT_CHAIN_SIZE},</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         * so no rule checking will be done.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">         </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//4. 如果超过了MAX_SLOT_CHAIN_SIZE(6000)，则不执行rule检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">chain </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CtEntry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 5. 生成entry类（入口）</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Entry</span><span class="token plain"> e </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CtEntry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> chain</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//6. 执行slot链</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            chain</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> count</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> prioritized</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BlockException</span><span class="token plain"> e1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 规则检查，抛出sentiinel的block异常，调用exit做上下文处理和记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">count</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">throw</span><span class="token plain"> e1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Throwable</span><span class="token plain"> e1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// This should not happen, unless there are errors existing in Sentinel internal.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">RecordLog</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">info</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Sentinel unexpected exception"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> e1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面是核心流程，我们<strong>重点分析slot流程和Context的结构</strong>。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="slot-chain">Slot chain<a href="https://blog.teaho.net/article/sentinel-core#slot-chain" class="hash-link" aria-label="Direct link to Slot chain" title="Direct link to Slot chain">​</a></h3>
<p>引用官方文档的话，</p>
<blockquote>
<p>在 Sentinel 里面，所有的资源都对应一个资源名称（resourceName），每次资源调用都会创建一个 Entry 对象。
Entry 可以通过对主流框架的适配自动创建，也可以通过注解的方式或调用 SphU API 显式创建。
Entry 创建的时候，同时也会创建一系列功能插槽（slot chain）。</p>
</blockquote>
<p>slot chain是在上面第三步初始化的<code>lookProcessChain(resourceWrapper);</code>。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//CtSph</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ProcessorSlot</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Object</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">lookProcessChain</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token parameter maybe-class-name" style="color:hsl(29, 54%, 61%)">ResourceWrapper</span><span class="token parameter"> resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ProcessorSlotChain</span><span class="token plain"> chain </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> chainMap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">chain </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token parameter constant" style="color:hsl(29, 54%, 61%)">LOCK</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                chain </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> chainMap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resourceWrapper</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">chain </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Entry size limit.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">chainMap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Constants</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAX_SLOT_CHAIN_SIZE</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    chain </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SlotChainProvider</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">newSlotChain</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//省略</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> chain</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//SlotChainProvider</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    slotChainBuilder </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SpiLoader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">of</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SlotChainBuilder</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">loadFirstInstanceOrDefault</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//DefaultSlotChainBuilder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">List</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ProcessorSlot</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> sortedSlotList </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SpiLoader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">of</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ProcessorSlot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">loadInstanceListSorted</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>说说初始化步骤：</p>
<ol>
<li>通过单例方式初始化resource的ProcessorSlotChain。</li>
<li>通过SPI初始化SlotChainBuilder</li>
<li>通过SPI初始化ProcessorSlot集合</li>
</ol>
<p>ProcessorSlotChain的结构是一个单向链表，默认的链表元素有（按执行顺序）(部分描述取自wiki)：</p>
<ol>
<li>NodeSelectorSlot 负责收集资源的路径，并将这些资源的调用路径，以树状结构存储起来，用于根据调用路径来限流降级；</li>
<li>ClusterBuilderSlot 则用于存储资源的统计信息以及调用者信息，例如该资源的<code>RT, QPS, thread count</code>等等，这些信息将用作为多维度限流，降级的依据；</li>
<li>LogSlot 打印一些block日志</li>
<li>StatisticSlot 用于记录、统计不同纬度的<code>runtime</code>指标监控信息；</li>
<li>AuthoritySlot 黑白名单控制，以资源名为缓存维度，以origin（app）为控制维度。</li>
<li>SystemSlot 用于系统负载限制，可以对总体的应用数据qps、thread、rt达到某阈值做block, 也可以对系统load、cpu用量达到某阈值做block。</li>
<li>FlowSlot 限流策略实现，基于阈值类型、流控模式、效果（fail fast、warm up、queue wait）这几个维度去做控制。</li>
<li>DegradeSlot 降级策略实现，有基于rt、异常比例、异常次数三种方式降级。</li>
</ol>
<p>以上slot是执行流程。</p>
<p>数据结构在Context中进行解读。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="sentinel-context结构">Sentinel Context结构<a href="https://blog.teaho.net/article/sentinel-core#sentinel-context%E7%BB%93%E6%9E%84" class="hash-link" aria-label="Direct link to Sentinel Context结构" title="Direct link to Sentinel Context结构">​</a></h3>
<p>我们先看这段例子代码的：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 配置规则.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">initFlowRules</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">enter</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"entrance1"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"appA"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Entry</span><span class="token plain"> nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SphU</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"nodeA"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BlockException</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 处理被流控的逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"1 blocked!"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">enter</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"entrance2"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"appB"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SphU</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"nodeB"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BlockException</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 处理被流控的逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"node b blocked!"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">enter</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"entrance2"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"appA"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SphU</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"nodeA"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BlockException</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 处理被流控的逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"nodeA 2 blocked!"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ContextUtil</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SphU</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">entry</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"nodeC"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BlockException</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 处理被流控的逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"nodeC blocked!"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">nodeA </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nodeA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这段代码执行时的整体数据依赖关系：<br>
<img loading="lazy" alt="context_node_struct.jpg" src="https://blog.teaho.net/assets/images/context_node_struct-26eccdb7e4f50bc8ec1f62027ddd0175.jpg" width="1721" height="721" class="img_zKyM"></p>
<p>可看到Context的结构包含了：</p>
<ul>
<li>name</li>
<li>entranceNode</li>
<li>curEntry</li>
<li>origin</li>
</ul>
<p>CtEntry是当前Context中的一个链表结构，指代一个入口，包含：</p>
<ul>
<li>父子entry</li>
<li>context</li>
<li>ProcessSlotChain</li>
<li>curNode</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="statisticnode和leaparray">StatisticNode和leapArray<a href="https://blog.teaho.net/article/sentinel-core#statisticnode%E5%92%8Cleaparray" class="hash-link" aria-label="Direct link to StatisticNode和leapArray" title="Direct link to StatisticNode和leapArray">​</a></h4>
<p>按照Sentinel的文档来看，是基于时间窗口，其实现算法是leapArray。</p>
<p>统计的相关数据都用到node我们来看下Node的继承关系：<br>
<img loading="lazy" alt="img_2.png" src="https://blog.teaho.net/assets/images/img_2-b9f36564578a5ce4f764901d78789f81.png" width="268" height="136" class="img_zKyM"></p>
<p>我们看到顶级父类是StatisticNode里面核心的属性是：<code>rollingCounterInSecond</code>和<code>rollingCounterInMinute</code>。其实现的数据结构就是<code>LeapArray&lt;MetricBucket&gt;</code>。 （DegradeSlot熔断降级是额外新增了LeapArray去统计）<br>
<!-- -->LeapArray是基于时间窗口的实现，会把一段时间(intervalInMs)切分为取样个数(sampleCount)。</p>
<ul>
<li>int windowLengthInMs 单窗格的毫秒</li>
<li>int sampleCount 取样个数 <code>sampleCount = intervalInMs / windowLengthInMs</code></li>
<li>int intervalInMs 间隔时间(ms)</li>
<li>double intervalInSecond 间隔的时间(s)</li>
<li><code>AtomicReferenceArray &lt;WindowWrap&lt;MetricBucket&gt;&gt;</code> array 存储窗格的接口。</li>
<li>ReentrantLock updateLock 插入和替换窗格的锁</li>
</ul>
<p>数组里取样位的数据结构是<code>MetricBucket</code>，<code>MetricBucket</code>存储以下几种类型的计数：</p>
<ul>
<li>PASS</li>
<li>BLOCK</li>
<li>EXCEPTION</li>
<li>SUCCESS</li>
<li>RT <code>Response Time</code>。</li>
<li>OCCUPIED_PASS</li>
</ul>
<p>结构整理如下：<br>
<img loading="lazy" alt="leapArray_struct.jpg" src="https://blog.teaho.net/assets/images/leapArray_struct-6b437e55d6917437ff86d33eb18d2fbb.jpg" width="1178" height="772" class="img_zKyM"></p>
<p>分析下leapArray的核心方法：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 用 当前时间 根据 窗格时长 计算出当前时间的滑动窗口的 数组下标 </span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">private</span><span class="token plain"> int </span><span class="token function" style="color:hsl(207, 82%, 66%)">calculateTimeIdx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*@Valid*/</span><span class="token plain"> long timeMillis</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        long timeId </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> timeMillis </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> windowLengthInMs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">int</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">timeId </span><span class="token operator" style="color:hsl(207, 82%, 66%)">%</span><span class="token plain"> array</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">length</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 用 当前时间 根据 窗格时长 计算出当前滑动窗口的 开始时间 例如：12 - 12%2 = 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">protected</span><span class="token plain"> long </span><span class="token function" style="color:hsl(207, 82%, 66%)">calculateWindowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*@Valid*/</span><span class="token plain"> long timeMillis</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> timeMillis </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain"> timeMillis </span><span class="token operator" style="color:hsl(207, 82%, 66%)">%</span><span class="token plain"> windowLengthInMs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">WindowWrap</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token constant" style="color:hsl(29, 54%, 61%)">T</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">currentWindow</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token parameter">long timeMillis</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">timeMillis </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//窗口滑动方法 计算窗格下标</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        int idx </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">calculateTimeIdx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">timeMillis</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//窗口滑动方法 计算当前窗格bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        long windowStart </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">calculateWindowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">timeMillis</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         * Get bucket item at given time from the array.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         * (1) Bucket is absent, then just create a new bucket and CAS update to circular array.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         * (2) Bucket is up-to-date, then just return the bucket.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         * (3) Bucket is deprecated, then reset current bucket.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         1. bucket不存在，则创建一个新并CAS更新。</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         2. bucket是当前最新的，返回。</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         3. bucket是过时并应该弃用，加锁并重置当前bucket.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         4. windowStart&lt;窗口开始时间，意味着输入的时间超过了intervalInMs，是错误的输入，理论上不应该输入。</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">         */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">WindowWrap</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token constant" style="color:hsl(29, 54%, 61%)">T</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> old </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> array</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">idx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">old </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *     B0       B1      B2    NULL      B4</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * ||_______|_______|_______|_______|_______||___</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * 200     400     600     800     1000    1200  timestamp</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *                             ^</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *                          time=888</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *            bucket is empty, so create new and update</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * If the old bucket is absent, then we create a new bucket at {@code windowStart},</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * then try to update circular array via a CAS operation. Only one thread can</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * succeed to update, while other threads yield its time slice.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">WindowWrap</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token constant" style="color:hsl(29, 54%, 61%)">T</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(207, 82%, 66%)">window</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">WindowWrap</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token constant" style="color:hsl(29, 54%, 61%)">T</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">windowLengthInMs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> windowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">newEmptyBucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">timeMillis</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">compareAndSet</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">idx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(207, 82%, 66%)">window</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Successfully updated, return the created bucket.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token dom variable" style="color:hsl(207, 82%, 66%)">window</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Contention failed, the thread will yield its time slice to wait for bucket available.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Thread</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">yield</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">windowStart </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> old</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">windowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *     B0       B1      B2     B3      B4</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * ||_______|_______|_______|_______|_______||___</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * 200     400     600     800     1000    1200  timestamp</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *                             ^</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *                          time=888</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *            startTime of Bucket 3: 800, so it's up-to-date</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * If current {@code windowStart} is equal to the start timestamp of old bucket,</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * that means the time is within the bucket, so directly return the bucket.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> old</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">windowStart </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> old</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">windowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *   (old)</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *             B0       B1      B2    NULL      B4</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * |_______||_______|_______|_______|_______|_______||___</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * ...    1200     1400    1600    1800    2000    2200  timestamp</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *                              ^</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *                           time=1676</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *          startTime of Bucket 2: 400, deprecated, should be reset</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * If the start timestamp of old bucket is behind provided time, that means</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * the bucket is deprecated. We have to reset the bucket to current {@code windowStart}.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * Note that the reset and clean-up operations are hard to be atomic,</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * so we need a update lock to guarantee the correctness of bucket update.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * The update lock is conditional (tiny scope) and will take effect only when</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 * bucket is deprecated, so in most cases it won't lead to performance loss.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">                 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">updateLock</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">tryLock</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Successfully get the update lock, now we reset the bucket.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">resetWindowTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">old</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> windowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        updateLock</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">unlock</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Contention failed, the thread will yield its time slice to wait for bucket available.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Thread</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">yield</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">windowStart </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain"> old</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">windowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Should not go through here, as the provided time is already behind.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">WindowWrap</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token constant" style="color:hsl(29, 54%, 61%)">T</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">windowLengthInMs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> windowStart</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">newEmptyBucket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">timeMillis</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="总结">总结<a href="https://blog.teaho.net/article/sentinel-core#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p><img loading="lazy" alt="取自sentinel的wiki" src="https://blog.teaho.net/assets/images/img-457176a3810f6999b260fff75532eb41.png" width="1070" height="684" class="img_zKyM"><br>
<!-- -->上图取自sentinel的wiki。</p>
<p>以前对Sentinel有一些源码的阅读和理解，不得不感叹看过的东西又再忘记了，这次让团队中一位小伙伴基于Sentinel开发一个组件，我再捡起来顺便记录下。
本节主要聚焦于初始化和核心执行流程（非异步侧）。对基础数据结构也做了分析。</p>
<p>重点分析了Sentinel core的初始化，ProcessSlotChain执行流程，Context和LeapArray。
Sentinel经历过很多公司的线上大流量验证，我们也能在其中看到一些历史，学到一些质朴的清晰的可拓展的代码设计流程。</p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="java" term="java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[容器环境下的相关JVM参数]]></title>
        <id>https://blog.teaho.net/article/java-container-args</id>
        <link href="https://blog.teaho.net/article/java-container-args"/>
        <updated>2021-11-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[现在是云原生时代，我们在日常中多少会碰到容器，来让我们看看JVM对容器环境的支持吧。]]></summary>
        <content type="html"><![CDATA[<p>现在是云原生时代。作为开发的我（们）或多说少在平常和工作中和docker或k8s打过交道。而作为JAVA开发者，我们多少会对JVM参数进行调优。<br>
<!-- -->不知道大家有没有遇到过类似情况：在容器环境下，设置-Xmx报错。<br>
<!-- -->不管有木有，今天我们来探究下，容器环境下如何设置JAVA参数。</p>
<br>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="历史">历史<a href="https://blog.teaho.net/article/java-container-args#%E5%8E%86%E5%8F%B2" class="hash-link" aria-label="Direct link to 历史" title="Direct link to 历史">​</a></h3>
<ul>
<li>JDK8u121加入了UseCGroupMemoryLimitForHeap这一参数，对容器内存设置做支持。(JDK-8170888)</li>
<li>JDK8u191后加入了UseContainerSupport、MaxRAMPercentage、MinRAMPercentage、InitialRAMPercentage参数。<br>
<!-- -->deprecate了UseCGroupMemoryLimitForHeap、MaxRAMFraction、MinRAMFraction、InitialRAMFraction参数。</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="用法">用法<a href="https://blog.teaho.net/article/java-container-args#%E7%94%A8%E6%B3%95" class="hash-link" aria-label="Direct link to 用法" title="Direct link to 用法">​</a></h2>
<p>建议使用大于8u191版本的JAVA。</p>
<p>这里列举参数的默认值，方便下文说明。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">java </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintFlagsFinal</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">version </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> grep </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Ei</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"maxheapsize|maxram|initialram"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    uintx </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">DefaultMaxRAMFraction</span><span class="token plain">                     </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">4</span><span class="token plain">                                   </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">product</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//默认的堆内存系数</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    uintx </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMFraction</span><span class="token plain">                        </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">64</span><span class="token plain">                                  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">product</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//初始化堆内存系数，简单来说，机器（容器）内存/InitialRAMFraction=初始化堆内存内存</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   double </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMPercentage</span><span class="token plain">                      </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1.562500</span><span class="token plain">                            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">product</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//初始化堆内存百分比，简单来说，机器（容器）内存*InitialRAMPercentage/100=初始化堆内存大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    uintx </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token plain">                              </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">4139778048</span><span class="token plain">                          </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">product</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//堆的默认最大值</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> uint64_t </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAM</span><span class="token plain">                                    </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">137438953472</span><span class="token plain">                        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">pd product</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//和MaxHeapSize一起，用于运行时MaxHeapSize的计算</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    uintx </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMFraction</span><span class="token plain">                            </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">4</span><span class="token plain">                                   </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">product</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//最大的堆内存系数，简单来说，机器（容器）内存/MaxRAMFraction=最大堆内存</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   double </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMPercentage</span><span class="token plain">                          </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">25.000000</span><span class="token plain">                           </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">product</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//最大的堆内存百分比，简单来说，机器（容器）内存*MaxRAMPercentage/100=最大堆内存</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="java版本--8u121">java版本 &lt; 8u121<a href="https://blog.teaho.net/article/java-container-args#java%E7%89%88%E6%9C%AC--8u121" class="hash-link" aria-label="Direct link to java版本 < 8u121" title="Direct link to java版本 < 8u121">​</a></h3>
<p>不要在容器化环境使用。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="8u121--java版本--8u191">8u121 &lt; java版本 &lt; 8u191<a href="https://blog.teaho.net/article/java-container-args#8u121--java%E7%89%88%E6%9C%AC--8u191" class="hash-link" aria-label="Direct link to 8u121 < java版本 < 8u191" title="Direct link to 8u121 < java版本 < 8u191">​</a></h3>
<p>如果是使用OracleJDK需要额外开启实验参数
<code>-XX:UnlockExperimentalVMOptions</code>。</p>
<p>建议使用如下参数：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UseCGroupMemoryLimitForHeap</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMFraction</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MinRAMFraction</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或自行设置</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Xmx</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain">用户自定义</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="java版本-8u191">java版本 &gt;=8u191<a href="https://blog.teaho.net/article/java-container-args#java%E7%89%88%E6%9C%AC-8u191" class="hash-link" aria-label="Direct link to java版本 >=8u191" title="Direct link to java版本 >=8u191">​</a></h3>
<p>JDK8u191后新增了容器支持开关<code>-XX:UseContainerSupport</code>，并且默认开启。<br>
<!-- -->并增加了这些参数：</p>
<ul>
<li>MaxRAMPercentage 堆的最大值百分比。</li>
<li>InitialRAMPercentage 堆的初始化的百分比。</li>
<li>MinRAMPercentage 堆的最小值的百分比。</li>
</ul>
<p>建议使用内存参数参数：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMPercentage</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">70.0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMPercentage</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">50.0</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>计算方法（这里做了简化，实际计算要复杂些）：<br>
<code>最大堆大小 = MaxRAM（默认为容器最大可使用内存） * MaxRAMPercentage / 100</code>。</p>
<p>注意：如果使用了-Xmx参数，则不会进入上面的堆大小的计算逻辑，而直接将MaxHeapSize（最大堆大小）等同于我们设置的-Xmx。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="openjdk相关源码解读">OpenJDK相关源码解读<a href="https://blog.teaho.net/article/java-container-args#openjdk%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB" class="hash-link" aria-label="Direct link to OpenJDK相关源码解读" title="Direct link to OpenJDK相关源码解读">​</a></h2>
<p>我对相关方法做了注释。</p>
<p><code>osContainer_linux.cpp</code>是linux的容器信息的读取和计算的类。里面有如下方法：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">/* init</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)"> *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)"> * Initialize the container support and determine if</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)"> * we are running under cgroup control.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)"> *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)"> * 容器环境下的初始化和判定</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)"> *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">OSContainer</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token function" style="color:hsl(207, 82%, 66%)">init</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  int mountid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  int parentid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  int major</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  int minor</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token constant" style="color:hsl(29, 54%, 61%)">FILE</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">mntinfo </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token constant" style="color:hsl(29, 54%, 61%)">FILE</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">cgroup </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  char buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAXPATHLEN</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  char tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAXPATHLEN</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  char tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAXPATHLEN</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  char tmpbase</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAXPATHLEN</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  char </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//是否已经初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token function" style="color:hsl(207, 82%, 66%)">assert</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token plain">_is_initialized</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"Initializing OSContainer more than once"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  _is_initialized </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  _is_containerized </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">false</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//修正_unlimited_memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  _unlimited_memory </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">LONG_MAX</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> os</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token function" style="color:hsl(207, 82%, 66%)">vm_page_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"> os</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token function" style="color:hsl(207, 82%, 66%)">vm_page_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"OSContainer::init: Initializing Container Support"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//UseContainerSupport没有打开则跳出去</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UseContainerSupport</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Container Support not enabled"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * 找到cgroup的挂载点信息</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * Find the cgroup mount point for memory and cpuset</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * by reading /proc/self/mountinfo</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * Example for docker:</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * 219 214 0:29 /docker/7208cebd00fa5f2e342b1094f7bed87fa25661471a4637118e65f1c995be8a34 /sys/fs/cgroup/memory ro,nosuid,nodev,noexec,relatime - cgroup cgroup rw,memory</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * Example for host:</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * 34 28 0:29 / /sys/fs/cgroup/memory rw,nosuid,nodev,noexec,relatime shared:16 - cgroup cgroup rw,memory</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  mntinfo </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">fopen</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"/proc/self/mountinfo"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"r"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">mntinfo </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Can't open /proc/self/mountinfo, %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                       </span><span class="token function" style="color:hsl(207, 82%, 66%)">strerror</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">errno</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">fgets</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAXPATHLEN</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> mntinfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Look for the filesystem type and see if it's cgroup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    char fstype</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAXPATHLEN</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    fstype</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">'\0'</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    char </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">s </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">  </span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">" - "</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">s </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">sscanf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">" - %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> fstype</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">strcmp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">fstype</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cgroup"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"memory"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        int matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">sscanf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"%d %d %d:%d %s %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">mountid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">parentid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">major</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">minor</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">6</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">         </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//内存信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          memory </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CgroupSubsystem</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Incompatible str containing cgroup and memory: %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpuset"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        int matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">sscanf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"%d %d %d:%d %s %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">mountid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">parentid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">major</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">minor</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">6</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//cpuset: 用来绑定cgroup到指定CPU的哪个核上和NUMA节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          cpuset </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CgroupSubsystem</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Incompatible str containing cgroup and cpuset: %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpu,cpuacct"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">||</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpuacct,cpu"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        int matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">sscanf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"%d %d %d:%d %s %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">mountid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">parentid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">major</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">minor</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">6</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//cpu：用来限制cgroup的CPU使用率</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          cpu </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CgroupSubsystem</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//cpuacct: 用来统计cgroup的CPU的使用率</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          cpuacct </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CgroupSubsystem</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Incompatible str containing cgroup and cpu,cpuacct: %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpuacct"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        int matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">sscanf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"%d %d %d:%d %s %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">mountid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">parentid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">major</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">minor</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">6</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          cpuacct </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CgroupSubsystem</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Incompatible str containing cgroup and cpuacct: %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpu"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        int matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">sscanf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"%d %d %d:%d %s %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">mountid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">parentid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">major</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">minor</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                             tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">matched </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">6</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          cpu </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">CgroupSubsystem</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">tmproot</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> tmpmount</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Incompatible str containing cgroup and cpu: %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token function" style="color:hsl(207, 82%, 66%)">fclose</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">mntinfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">memory </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Required cgroup memory subsystem not found"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">cpuset </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Required cgroup cpuset subsystem not found"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">cpu </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Required cgroup cpu subsystem not found"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">cpuacct </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Required cgroup cpuacct subsystem not found"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/*</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * Read /proc/self/cgroup and map host mount point to</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * local one via /proc/self/mountinfo content above</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * 读取 /proc/self/cgroup 并通过上面的 /proc/self/mountinfo 内容将本容器的各cgroup子系统的值映射到JVM变量上</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * Docker example:</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * 5:memory:/docker/6558aed8fc662b194323ceab5b964f69cf36b3e8af877a14b80256e93aecb044</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * Host example:</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * 5:memory:/user.slice</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * Construct a path to the process specific memory and cpuset</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * cgroup directory.</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * For a container running under Docker from memory example above</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * the paths would be:</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * /sys/fs/cgroup/memory</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * For a Host from memory example above the path would be:</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   * /sys/fs/cgroup/memory/user.slice</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  cgroup </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">fopen</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"/proc/self/cgroup"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"r"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">cgroup </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintContainerInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Can't open /proc/self/cgroup, %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                     </span><span class="token function" style="color:hsl(207, 82%, 66%)">strerror</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">errno</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">fgets</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAXPATHLEN</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> cgroup</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    int cgno</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    int matched</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    char </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">controller</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    char </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/* Skip cgroup number */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token function" style="color:hsl(207, 82%, 66%)">strsep</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">":"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">/* Get controller and base */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    controller </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">strsep</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">":"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    base </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">strsep</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"\n"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">controller </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"memory"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        memory</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_subsystem_path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpuset"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        cpuset</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_subsystem_path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpu,cpuacct"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">||</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpuacct,cpu"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        cpu</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_subsystem_path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        cpuacct</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_subsystem_path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpuacct"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        cpuacct</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_subsystem_path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">strstr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"cpu"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        cpu</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_subsystem_path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token function" style="color:hsl(207, 82%, 66%)">fclose</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">cgroup</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// We need to update the amount of physical memory now that</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// command line arguments have been processed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 读取cgroup的内存绑定点(/memory.limit_in_bytes)的内存限制值，并设置到JVM全局的物理内存大小变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">mem_limit </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">memory_limit_in_bytes</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">os</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Linux</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_physical_memory</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">mem_limit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  _is_containerized </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>arguments.cpp</code>是对我们各种JVM参数做解析和设置的类，这里，我分析下set_heap_size（设置堆大小）这一方法。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">Arguments</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token function" style="color:hsl(207, 82%, 66%)">set_heap_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">DefaultMaxRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Deprecated flag</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_SET_CMDLINE</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uintx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">DefaultMaxRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//如果设置了MaxRAM，则使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  julong phys_mem </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAM</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">?</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MIN2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">os</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token function" style="color:hsl(207, 82%, 66%)">physical_memory</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAM</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                            </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAM</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Experimental support for CGroup memory limits</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//如果开启了UseCGroupMemoryLimitForHeap，则读取cgroup的内存，此选项已是deprecate选项</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UseCGroupMemoryLimitForHeap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// This is a rough indicator that a CGroup limit may be in force</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// for this process</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">const</span><span class="token plain"> char</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"> lim_file </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"/sys/fs/cgroup/memory/memory.limit_in_bytes"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token constant" style="color:hsl(29, 54%, 61%)">FILE</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">fp </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">fopen</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">lim_file</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"r"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">fp </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">NULL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      julong cgroup_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      int ret </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">fscanf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">JULONG_FORMAT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain">cgroup_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">ret </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"> cgroup_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// If unlimited, cgroup_max will be a very large, but unspecified</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// value, so use initial phys_mem as a limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintGCDetails</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Verbose</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Cannot use gclog_or_tty yet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">          tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Setting phys_mem to the min of cgroup limit ("</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        </span><span class="token constant" style="color:hsl(29, 54%, 61%)">JULONG_FORMAT</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"MB) and initial phys_mem ("</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                        </span><span class="token constant" style="color:hsl(29, 54%, 61%)">JULONG_FORMAT</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"MB)"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> cgroup_max</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token constant" style="color:hsl(29, 54%, 61%)">M</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> phys_mem</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token constant" style="color:hsl(29, 54%, 61%)">M</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//取cpgroup_max（有可能没限制）和物理内存的最小值</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        phys_mem </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MIN2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">cgroup_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> phys_mem</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">warning</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Unable to read/parse cgroup memory limit from %s: %s"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                lim_file</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> errno </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">?</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">strerror</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">errno</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"unknown error"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token function" style="color:hsl(207, 82%, 66%)">fclose</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token function" style="color:hsl(207, 82%, 66%)">warning</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Unable to open cgroup memory limit file %s (%s)"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> lim_file</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">strerror</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">errno</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Convert Fraction to Precentage values</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//注：MaxRAMFraction、MinRAMFraction、InitialRAMFraction皆为deprecate参数，不建议使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMPercentage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMPercentage</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">100.0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MinRAMPercentage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MinRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">     </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MinRAMPercentage</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">100.0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MinRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMPercentage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">     </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMPercentage</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">100.0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMFraction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// If the maximum heap size has not been set with -Xmx,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// then set it as fraction of the size of physical memory,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// respecting the maximum and minimum sizes of the heap.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//如果没有设置Xmx，则进入MaxHeapSize计算逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    julong reasonable_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">phys_mem </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxRAMPercentage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">100</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">const</span><span class="token plain"> julong reasonable_min </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">phys_mem </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MinRAMPercentage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">100</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_min </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Small physical memory, so use a minimum fraction of it for the heap</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> reasonable_min</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Not-small physical memory, so require a heap at least</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// as large as MaxHeapSize</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAX2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ErgoHeapSizeLimit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ErgoHeapSizeLimit</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Limit the heap size to ErgoHeapSizeLimit</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MIN2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ErgoHeapSizeLimit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UseCompressedOops</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Limit the heap size to the maximum possible when using compressed oops</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      julong max_coop_heap </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token function" style="color:hsl(207, 82%, 66%)">max_heap_for_compressed_oops</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HeapBaseMinAddress</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain"> max_coop_heap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Heap should be above HeapBaseMinAddress to get zero based compressed oops</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// but it should be not less than default MaxHeapSize.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        max_coop_heap </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HeapBaseMinAddress</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MIN2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> max_coop_heap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    reasonable_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">limit_by_allocatable_memory</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_IS_DEFAULT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// An initial heap size was specified on the command line,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// so be sure that the maximum size is consistent.  Done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// after call to limit_by_allocatable_memory because that</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// method might reduce the allocation size.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_max </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAX2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintGCDetails</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Verbose</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Cannot use gclog_or_tty yet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"  Maximum heap size "</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">SIZE_FORMAT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> reasonable_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_SET_ERGO</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uintx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uintx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">reasonable_max</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// If the minimum or initial heap_size have not been set or requested to be set</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// ergonomically, set them accordingly.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//如果InitialHeapSize或min_heap_size没有设置，则进入计算逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialHeapSize</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">||</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">min_heap_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    julong reasonable_minimum </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">OldSize</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">NewSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    reasonable_minimum </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MIN2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_minimum</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    reasonable_minimum </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">limit_by_allocatable_memory</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_minimum</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialHeapSize</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      julong reasonable_initial </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">phys_mem </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialRAMPercentage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">100</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_initial </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAX3</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_initial</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> reasonable_minimum</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token function" style="color:hsl(207, 82%, 66%)">min_heap_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_initial </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">MIN2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_initial</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">julong</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MaxHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      reasonable_initial </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">limit_by_allocatable_memory</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">reasonable_initial</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintGCDetails</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Verbose</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Cannot use gclog_or_tty yet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"  Initial heap size "</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">SIZE_FORMAT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uintx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">reasonable_initial</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token constant" style="color:hsl(29, 54%, 61%)">FLAG_SET_ERGO</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uintx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uintx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">reasonable_initial</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 没设置-Xms，最小heapSize使用InitialHeapSize</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">min_heap_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token function" style="color:hsl(207, 82%, 66%)">set_min_heap_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MIN2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uintx</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">reasonable_minimum</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialHeapSize</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">PrintGCDetails</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Verbose</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// Cannot use gclog_or_tty yet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        tty</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token function" style="color:hsl(207, 82%, 66%)">print_cr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"  Minimum heap size "</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">SIZE_FORMAT</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">min_heap_size</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">reference<a href="https://blog.teaho.net/article/java-container-args#reference" class="hash-link" aria-label="Direct link to reference" title="Direct link to reference">​</a></h2>
<p>[1]<a href="http://hg.openjdk.java.net/jdk/jdk11/file/1ddf9a99e4ad/src/hotspot/share/runtime/arguments.cpp#l1750" target="_blank" rel="noopener noreferrer">java11 arguments.cpp</a><br>
<!-- -->[2]<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener noreferrer">java|Java Platform, Standard Edition Tools Reference</a><br>
<!-- -->[3]<a href="https://lessisbetter.site/2020/09/01/cgroup-3-cpu-md/" target="_blank" rel="noopener noreferrer">Cgroup - cpu, cpuacct, cpuset子系统|大彬</a><br>
<!-- -->[4]<a href="https://bugs.openjdk.java.net/browse/JDK-8146115" target="_blank" rel="noopener noreferrer">JDK-8146115</a><br>
<!-- -->[5]<span style="display:inline-flex;gap:0.25rem"><span></span><a href="https://github.com/AdoptOpenJDK/openjdk-jdk8u" target="_blank" rel="noopener noreferrer">github-openjdk-jdk8u</a></span><br>
<!-- -->[6]<a href="https://man7.org/linux/man-pages/man5/proc.5.html" target="_blank" rel="noopener noreferrer">proc(5) — Linux manual page</a><br>
<!-- -->[7]<a href="https://www.kernel.org/doc/Documentation/filesystems/proc.txt" target="_blank" rel="noopener noreferrer">/proc FILESYSTEM</a><br>
<!-- -->[8]<a href="https://tech.meituan.com/2015/03/31/cgroups.html" target="_blank" rel="noopener noreferrer">Linux资源管理之cgroups简介|大龙，志超</a></p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="java" term="java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Java模块化]]></title>
        <id>https://blog.teaho.net/article/java-modular</id>
        <link href="https://blog.teaho.net/article/java-modular"/>
        <updated>2021-09-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[JEP 261:Module System(模块系统)]]></summary>
        <content type="html"><![CDATA[<p>分析JEP 261: Module System(模块系统)。</p>
<br>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="一个java文件的执行周期">一个java文件的执行周期<a href="https://blog.teaho.net/article/java-modular#%E4%B8%80%E4%B8%AAjava%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%A7%EF%BF%BD%EF%BF%BD%E8%A1%8C%E5%91%A8%E6%9C%9F" class="hash-link" aria-label="Direct link to 一个java文件的执行周期" title="Direct link to 一个java文件的执行周期">​</a></h3>
<p>在设计模块化时，JDK的开发者们为Java在编译期和运行期之间引入了一个新的phase--链接期。这是一个可选的phase。</p>
<p><img loading="lazy" alt="modular_phase.jpg" src="data:image/jpeg;base64,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9Ty+7AA1pC1Dx3H9X3PU8vuw8dx/V9z1PL7sADWkLUPHKFnus1Vy4s/MnxXIRr960EkvvMSFPTz5M9u6umEscAR+CRN4lKaUotFOLUXNv6GZERGZERnzmZ8wBddEYaGJlq1P9XwXdnv6dxx4upKmrY95YwAB6crQAAAAAAAAAAAAAAA1LlOD3+NW827xOrVa1Fi8qVJrWFJTIiyFnq66zvmSXELMzWpGpKJRqNO9vbpAGupTVRZM68HiqmFqZw7+DT5MgDyIknuu4xl6FF508VrJWh/1SwZH9xmPzjI30by/snae7gAq8z2apprMcZG+jeX9k7T3cOMjfRvL+ydp7uABcydNDjI30by/snae7hxkb6N5f2TtPdwALmNNDjI30by/snae7hxkb6N5f2TtPdwALmNNDjI30by/snae7hxkb6N5f2TtPdwALmNNDjI30by/snae7hxkb6N5f2TtPdwALmNNDjI30by/snae7hxkb6N5f2TtPdwALmNNGTEj5jlKvAcYxuwr0ucy7O4hriMxy/7iZdJLzqvmSSSSZlzqSNs4xi1VilDEoK9o1tRUnq46RG484pRrcdWfpUtalKP+KjABYYemkr+9nlulMVUnUdDlGL9/zZ//2Q==" width="571" height="72" class="img_zKyM"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="模块化的使用">模块化的使用<a href="https://blog.teaho.net/article/java-modular#%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="Direct link to 模块化的使用" title="Direct link to 模块化的使用">​</a></h3>
<p>先跟随一个简单的模块化demo来直观感受一下模块化。</p>
<p>目录如下：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">java9</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">system</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">demo$ tree </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token property-access">├──</span><span class="token plain"> moduleA</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; ├── moduleA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">iml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; ├── module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">info</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; └── net</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;     └── teaho</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;         └── demo</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;             └── java9</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;                 └── modular</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;                     └── a</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;                         └── </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Invoker</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">├── moduleB</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; ├── moduleB</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">iml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; ├── module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">info</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; └── net</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;     └── teaho</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;         └── demo</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;             └── java9</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;                 └── modular</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;                     └── b</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp;                         └── </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">EchoService</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">├── build_module</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">├── link_module</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">├── package_module</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">├── </span><span class="token constant" style="color:hsl(29, 54%, 61%)">README</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">└── run_module</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="编译">编译<a href="https://blog.teaho.net/article/java-modular#%E7%BC%96%E8%AF%91" class="hash-link" aria-label="Direct link to 编译" title="Direct link to 编译">​</a></h4>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">rm </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">rf build</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">javac </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">d build </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">source</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">path </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain"> </span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">$</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">find </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">name </span><span class="token string" style="color:hsl(95, 38%, 62%)">'*.java'</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>--module-source-path</code> 制定寻找模块源文件（.java）的目录。</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="运行">运行<a href="https://blog.teaho.net/article/java-modular#%E8%BF%90%E8%A1%8C" class="hash-link" aria-label="Direct link to 运行" title="Direct link to 运行">​</a></h4>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">java </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">path build </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">m moduleA</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">net</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">teaho</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">demo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java9</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">modular</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">a</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Invoker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">output</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">echo</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Invoke</span><span class="token plain"> </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">from</span><span class="token plain"> module </span><span class="token constant" style="color:hsl(29, 54%, 61%)">A</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="打包">打包<a href="https://blog.teaho.net/article/java-modular#%E6%89%93%E5%8C%85" class="hash-link" aria-label="Direct link to 打包" title="Direct link to 打包">​</a></h4>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">bash </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">build_module</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">mkdir build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jar</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jar </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">create </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">file</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jar</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleB</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jar</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">version</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">1.0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">C</span><span class="token plain"> build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleB </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token property-access">jar</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">create </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">file</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jar</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jar</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">version</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">1.0</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">main</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">net</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">teaho</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">demo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java9</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">modular</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">a</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Invoker</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">C</span><span class="token plain"> build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleA </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token property-access">mkdir</span><span class="token plain"> build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jmod</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jmod create </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">path build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleB build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jmod</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleB</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jmod</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jmod create </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">path build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleA build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jmod</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jmod</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面命令分别打了jar包和jmod包。分别打了如下包：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">├── build</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; ├── jar</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── moduleA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jar</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; └── moduleB</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jar</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; ├── jmod</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── moduleA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jmod</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; └── moduleB</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jmod</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>jmod包的特点：</p>
<ul>
<li>新的jmod文件格式是在jar文件格式之上，囊括上native代码，配置文件和其他数据文件等一些不适合放在先有JAR文件格式的资源。</li>
<li>jmod文件可用在编译期、链接期，但不能用于运行时。</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="链接">链接<a href="https://blog.teaho.net/article/java-modular#%E9%93%BE%E6%8E%A5" class="hash-link" aria-label="Direct link to 链接" title="Direct link to 链接">​</a></h4>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jlink </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">verbose </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">path build </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">add</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">modules moduleB</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">base</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">output build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleApp</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们执行jlink命令，输出了如下文件：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; ├── moduleApp</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── bin</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── java</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── keytool</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── conf</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── net</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── security</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">security</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     └── policy</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;         ├── limited</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;         │&nbsp;&nbsp; ├── default_local</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;         │&nbsp;&nbsp; ├── default_US_export</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;         │&nbsp;&nbsp; └── exempt_local</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;         ├── </span><span class="token constant" style="color:hsl(29, 54%, 61%)">README</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;         └── unlimited</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;             ├── default_local</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;             └── default_US_export</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── include</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── classfile_constants</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">h</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── jni</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">h</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── jvmticmlr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">h</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── jvmti</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">h</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── linux</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     └── jni_md</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">h</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── legal</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">base</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── </span><span class="token constant" style="color:hsl(29, 54%, 61%)">ADDITIONAL_LICENSE_INFO</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── aes</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── asm</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── </span><span class="token constant" style="color:hsl(29, 54%, 61%)">ASSEMBLY_EXCEPTION</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── cldr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── c</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">libutl</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── icu</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── </span><span class="token constant" style="color:hsl(29, 54%, 61%)">LICENSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     ├── public_suffix</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp;     └── unicode</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">md</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── lib</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── classlist</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── jexec</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── jli</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── libjli</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── jrt</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">fs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jar</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── jvm</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">cfg</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libjava</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libjimage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libjsig</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libnet</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libnio</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libverify</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libzip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── modules</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── security</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── blacklisted</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">certs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── cacerts</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">default</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── public_suffix_list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">dat</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── server</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libjsig</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; ├── libjvm</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">so</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Xusage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; │&nbsp;&nbsp; └── tzdb</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">dat</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">│&nbsp;&nbsp; │&nbsp;&nbsp; └── release</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>输出了一个小型jre（Java Runtime Environment）。
我们来看看这个jre有什么特别。</p>
<ol>
<li>大小</li>
</ol>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">$ du </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">sh moduleApp</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">48M     moduleApp</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">$ du </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">sh </span><span class="token operator" style="color:hsl(207, 82%, 66%)">~</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Env</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jdk</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token number" style="color:hsl(29, 54%, 61%)">11</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">297M    </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">home</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">teaho</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Env</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jdk</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token number" style="color:hsl(29, 54%, 61%)">11</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">$ du </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">sh </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">usr</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">lib</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jvm</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">java</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token number" style="color:hsl(29, 54%, 61%)">8</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">openjdk</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">amd64</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jre</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">119M    </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">usr</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">lib</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jvm</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">java</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token number" style="color:hsl(29, 54%, 61%)">8</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">openjdk</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">amd64</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jre</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们打包出来的jre才48M而一般jre有119M，更别说jdk了。<br>
<!-- -->我们看看有哪些模块：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">$ </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleApp</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">bin</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">java </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">list</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">modules</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">base</span><span class="token plain">@</span><span class="token number" style="color:hsl(29, 54%, 61%)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">moduleB</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>有Java11的java.base和我们编写的moduleB。</p>
<ol start="2">
<li>只有java、keytool两个工具，我们用这个小型jre运行下代码</li>
</ol>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">$ </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">build</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">moduleApp</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">bin</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">java </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">path build </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">m moduleA</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">net</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">teaho</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">demo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java9</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">modular</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">a</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Invoker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">echo</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Invoke</span><span class="token plain"> </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">from</span><span class="token plain"> module </span><span class="token constant" style="color:hsl(29, 54%, 61%)">A</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="作用及应用场景">作用及应用场景<a href="https://blog.teaho.net/article/java-modular#%E4%BD%9C%E7%94%A8%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" class="hash-link" aria-label="Direct link to 作用及应用场景" title="Direct link to 作用及应用场景">​</a></h3>
<p>Java的百兆级JDK和JRE一直以来受人诟病。当时外界猜测跳票了这么多年的模块化特性是为了抢占嵌入式和物联网（IOT）的市场，
我个人觉得目的确实是这样的，当然它带来的好处不仅在IOT。</p>
<p>因为以前Java的lib的依赖关系是杂乱无章的。<br>
<img loading="lazy" src="https://blog.teaho.net/assets/images/before_modular-6a2271c07a22ba92f89d8028692bf8c7.jpg" width="720" height="469" class="img_zKyM"></p>
<p>而Java9引入模块化后，它的依赖关系清晰了很多。<br>
<img loading="lazy" src="https://blog.teaho.net/assets/images/after_modular-a4364970dde05420f7ab20b395c57c1a.jpg" width="913" height="426" class="img_zKyM"></p>
<p>这是因为它通过module-info.java文件来强制控制了模块中类的访问能力，这有别于以往只要是public的类都能访问的机制。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="应用场景">应用场景<a href="https://blog.teaho.net/article/java-modular#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" class="hash-link" aria-label="Direct link to 应用场景" title="Direct link to 应用场景">​</a></h4>
<ul>
<li>有助于嵌入式、物联网开发</li>
<li>为基础平台（框架层面）的开发提供便利</li>
</ul>
<p>对于一般的应用来说，帮助没有想象中大。
当然目前Java也是支持原来的非模块化的开发方式的。（就是我们可以选择无视module-info.java文件）</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="module-infojava文件">module-info.java文件<a href="https://blog.teaho.net/article/java-modular#module-infojava%E6%96%87%E4%BB%B6" class="hash-link" aria-label="Direct link to module-info.java文件" title="Direct link to module-info.java文件">​</a></h3>
<p>Java语言规范（The Java Language Specification）有如下例子：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">open module com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> requires com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">http</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> requires java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">logging</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> requires transitive com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">network</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> exports com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">bar</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> exports com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">internal</span><span class="token plain"> to com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">probe</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> uses com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">spi</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Intf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"> provides com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">spi</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Intf</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">with</span><span class="token plain"> com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">example</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">foo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Impl</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>各个关键字的意思如下：</p>
<ul>
<li>module名</li>
</ul>
<blockquote>
<p>Module names, like package names, must not conflict. The recommended way to name a module is to use the reverse-domain-name pattern that has long been recommended for naming packages.</p>
</blockquote>
<ul>
<li>open关键字<br>
<!-- -->声明在<code>module</code>前，说明该模块导出的功能可见度是最高的。</li>
<li>exports关键字<br>
<!-- -->语法：<!-- -->
<ul>
<li>导出某块<code>exports &lt;package&gt;;</code></li>
<li>导出某块到某些模块<code>exports &lt;package&gt; to &lt;module1&gt;, &lt;module2&gt;...;</code></li>
</ul>
</li>
<li>opens关键字<br>
<!-- -->opens类似于open<!-- -->
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">module </span><span class="token constant" style="color:hsl(29, 54%, 61%)">N</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  exports com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jdojo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">claim</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">model</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  opens com</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jdojo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">claim</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">model</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>requires关键字<br>
<!-- -->表示当前模块依赖那些模块。</li>
</ul>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">requires </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">requires transitive </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//加了transitive的作用：https://stackoverflow.com/questions/46502453/whats-the-difference-between-requires-and-requires-transitive-statements-in-jav</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">requires </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain">   </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//加了static的作用：https://stackoverflow.com/questions/46537294/whats-the-difference-between-requires-and-requires-static-in-module-declaration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">requires transitive </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">requires </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//https://openjdk.java.net/projects/jigsaw/spec/sotms/#defining-modules 第2.2点</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>uses与provider关键字<br>
<!-- -->Java允许使用服务提供者和服务使用者分离的服务提供者机制。 JDK 9允许使用语句（uses statement）和提供语句（provides statement）实现其服务。<br>
<!-- -->使用语句可以指定服务接口的名字，当前模块就会发现它，使用 java.util.ServiceLoader类进行加载。<br>
<!-- -->例子如下：<!-- -->
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">java base的module</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">info有如下语句：</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    uses sun</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">spi</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">CalendarProvider</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    provides java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">nio</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">file</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">spi</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">FileSystemProvider</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">with</span><span class="token plain"> jdk</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">internal</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">jrtfs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">JrtFileSystemProvider</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">//可以这样使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ServiceLoader</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">FileSystemProvider</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> service </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ServiceLoader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">load</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">FileSystemProvider</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">service</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">xxxxx</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="其他特点简单罗列">其他特点简单罗列<a href="https://blog.teaho.net/article/java-modular#%E5%85%B6%E4%BB%96%E7%89%B9%E7%82%B9%E7%AE%80%E5%8D%95%E7%BD%97%E5%88%97" class="hash-link" aria-label="Direct link to 其他特点简单罗列" title="Direct link to 其他特点简单罗列">​</a></h3>
<ol>
<li>关于不加上版本控制的原因：</li>
</ol>
<blockquote>
<p>It is not a goal of the module system to solve the version-selection problem, which is best left to build tools and container applications.</p>
</blockquote>
<ol start="2">
<li>一个模块化jar文件能够被识别为模块，同时也能被放置在以往的class path（此时module-info文件会被忽略）。</li>
<li>module-info文件中的信息能够在编译和运行时通过模块的反射机制被读取、探测到。</li>
<li>将模块声明文件（module-info.java）编译成类文件（.class）的一个优点是类文件已经具有精确定义和可扩展的格式。</li>
<li>将从类路径加载的类型视为未命名模块的成员，这允许我们以增量、自底向上的方式将现有应用程序的组件从 JAR 文件迁移到模块。
例如，假设上面显示的应用程序最初是为 Java SE 8 构建的，作为放置在类路径上的一组名称相似的 JAR 文件。 如果我们在 Java SE 9 上按原样运行它，那么 JAR 文件中的类型将在未命名模块中定义。</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">reference<a href="https://blog.teaho.net/article/java-modular#reference" class="hash-link" aria-label="Direct link to reference" title="Direct link to reference">​</a></h2>
<p>[1]<a href="https://docs.oracle.com/javase/9/tools/tools-and-command-reference.htm#JSWOR596" target="_blank" rel="noopener noreferrer">Java Platform, Standard Edition Tools Reference</a><br>
<!-- -->[2]<a href="https://darian1996.github.io/2020/05/27/Java9-%E6%A8%A1%E5%9D%97%E5%8C%96/" target="_blank" rel="noopener noreferrer">Java9 模块化|darian1996</a><br>
<!-- -->[3]<a href="http://cr.openjdk.java.net/~mr/jigsaw/spec/java-se-9-jls-diffs.pdf" target="_blank" rel="noopener noreferrer">The Java® Language Specification|Java SE 9 Edition</a><br>
<!-- -->[4]<a href="https://openjdk.java.net/jeps/261" target="_blank" rel="noopener noreferrer">JEP 261: Module System</a><br>
<!-- -->[5]<a href="https://stackoverflow.com/questions/44732915/why-did-java-9-introduce-the-jmod-file-format" target="_blank" rel="noopener noreferrer">why-did-java-9-introduce-the-jmod-file-format|stackoverflow.com</a></p>
<p>其他参考：</p>
<p><a href="https://www.jdon.com/49683" target="_blank" rel="noopener noreferrer">真棒：使用Java 11实现应用的模块化|banq</a></p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="java" term="java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Java11特性分析]]></title>
        <id>https://blog.teaho.net/article/java11-feature</id>
        <link href="https://blog.teaho.net/article/java11-feature"/>
        <updated>2021-09-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Java11是Java8后的第一个LTS版本，分析下OpenJDK的特性列表。]]></summary>
        <content type="html"><![CDATA[<p>自Java11起，Oracle JDK将不再免费提供商业用途。</p>
<p>Java11是Java8后的第一个LTS版本，我们对OpenJDK的特性列表做一些分析。</p>
<br>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="简介">简介<a href="https://blog.teaho.net/article/java11-feature#%E7%AE%80%E4%BB%8B" class="hash-link" aria-label="Direct link to 简介" title="Direct link to 简介">​</a></h2>
<p>以下是Java11的特性清单：</p>
<ol>
<li>181: Nest-Based Access Control（基于嵌套的访问控制）</li>
<li>309: Dynamic Class-File Constants（动态的类文件常量）</li>
<li>315: Improve Aarch64 Intrinsics（优化Aarch64内在函数）</li>
<li>318: Epsilon: A No-Op Garbage Collector（一个无操作垃圾收集器）</li>
<li>320: Remove the Java EE and CORBA Modules（移除Java EE和CORBA模块）</li>
<li>321: HTTP Client (Standard) （HTTP Client API）</li>
<li>323: Local-Variable Syntax for Lambda Parameters (lambda参数的局部变量语法)</li>
<li>324: Key Agreement with Curve25519 and Curve448</li>
<li>327: Unicode 10 (对unicode10的支持)</li>
<li>328: Flight Recorder(飞行记录器)</li>
<li>329: ChaCha20 and Poly1305 Cryptographic Algorithms</li>
<li>330: Launch Single-File Source-Code Programs （运行单文件程序）</li>
<li>331: Low-Overhead Heap Profiling</li>
<li>332: Transport Layer Security (TLS) 1.3</li>
<li>333: ZGC: A Scalable Low-Latency Garbage Collector (Experimental)</li>
<li>335: Deprecate the Nashorn JavaScript Engine (弃用Nashron)</li>
<li>336: Deprecate the Pack200 Tools and API</li>
</ol>
<p>提出问题：</p>
<ol>
<li>那些是日常会用到的？重点是？</li>
</ol>
<p>代码及完整文件地址：<br>
<span style="display:inline-flex;gap:0.25rem"><span></span><a href="https://github.com/teaho2015-blog/java11-feature-learning" target="_blank" rel="noopener noreferrer">https://github.com/teaho2015-blog/java11-feature-learning</a></span></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="181-nest-based-access-control基于嵌套的访问控制">181: Nest-Based Access Control（基于嵌套的访问控制）<a href="https://blog.teaho.net/article/java11-feature#181-nest-based-access-control%E5%9F%BA%E4%BA%8E%E5%B5%8C%E5%A5%97%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6" class="hash-link" aria-label="Direct link to 181: Nest-Based Access Control（基于嵌套的访问控制）" title="Direct link to 181: Nest-Based Access Control（基于嵌套的访问控制）">​</a></h2>
<p>我们先看一个例子：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">JEP181</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Nest1</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">private</span><span class="token plain"> int varNest1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">f</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            final </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Nest2</span><span class="token plain"> nest2 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Nest2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//这里没问题</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            nest2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">varNest2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            final </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Field</span><span class="token plain"> f2 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Nest2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getDeclaredField</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"varNest2"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">           </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//这里在java8环境下会报错，在java11中是没问题的</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            f2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">setInt</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">nest2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">nest2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">varNest2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Nest2</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">private</span><span class="token plain"> int varNest2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">main</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Nest1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">f</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该改动要解决的问题：</p>
<ol>
<li>
<p>Java语言规范允许在同一个源文件中编写多个类。对于用户的角度来说，在同一个类文件里的class应该共享同样的访问控制体系。
为了达到目的，编译器需要经常需要通过附加的access bridge扩大private成员的访问权限到package。
这种bridge和封装相违背，并且轻微的增加程序的大小，会干扰用户和工具。</p>
</li>
<li>
<p>还有一个问题是反射与源码调用不一致。当使用java.lang.reflect.Method.invoke从一个nestmate调用另一个nestmate私有方法时会报IllegalAccessError错误。
这个是让人不能理解的，因为反射应该和源码级访问拥有相同权限。</p>
</li>
</ol>
<p>现有情况：<br>
<!-- -->现有的类文件格式定义了 InnerClasses 和 EnclosureMethod 属性（JVMS 4.7.6 和 4.7.7），以允许 Java 源代码编译器（如 javac）具体化源级嵌套关系。
每个嵌套类型都编译为它自己的类文件，不同的类文件通过这些属性的值“链接”。<br>
<!-- -->虽然这些属性足以让 JVM 确定嵌套关系，但它们并不直接适用于访问控制，并且本质上与单个 Java 语言概念相关联。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="jvm对嵌套成员的访问控制改动">JVM对嵌套成员的访问控制改动<a href="https://blog.teaho.net/article/java11-feature#jvm%E5%AF%B9%E5%B5%8C%E5%A5%97%E6%88%90%E5%91%98%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%94%B9%E5%8A%A8" class="hash-link" aria-label="Direct link to JVM对嵌套成员的访问控制改动" title="Direct link to JVM对嵌套成员的访问控制改动">​</a></h3>
<p>为了允许更广泛、更通用的嵌套概念，而不是简单的 Java 语言嵌套类型，并且为了有效的访问控制检查，建议修改类文件格式以定义两个新属性。
一个嵌套成员（通常是顶级类）被指定为嵌套主机，并包含一个属性 (NestMembers) 来标识其他静态已知的嵌套成员。 每个其他嵌套成员都有一个属性 (NestHost) 来标识其嵌套主机。</p>
<p>我们调整了JVM访问规则，增加了如下条目（to JVMS 5.4.4）：<br>
<!-- -->一个field或method R可以被class或interface D访问，当且仅当如下任一条件为真：</p>
<ul>
<li>……</li>
<li>R是私有的，并且声明在另一个class或interface C中，并且C和D是nestmates</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="嵌套成员反射api">嵌套成员反射API<a href="https://blog.teaho.net/article/java11-feature#%E5%B5%8C%E5%A5%97%E6%88%90%E5%91%98%E5%8F%8D%E5%B0%84api" class="hash-link" aria-label="Direct link to 嵌套成员反射API" title="Direct link to 嵌套成员反射API">​</a></h3>
<p>正因Java引入了新的类文件属性，那么惯常地Java会提供新的反射机制来检查或查询这些属性。</p>
<p>引入了三个方法java.lang.Class: getNestHost, getNestMembers, and isNestmateOf。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="309-dynamic-class-file-constants动态的类文件常量">309: Dynamic Class-File Constants（动态的类文件常量）<a href="https://blog.teaho.net/article/java11-feature#309-dynamic-class-file-constants%E5%8A%A8%E6%80%81%E7%9A%84%E7%B1%BB%E6%96%87%E4%BB%B6%E5%B8%B8%E9%87%8F" class="hash-link" aria-label="Direct link to 309: Dynamic Class-File Constants（动态的类文件常量）" title="Direct link to 309: Dynamic Class-File Constants（动态的类文件常量）">​</a></h2>
<p>扩展 Java 类文件格式以支持新的常量池形式 CONSTANT_Dynamic。<br>
<!-- -->Loading a CONSTANT_Dynamic will delegate creation to a bootstrap method, just as linking an invokedynamic call site delegates linkage to a bootstrap method.</p>
<p>invokedynamic的协议设计者（例如 Java 8 中添加的 LambdaMetafactory）经常需要根据现有常量集对行为进行编码，
这反过来又需要在引导程序本身中进行额外的容易出错的验证和提取逻辑。
更丰富、更灵活、更高度类型化的常量消除了invokedynamic协议开发中的挣扎，并促进和简化了编译器逻辑。</p>
<p>CONSTANT_Dynamic还在发展，未来还有一些工作需要做。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="315-improve-aarch64-intrinsics优化aarch64内在函数">315: Improve Aarch64 Intrinsics（优化Aarch64内在函数）<a href="https://blog.teaho.net/article/java11-feature#315-improve-aarch64-intrinsics%E4%BC%98%E5%8C%96aarch64%E5%86%85%E5%9C%A8%E5%87%BD%E6%95%B0" class="hash-link" aria-label="Direct link to 315: Improve Aarch64 Intrinsics（优化Aarch64内在函数）" title="Direct link to 315: Improve Aarch64 Intrinsics（优化Aarch64内在函数）">​</a></h2>
<p>改进现有的字符串和数组内在函数，并在 AArch64 处理器上为 java.lang.Math 包下的 sin，cos 和 log 函数实现新的内在函数。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="318-epsilon-a-no-op-garbage-collector一个无操作垃圾收集器">318: Epsilon: A No-Op Garbage Collector（一个无操作垃圾收集器）<a href="https://blog.teaho.net/article/java11-feature#318-epsilon-a-no-op-garbage-collector%E4%B8%80%E4%B8%AA%E6%97%A0%E6%93%8D%E4%BD%9C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8" class="hash-link" aria-label="Direct link to 318: Epsilon: A No-Op Garbage Collector（一个无操作垃圾收集器）" title="Direct link to 318: Epsilon: A No-Op Garbage Collector（一个无操作垃圾收集器）">​</a></h2>
<p>Epsilon是一个不收集垃圾的垃圾收集器，开启参数-XX:+UseEpsilonGC。
他的工作是在已分配内存的单个连续块中实现线性分配来工作。
System.gc()对Epsilon是不起作用的。</p>
<p>应用场景：</p>
<ul>
<li>性能测试</li>
<li>内存压力测试</li>
<li>VM interface测试。</li>
<li>寿命极短的工作</li>
<li>Last-drop latency improvements（最后一滴延迟改进）</li>
<li>Last-drop throughput improvements（最后一滴吞吐量改进）</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="320-remove-the-java-ee-and-corba-modules移除java-ee和corba模块">320: Remove the Java EE and CORBA Modules（移除Java EE和CORBA模块）<a href="https://blog.teaho.net/article/java11-feature#320-remove-the-java-ee-and-corba-modules%E7%A7%BB%E9%99%A4java-ee%E5%92%8Ccorba%E6%A8%A1%E5%9D%97" class="hash-link" aria-label="Direct link to 320: Remove the Java EE and CORBA Modules（移除Java EE和CORBA模块）" title="Direct link to 320: Remove the Java EE and CORBA Modules（移除Java EE和CORBA模块）">​</a></h2>
<p>在Java se 9，如下Java EE和CORBA相关模块被标记为deprecated，在Java11如何模块被正式移除</p>
<ul>
<li>java.xml.ws (JAX-WS, plus the related technologies SAAJ and Web Services Metadata)</li>
<li>java.xml.bind (JAXB)</li>
<li>java.activation (JAF)</li>
<li>java.xml.ws.annotation (Common Annotations)</li>
<li>java.corba (CORBA)</li>
<li>java.transaction (JTA)</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="移除原因">移除原因<a href="https://blog.teaho.net/article/java11-feature#%E7%A7%BB%E9%99%A4%E5%8E%9F%E5%9B%A0" class="hash-link" aria-label="Direct link to 移除原因" title="Direct link to 移除原因">​</a></h3>
<p>Java se 6包含了一个完整的Web Service技术栈，为Java开发者提供便利。不过随着发展：</p>
<ul>
<li>这些技术块获得了和Java SE本身并不相关的特性。</li>
<li>这些技术由上游java.net维护。由于必须将 OpenJDK 存储库中的 Java SE 版本与上游存储库中的 Java EE 版本同步，这使得维护存在问题。</li>
<li>开发者可以从上游Java EE自行获取独立版本并通过Endorsed Standards Override Mechanism 部署它们。</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="321-http-client-standard-http-client-api">321: HTTP Client (Standard) （HTTP Client API）<a href="https://blog.teaho.net/article/java11-feature#321-http-client-standard-http-client-api" class="hash-link" aria-label="Direct link to 321: HTTP Client (Standard) （HTTP Client API）" title="Direct link to 321: HTTP Client (Standard) （HTTP Client API）">​</a></h2>
<p>该特性在Java9（jEP110）中是处于孵化状态，Java11正式标准化。</p>
<p>该特性支持HTTP/1.1和HTTP/2。</p>
<p>如下是Http client同步、异步、http2调用的简单demo。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">/**</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * 同步调用 GET</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * </span><span class="token doc-comment comment keyword" style="color:hsl(286, 60%, 67%)">@param</span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)"> </span><span class="token doc-comment comment parameter" style="color:hsl(220, 10%, 40%)">uri</span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * </span><span class="token doc-comment comment keyword" style="color:hsl(286, 60%, 67%)">@throws</span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)"> Exception</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">syncGet</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> uri</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpClient</span><span class="token plain"> client </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">newHttpClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpRequest</span><span class="token plain"> request </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpRequest</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">newBuilder</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">uri</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">URI</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">create</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">build</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpResponse</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> response </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            client</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">send</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpResponse</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">BodyHandlers</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">ofString</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">statusCode</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">body</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">/**</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * 异步调用 GET</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * </span><span class="token doc-comment comment keyword" style="color:hsl(286, 60%, 67%)">@param</span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)"> </span><span class="token doc-comment comment parameter" style="color:hsl(220, 10%, 40%)">uri</span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * </span><span class="token doc-comment comment keyword" style="color:hsl(286, 60%, 67%)">@throws</span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)"> Exception</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">asyncGet</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> uri</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpClient</span><span class="token plain"> client </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">newHttpClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpRequest</span><span class="token plain"> request </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpRequest</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">newBuilder</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">uri</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token constant" style="color:hsl(29, 54%, 61%)">URI</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">create</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">build</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">CompletableFuture</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpResponse</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;&gt;</span><span class="token plain"> responseCompletableFuture </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">sendAsync</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpResponse</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">BodyHandlers</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">ofString</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        responseCompletableFuture</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">whenComplete</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">t </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                t</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">printStackTrace</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">body</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">statusCode</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">join</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">/**</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * 访问 HTTP2 网址</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * </span><span class="token doc-comment comment keyword" style="color:hsl(286, 60%, 67%)">@throws</span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)"> Exception</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">http2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">newBuilder</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">followRedirects</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Redirect</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">NORMAL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">version</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpClient</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">Version</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">HTTP_2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">build</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">sendAsync</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpRequest</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">newBuilder</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">uri</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">URI</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"https://http2.akamai.com/demo"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">GET</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">build</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HttpResponse</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">BodyHandlers</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">ofString</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">whenComplete</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">t </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    t</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">printStackTrace</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">body</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">resp</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">statusCode</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">join</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="323-local-variable-syntax-for-lambda-parameters-lambda参数的局部变量语法">323: Local-Variable Syntax for Lambda Parameters (lambda参数的局部变量语法)<a href="https://blog.teaho.net/article/java11-feature#323-local-variable-syntax-for-lambda-parameters-lambda%E5%8F%82%E6%95%B0%E7%9A%84%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%AF%AD%E6%B3%95" class="hash-link" aria-label="Direct link to 323: Local-Variable Syntax for Lambda Parameters (lambda参数的局部变量语法)" title="Direct link to 323: Local-Variable Syntax for Lambda Parameters (lambda参数的局部变量语法)">​</a></h2>
<p>这是Java11唯一的语言改动。</p>
<p>这里搭配Java10的新特性JEP 286: Local-Variable Type Inference（局部变量类型推断）一起食用。</p>
<p>请看代码 java11目录-&gt;jep323.class 中的demo。</p>
<p><a href="https://openjdk.java.net/projects/amber/LVTIstyle.html" target="_blank" rel="noopener noreferrer">局部变量推断：使用指引|jdk.java.net</a></p>
<p>Java11增加了一点，允许在声明lambda表达式时在表达式的参数使用var。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>作用是什么呢？<br>
<!-- -->为了统一并为了支持lambda参数使用注解</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">@</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">NotNull</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">@</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Number</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="324-key-agreement-with-curve25519-and-curve448">324: Key Agreement with Curve25519 and Curve448<a href="https://blog.teaho.net/article/java11-feature#324-key-agreement-with-curve25519-and-curve448" class="hash-link" aria-label="Direct link to 324: Key Agreement with Curve25519 and Curve448" title="Direct link to 324: Key Agreement with Curve25519 and Curve448">​</a></h2>
<p>实现RFC 7748 <a href="https://datatracker.ietf.org/doc/html/rfc7748#page-14" target="_blank" rel="noopener noreferrer">[link]</a>中所述，使用 Curve25519 和 Curve448 实现密钥协议。</p>
<p>这是一个密码学相关（ECDH密钥合意协议）的变更，更改是java.security包。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="327-unicode-10-对unicode10的支持">327: Unicode 10 (对unicode10的支持)<a href="https://blog.teaho.net/article/java11-feature#327-unicode-10-%E5%AF%B9unicode10%E7%9A%84%E6%94%AF%E6%8C%81" class="hash-link" aria-label="Direct link to 327: Unicode 10 (对unicode10的支持)" title="Direct link to 327: Unicode 10 (对unicode10的支持)">​</a></h2>
<p>Java11实现了9.0，增加了7500字符和六个脚本(Unicode文本集合)，实现了Unicode10因此增加了8518个字符和四个脚本（Unicode文本集合）。</p>
<p><img loading="lazy" alt="unicode10" src="https://blog.teaho.net/assets/images/unicode10-a4c860997b0cee1f5dd3514658444298.png" width="1264" height="1308" class="img_zKyM"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="328-flight-recorder飞行记录器">328: Flight Recorder(飞行记录器)<a href="https://blog.teaho.net/article/java11-feature#328-flight-recorder%E9%A3%9E%E8%A1%8C%E8%AE%B0%E5%BD%95%E5%99%A8" class="hash-link" aria-label="Direct link to 328: Flight Recorder(飞行记录器)" title="Direct link to 328: Flight Recorder(飞行记录器)">​</a></h2>
<p>JDK Flight Recorder 是一个用于收集有关正在运行的 Java 应用程序的诊断和分析数据的系统。<br>
<!-- -->它本身对运行期系统的侵入性很小，同时又能提供相对准确和丰富的运行期信息，以极低的性能开销集成到 Java 虚拟机 (JVM) 中，专为分析重负载的生产环境而设计。</p>
<p>在Java11前Flight Recorder和Java mission Control（JMC）都是商业产品，仅在Oracle JDK可用。那时候可以这样开启：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">java </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnlockCommercialFeatures</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">FlightRecorder</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">MyHelloWorldApp</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在，JFR在OpenJDK 11中是开源的，并且在OpenJDK11/bin文件夹中可用。</p>
<p>指标测量：</p>
<ul>
<li>只有最多1%的性能损耗</li>
<li>未启用时没有可衡量的性能开销</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="功能使用">功能使用<a href="https://blog.teaho.net/article/java11-feature#%E5%8A%9F%E8%83%BD%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="Direct link to 功能使用" title="Direct link to 功能使用">​</a></h3>
<p>相关模块：</p>
<ul>
<li>jdk.jfr：相关API</li>
<li>jdk.management.jfr： for JMX管理</li>
</ul>
<p>飞行记录器在Java11的启动方式：<code> java -XX:StartFlightRecording ...</code>
或通过jcmd的JFR命令来按需产生profiling。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="jmc分析jfr文件">jmc分析jfr文件<a href="https://blog.teaho.net/article/java11-feature#jmc%E5%88%86%E6%9E%90jfr%E6%96%87%E4%BB%B6" class="hash-link" aria-label="Direct link to jmc分析jfr文件" title="Direct link to jmc分析jfr文件">​</a></h4>
<p><img loading="lazy" alt="JMC_analysis_jfrfile.png" src="https://blog.teaho.net/assets/images/JMC_analysis_jfrfile-543dc357da0509bd770cd88d332f4400.png" width="1866" height="1053" class="img_zKyM"></p>
<p>我们能够通过jcmd来生成.jfr文件，并通过JMC分析。
现在Java11不提供JMC了，可以自行安装：<a href="https://jdk.java.net/jmc/8/" target="_blank" rel="noopener noreferrer">jmc release|java.net</a></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="自定义事件及分析">自定义事件及分析<a href="https://blog.teaho.net/article/java11-feature#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E5%8F%8A%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 自定义事件及分析" title="Direct link to 自定义事件及分析">​</a></h4>
<p>我们可以通过API记录和消费自定义事件：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">//继承并定义事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:hsl(29, 54%, 61%)">Label</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Hello World"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:hsl(29, 54%, 61%)">Description</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Helps the programmer getting started"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">HelloWorld</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">extends</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Event</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:hsl(29, 54%, 61%)">Label</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Message"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> message</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">//提交事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">HelloWorld</span><span class="token plain"> event </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">HelloWorld</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">event</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">message</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"hello, world!"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">event</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">commit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">//消费并输出</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Path</span><span class="token plain"> p </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Paths</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"/home/teaho/IdeaProjects/java11-feature-learning/java11/recording.jfr"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">RecordedEvent</span><span class="token plain"> e </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">RecordingFile</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">readAllEvents</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getStartTime</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">" : "</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getValue</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"message"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Exception</span><span class="token plain"> ex</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//do nothing</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">2021</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token number" style="color:hsl(29, 54%, 61%)">08</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">31T08</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token number" style="color:hsl(29, 54%, 61%)">29</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token number" style="color:hsl(29, 54%, 61%)">38</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token plain">948915253Z </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> hello</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> world</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="330-launch-single-file-source-code-programs-运行单文件程序">330: Launch Single-File Source-Code Programs （运行单文件程序）<a href="https://blog.teaho.net/article/java11-feature#330-launch-single-file-source-code-programs-%E8%BF%90%E8%A1%8C%E5%8D%95%E6%96%87%E4%BB%B6%E7%A8%8B%E5%BA%8F" class="hash-link" aria-label="Direct link to 330: Launch Single-File Source-Code Programs （运行单文件程序）" title="Direct link to 330: Launch Single-File Source-Code Programs （运行单文件程序）">​</a></h2>
<p>对于如下该代码，</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Main</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">main</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token parameter known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token parameter punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token parameter punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"hey yo! This is JEP 330 represented."</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以往我们需要如此执行该文件</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">javac </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Main</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">java</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">java </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Main</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在如此即可执行：
<img loading="lazy" src="https://blog.teaho.net/assets/images/jep330-run-e630b53fca776f9b999163ae1db5a800.png" width="2038" height="74" class="img_zKyM"></p>
<p>btw,通过shebang执行：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">#</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">home</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">teaho</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Env</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">jdk</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token number" style="color:hsl(29, 54%, 61%)">11</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">bin</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">java </span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token plain">source </span><span class="token number" style="color:hsl(29, 54%, 61%)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">SheBang</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">main</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token parameter known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token parameter punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token parameter punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token parameter"> args</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"hey yo! This is JEP 330 represented."</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="329-chacha20-and-poly1305-cryptographic-algorithms">329: ChaCha20 and Poly1305 Cryptographic Algorithms<a href="https://blog.teaho.net/article/java11-feature#329-chacha20-and-poly1305-cryptographic-algorithms" class="hash-link" aria-label="Direct link to 329: ChaCha20 and Poly1305 Cryptographic Algorithms" title="Direct link to 329: ChaCha20 and Poly1305 Cryptographic Algorithms">​</a></h2>
<p>Java 11 提供了 ChaCha20 和 ChaCha20-Poly1305 加密实现。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="331-low-overhead-heap-profiling低开销的堆profiling">331: Low-Overhead Heap Profiling（低开销的堆profiling）<a href="https://blog.teaho.net/article/java11-feature#331-low-overhead-heap-profiling%E4%BD%8E%E5%BC%80%E9%94%80%E7%9A%84%E5%A0%86profiling" class="hash-link" aria-label="Direct link to 331: Low-Overhead Heap Profiling（低开销的堆profiling）" title="Direct link to 331: Low-Overhead Heap Profiling（低开销的堆profiling）">​</a></h2>
<p>提供一种低开销的Java堆分配采样(Profiling)方式，可通过JVMTI(Java Tool Interface)访问。</p>
<p>用户非常需要了解其堆的内容。所以有很多工具被开发出来，比如JFR，jmap，VisualVM Tool。<br>
<!-- -->但大多数现有工具都缺少的一种信息是对于特定或指定内存分配的调用路径（call site）。堆dump是没有携带这一类信息的。
这种信息对于开发者来说有为重要，尤其是在定位在一个糟糕的分配在代码中的指定位置。</p>
<p>现在我们可以这样获取到这些信息：</p>
<ol>
<li>您可以使用字节码重写器（例如 <span style="display:inline-flex;gap:0.25rem"><span></span><a href="https://github.com/google/allocation-instrumenter" target="_blank" rel="noopener noreferrer">Allocation Instrumenter|github</a></span> ）来检测应用程序中的所有分配。</li>
<li>通过Java飞行收集器。</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="333-zgc-a-scalable-low-latency-garbage-collector-experimental">333: ZGC: A Scalable Low-Latency Garbage Collector (Experimental)<a href="https://blog.teaho.net/article/java11-feature#333-zgc-a-scalable-low-latency-garbage-collector-experimental" class="hash-link" aria-label="Direct link to 333: ZGC: A Scalable Low-Latency Garbage Collector (Experimental)" title="Direct link to 333: ZGC: A Scalable Low-Latency Garbage Collector (Experimental)">​</a></h2>
<p>万众期待的ZGC出来了～当然目前是实验性特性，Java15才最终为生产就绪。</p>
<p>ZGC是一个低延迟可拓展垃圾收集器。</p>
<p>设计目标：</p>
<ul>
<li>GC暂停时间不超过10ms</li>
<li>处理从相对较小（几百兆字节）到非常大（许多 TB）(8mb~16TB)的堆</li>
<li>与使用 G1 相比，应用程序吞吐量降低不超过 15%</li>
<li>利用colored pointers和load barriers为未来的 GC 功能和优化奠定基础</li>
</ul>
<p>咋一看，ZGC是一个并发、单代、基于区域（region-base）、NUMA感知的压缩收集器。STW仅限于跟扫描，
因此GC暂停时间不会随着堆或live set的大小而增加。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="功能使用-1">功能使用<a href="https://blog.teaho.net/article/java11-feature#%E5%8A%9F%E8%83%BD%E4%BD%BF%E7%94%A8-1" class="hash-link" aria-label="Direct link to 功能使用" title="Direct link to 功能使用">​</a></h3>
<p>通过如下JVM参数启用：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnlockExperimentalVMOptions</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UseZGC</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="性能表现">性能表现<a href="https://blog.teaho.net/article/java11-feature#%E6%80%A7%E8%83%BD%E8%A1%A8%E7%8E%B0" class="hash-link" aria-label="Direct link to 性能表现" title="Direct link to 性能表现">​</a></h3>
<p>这是JDK项目组使用SPECjbb® 2015做的性能测试，用的128G堆。</p>
<p>第一个是吞吐量测试数据，max jops为纯吞吐量量，critical jops为限制响应时间下的吞吐量量。</p>
<ul>
<li>ZGC<br>
<!-- -->max-jOPS: 100%<br>
<!-- -->critical-jOPS: 76.1%</li>
<li>G1<br>
<!-- -->max-jOPS: 91.2%<br>
<!-- -->critical-jOPS: 54.7%</li>
</ul>
<p>下面是延时测试</p>
<ul>
<li>ZGC<br>
<!-- -->avg: 1.091ms (+/-0.215ms)<br>
<!-- -->95th percentile: 1.380ms<br>
<!-- -->99th percentile: 1.512ms<br>
<!-- -->99.9th percentile: 1.663ms<br>
<!-- -->99.99th percentile: 1.681ms<br>
<!-- -->max: 1.681ms</li>
<li>G1<br>
<!-- -->avg: 156.806ms (+/-71.126ms)<br>
<!-- -->95th percentile: 316.672ms<br>
<!-- -->99th percentile: 428.095ms<br>
<!-- -->99.9th percentile: 543.846ms<br>
<!-- -->99.99th percentile: 543.846ms<br>
<!-- -->max: 543.846ms</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="缺点局限性">缺点（局限性）<a href="https://blog.teaho.net/article/java11-feature#%E7%BC%BA%E7%82%B9%E5%B1%80%E9%99%90%E6%80%A7" class="hash-link" aria-label="Direct link to 缺点（局限性）" title="Direct link to 缺点（局限性）">​</a></h3>
<ul>
<li>目前ZGC为实验版本，该版本不支持类卸载。</li>
<li>不支持JVMCI（Java-Level JVM Compiler Interface）</li>
</ul>
<p>这些将在后续版本的开发中支持。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="运行原理">运行原理<a href="https://blog.teaho.net/article/java11-feature#%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86" class="hash-link" aria-label="Direct link to 运行原理" title="Direct link to 运行原理">​</a></h3>
<p><img loading="lazy" alt="ZGC_phase.jpg" src="https://blog.teaho.net/assets/images/ZGC_phase-69978626f3477ff89f9d90543baab1cb.jpg" width="772" height="411" class="img_zKyM"></p>
<p>ZGC只有三个STW阶段：初始标记，再标记，初始转移。其中，初始标记和初始转移分别都只需要扫描所有GC Roots，其处理时间和GC Roots的数量成正比，一般情况耗时非常短；<br>
<!-- -->再标记阶段STW时间很短，最多1ms，超过1ms则再次进入并发标记阶段。即，ZGC几乎所有暂停都只依赖于GC Roots集合大小，停顿时间不会随着堆的大小或者活跃对象的大小而增加。
与ZGC对比，G1的转移阶段完全STW的，且停顿时间随存活对象的大小增加而增加。</p>
<p>解决转移期间对象访问的两个核心技术：</p>
<ul>
<li>着色指针<br>
<img loading="lazy" alt="zgc_color_pointer" src="https://blog.teaho.net/assets/images/zgc_color_pointer-626ae0012c2a77a1e4ba8d694bc6ccf6.jpg" width="1269" height="374" class="img_zKyM"><br>
<!-- -->对于 64bit 的系统，高位 bit 中拿出 4 个 bit 来指示不同的处理状态，两个 Mark 位表明该对象指针是否已经被标记，采用两个 Mark bit 可以在前后不同的 GC 时使用不同的 Mark bit；
Remapped 位表示当前对象指针是否已经调整为搬移之后的对象指针；Finalizable 位主要是为 Finalizable 对象服务，用来表示该对象指针是否仅经 Finalize 对象标记，主要供 Mark 阶段和弱引用处理阶段使用。</li>
<li>读屏障<br>
<!-- -->读屏障是JVM向应用代码插入一小段代码的技术。当应用线程从堆中读取对象引用时，就会执行这段代码。需要注意的是，仅“从堆中读取对象引用”才会触发这段代码。</li>
</ul>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Object</span><span class="token plain"> o </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> obj</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access maybe-class-name" style="color:hsl(29, 54%, 61%)">FieldA</span><span class="token plain">   </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 从堆中读取引用，需要加入屏障</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Load</span><span class="token plain"> barrier</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Object</span><span class="token plain"> p </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> o  </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 无需加入屏障，因为不是从堆中读取引用</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="配置参数">配置参数<a href="https://blog.teaho.net/article/java11-feature#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0" class="hash-link" aria-label="Direct link to 配置参数" title="Direct link to 配置参数">​</a></h3>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">重要参数配置样例：</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Xms10G</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Xmx10G</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ReservedCodeCacheSize</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">256m </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">InitialCodeCacheSize</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">256m </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnlockExperimentalVMOptions</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UseZGC</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ConcGCThreads</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ParallelGCThreads</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">6</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ZCollectionInterval</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">120</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ZAllocationSpikeTolerance</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">5</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnlockDiagnosticVMOptions</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token constant" style="color:hsl(29, 54%, 61%)">XX</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">ZProactive</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Xlog</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain">safepoint</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">classhisto</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*=</span><span class="token plain">trace</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">age</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">gc</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*=</span><span class="token plain">info</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain">file</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">opt</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">logs</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">logs</span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">gc</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">%</span><span class="token plain">t</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">log</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain">time</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">tid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">tags</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain">filecount</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token number" style="color:hsl(29, 54%, 61%)">5</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain">filesize</span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain">50m </span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>-Xms -Xmx：堆的最大内存和最小内存，这里都设置为10G，程序的堆内存将保持10G不变。</li>
<li>-XX<!-- -->:ReservedCodeCacheSize<!-- --> -XX<!-- -->:InitialCodeCacheSize<!-- -->：设置CodeCache的大小， JIT编译的代码都放在CodeCache中，一般服务64m或128m就已经足够。</li>
<li>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC：启用ZGC的配置。</li>
<li>-XX<!-- -->:ConcGCThreads<!-- -->：并发回收垃圾的线程。默认是总核数的12.5%，8核CPU默认是1。调大后GC变快，但会占用程序运行时的CPU资源，吞吐会受到影响。</li>
<li>-XX<!-- -->:ParallelGCThreads<!-- -->：STW阶段使用线程数，默认是总核数的60%。</li>
<li>-XX<!-- -->:ZCollectionInterval<!-- -->：ZGC发生的最小时间间隔，单位秒。</li>
<li>-XX<!-- -->:ZAllocationSpikeTolerance<!-- -->：ZGC触发自适应算法的修正系数，默认2，数值越大，越早的触发ZGC。</li>
<li>-XX:+UnlockDiagnosticVMOptions -XX:-ZProactive：是否启用主动回收，默认开启，这里的配置表示关闭。</li>
<li>-Xlog：设置GC日志中的内容、格式、位置以及每个日志的大小。</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="332-transport-layer-security-tls-13">332: Transport Layer Security (TLS) 1.3<a href="https://blog.teaho.net/article/java11-feature#332-transport-layer-security-tls-13" class="hash-link" aria-label="Direct link to 332: Transport Layer Security (TLS) 1.3" title="Direct link to 332: Transport Layer Security (TLS) 1.3">​</a></h2>
<p>实现传输层安全 (TLS) 协议 RFC 8446 的 1.3 版。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="335-deprecate-the-nashorn-javascript-engine">335: Deprecate the Nashorn JavaScript Engine<a href="https://blog.teaho.net/article/java11-feature#335-deprecate-the-nashorn-javascript-engine" class="hash-link" aria-label="Direct link to 335: Deprecate the Nashorn JavaScript Engine" title="Direct link to 335: Deprecate the Nashorn JavaScript Engine">​</a></h2>
<p>Nashorn是Java引入的JavaScript引擎。<br>
<!-- -->由于ECMAScript的语言结构和APi快速发展，使得该引擎难以维护。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="336-deprecate-the-pack200-tools-and-api">336: Deprecate the Pack200 Tools and API<a href="https://blog.teaho.net/article/java11-feature#336-deprecate-the-pack200-tools-and-api" class="hash-link" aria-label="Direct link to 336: Deprecate the Pack200 Tools and API" title="Direct link to 336: Deprecate the Pack200 Tools and API">​</a></h2>
<p>一个打包压缩工具，因为各种历史原因和发展原因弃用。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="api变更">API变更<a href="https://blog.teaho.net/article/java11-feature#api%E5%8F%98%E6%9B%B4" class="hash-link" aria-label="Direct link to API变更" title="Direct link to API变更">​</a></h2>
<p>Java11的API弃用和移除清单可以在这里看到:
<a href="https://cr.openjdk.java.net/~iris/se/11/latestSpec/#APIs-removed" target="_blank" rel="noopener noreferrer">API removed|Java SE 11 Final Release Spec</a></p>
<p>Java11的API变动（更改、增加、删除）：
<a href="https://cr.openjdk.java.net/~iris/se/11/latestSpec/apidiffs/overview-summary.html" target="_blank" rel="noopener noreferrer">Diff between Java 10 and Java11 API|Java.net</a></p>
<p>下面看看一些常用更改。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="javalangstring">java.lang.String<a href="https://blog.teaho.net/article/java11-feature#javalangstring" class="hash-link" aria-label="Direct link to java.lang.String" title="Direct link to java.lang.String">​</a></h3>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">/**</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * for java.lang.String</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    @</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">testStringNewAPI</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">""</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">isBlank</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"   "</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">isBlank</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"11"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">isBlank</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">false</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc\n"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc\n"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">lines</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">count</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">2L</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">repeat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"abcabc"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"  a b c  "</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">strip</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"a b c"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"  a b c  "</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">stripLeading</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"a b c  "</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"  a b c  "</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">stripTrailing</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"  a b c"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="简单的文件读取">简单的文件读取<a href="https://blog.teaho.net/article/java11-feature#%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96" class="hash-link" aria-label="Direct link to 简单的文件读取" title="Direct link to 简单的文件读取">​</a></h3>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    @</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">testFilesIOString</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">IOException</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> content </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"Hey this is tmp file!"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Path</span><span class="token plain"> path </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Files</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">writeString</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Files</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">createTempFile</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"tmp"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">LocalTime</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">now</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">".txt"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> fileContent </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Files</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">readString</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"Str not eq!"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> fileContent</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">content</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="java10同场加映">JAVA10同场加映<a href="https://blog.teaho.net/article/java11-feature#java10%E5%90%8C%E5%9C%BA%E5%8A%A0%E6%98%A0" class="hash-link" aria-label="Direct link to JAVA10同场加映" title="Direct link to JAVA10同场加映">​</a></h2>
<ul>
<li>286: Local-Variable Type Inference（本地变量类型推断）</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="286-local-variable-type-inference本地变量类型推断">286: Local-Variable Type Inference（本地变量类型推断）<a href="https://blog.teaho.net/article/java11-feature#286-local-variable-type-inference%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%AD" class="hash-link" aria-label="Direct link to 286: Local-Variable Type Inference（本地变量类型推断）" title="Direct link to 286: Local-Variable Type Inference（本地变量类型推断）">​</a></h3>
<p>在上面JEP323一节已对该特性做了陈述。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="api变更-1">API变更<a href="https://blog.teaho.net/article/java11-feature#api%E5%8F%98%E6%9B%B4-1" class="hash-link" aria-label="Direct link to API变更" title="Direct link to API变更">​</a></h3>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">/**</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * java.util.List、java.util.Map 和 java.util.Set 都有了一个新的静态方法 copyOf(Collection)。</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * copyOf</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    @</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">testCopyOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> list </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">ArrayList</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">add</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">add</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> copyList </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">List</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">copyOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">copyList</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">copyList</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Utils</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exceptionOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> copyList</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">add</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">3</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">instanceOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnsupportedOperationException</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> list </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">ArrayList</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">add</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">add</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">List</span><span class="token plain"> copyList </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">List</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">copyOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">copyList</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">copyList</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">list</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">get</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> map </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Map</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">of</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">3</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">3</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> copyMap </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Map</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">copyOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">map</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">map</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">equals</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">copyMap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Utils</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exceptionOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> copyMap</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">put</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Integer</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAX_VALUE</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Integer</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">MAX_VALUE</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">instanceOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnsupportedOperationException</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> set </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Set</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">of</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">3</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> copySet </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">Set</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">copyOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">set</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">set</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">equals</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">copySet</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">equalTo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Utils</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exceptionOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> copySet</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">add</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Item</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">4</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">instanceOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnsupportedOperationException</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">/**</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * Collectors加了一个转换为不可变列表的API</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     *</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * stream toUnmodifiableList</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    @</span><span class="token function maybe-class-name" style="color:hsl(29, 54%, 61%)">Test</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">expected </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">UnsupportedOperationException</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">whenModifyToUnmodifiableList_thenThrowsException</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">List</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Integer</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> list </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Stream</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">of</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">3</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">filter</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">i </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> i </span><span class="token operator" style="color:hsl(207, 82%, 66%)">%</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">collect</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Collectors</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">toUnmodifiableList</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">/**</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     * optional 增加了 空的orElseThrow 方法</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token doc-comment comment" style="color:hsl(220, 10%, 40%)">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    @</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">testOptional_orElseThrow</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Optional</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">of</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">orElseThrow</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token function" style="color:hsl(207, 82%, 66%)">assertThat</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Utils</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exceptionOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Optional</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">empty</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">orElseThrow</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">instanceOf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">NoSuchElementException</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">class</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="java9同场加映未完成">JAVA9同场加映(未完成)<a href="https://blog.teaho.net/article/java11-feature#java9%E5%90%8C%E5%9C%BA%E5%8A%A0%E6%98%A0%E6%9C%AA%E5%AE%8C%E6%88%90" class="hash-link" aria-label="Direct link to JAVA9同场加映(未完成)" title="Direct link to JAVA9同场加映(未完成)">​</a></h2>
<ul>
<li>222: jshell: The Java Shell (Read-Eval-Print Loop)</li>
<li>261: Module System(模块系统)</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="222-jshell-the-java-shell-read-eval-print-loop">222: jshell: The Java Shell (Read-Eval-Print Loop)<a href="https://blog.teaho.net/article/java11-feature#222-jshell-the-java-shell-read-eval-print-loop" class="hash-link" aria-label="Direct link to 222: jshell: The Java Shell (Read-Eval-Print Loop)" title="Direct link to 222: jshell: The Java Shell (Read-Eval-Print Loop)">​</a></h3>
<p>Java9提供交互式工具来评估使用Java编程语言的声明、语句和表达式，<br>
<!-- -->以及提供了JShell API以便其他应用程序可以利用此功能。</p>
<p><a href="https://cr.openjdk.java.net/~rfield/tutorial/JShellTutorial.html" target="_blank" rel="noopener noreferrer">JShell Tutorial</a><br>
<a href="https://docs.oracle.com/javase/9/tools/jshell.htm#JSWOR-GUID-C337353B-074A-431C-993F-60C226163F00" target="_blank" rel="noopener noreferrer">jshell|Java Platform, Standard Edition Tools Reference</a></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="一般使用">一般使用<a href="https://blog.teaho.net/article/java11-feature#%E4%B8%80%E8%88%AC%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="Direct link to 一般使用" title="Direct link to 一般使用">​</a></h4>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jshell</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">list</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> a </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">instanceof</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">java</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">lang</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token number" style="color:hsl(29, 54%, 61%)">3</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> a </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">instanceof</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">java</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">lang</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token number" style="color:hsl(29, 54%, 61%)">5</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">getStr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">       </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">       </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token number" style="color:hsl(29, 54%, 61%)">6</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> a </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jshell</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">imports</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">io</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">math</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">net</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">nio</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">file</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">concurrent</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">function</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">prefs</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">regex</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token keyword module" style="color:hsl(286, 60%, 67%)">import</span><span class="token plain"> java</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">util</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">stream</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jshell</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">/</span><span class="token plain">vars</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    boolean $2 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    boolean $3 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">    </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> a </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jshell</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">getStr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token spread operator" style="color:hsl(207, 82%, 66%)">...</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"a"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">   </span><span class="token spread operator" style="color:hsl(207, 82%, 66%)">...</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain">  已修改 方法 </span><span class="token function" style="color:hsl(207, 82%, 66%)">getStr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">jshell</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token function" style="color:hsl(207, 82%, 66%)">getStr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">a</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="api使用">API使用<a href="https://blog.teaho.net/article/java11-feature#api%E4%BD%BF%E7%94%A8" class="hash-link" aria-label="Direct link to API使用" title="Direct link to API使用">​</a></h4>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">JShell</span><span class="token plain"> shell </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">JShell</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">create</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">shell</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">onShutdown</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">jShell </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"bye bye"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">BufferedReader</span><span class="token plain"> reader </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">BufferedReader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">InputStreamReader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">in</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">print</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"\n&gt; "</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> cmd </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> reader</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">readLine</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">List</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SnippetEvent</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> results </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> shell</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">eval</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">SnippetEvent</span><span class="token plain"> e </span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> results</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">isActive</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">isDefined</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                shell</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">diagnostics</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">snippet</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">forEach</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">diag </span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">diag</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">getMessage</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Locale</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">CHINA</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exception</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:hsl(286, 60%, 67%)">null</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">"&lt; "</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">exception</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">value</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">IOException</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">        e</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">printStackTrace</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>输出：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token plain"> s </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token string" style="color:hsl(95, 38%, 62%)">"abc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"> a </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">"a"</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">找不到符号</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">符号</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain">   类 </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">var</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">  </span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">位置</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> 类 </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token constant" style="color:hsl(29, 54%, 61%)">REJECTED</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">System</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token method function property-access" style="color:hsl(207, 82%, 66%)">println</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">abc</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="其他变更">其他变更<a href="https://blog.teaho.net/article/java11-feature#%E5%85%B6%E4%BB%96%E5%8F%98%E6%9B%B4" class="hash-link" aria-label="Direct link to 其他变更" title="Direct link to 其他变更">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="flow--api">Flow  API<a href="https://blog.teaho.net/article/java11-feature#flow--api" class="hash-link" aria-label="Direct link to Flow  API" title="Direct link to Flow  API">​</a></h4>
<p>以前有写过一篇Project Reactor的原理剖析[24]，原理上二者是相通的。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">reference<a href="https://blog.teaho.net/article/java11-feature#reference" class="hash-link" aria-label="Direct link to reference" title="Direct link to reference">​</a></h2>
<p>[1]<a href="https://openjdk.java.net/projects/jdk/11/" target="_blank" rel="noopener noreferrer">JDK 11|java.net</a><br>
<!-- -->[2]<a href="https://cloud.tencent.com/developer/article/1590566" target="_blank" rel="noopener noreferrer">【是时候升级java11了】 jdk11优势和jdk选择</a><br>
<!-- -->[3]<a href="https://zhuanlan.zhihu.com/p/94459000" target="_blank" rel="noopener noreferrer">JAVA11到底有多强，不看你就out了|zhihu</a><br>
<!-- -->[4]<a href="http://unicode.org/versions/Unicode10.0.0/" target="_blank" rel="noopener noreferrer">unicode10|unicode.org</a><br>
<!-- -->[5]<a href="http://unicode.org/reports/tr51/proposed.html" target="_blank" rel="noopener noreferrer">Proposed Update Unicode® Technical Standard #51</a><br>
<!-- -->[6]<a href="https://en.wikipedia.org/wiki/Script_(Unicode)" target="_blank" rel="noopener noreferrer">Script(Unicode)|wikipedia</a><br>
<!-- -->[7]<a href="https://www.wmyskxz.com/2020/08/22/java11-ban-ben-te-xing-xiang-jie/" target="_blank" rel="noopener noreferrer">Java11版本特性详解</a><br>
<!-- -->[8]<a href="https://docs.oracle.com/en/java/javase/11/index.html" target="_blank" rel="noopener noreferrer">JDK 11 Documentation|oracle</a><br>
<!-- -->[9]<a href="https://www.wmyskxz.com/2020/08/20/java9-ban-ben-te-xing-xiang-jie/" target="_blank" rel="noopener noreferrer">Java9版本特性详解</a><br>
<!-- -->[10]<a href="https://juejin.cn/post/6844903685617614855" target="_blank" rel="noopener noreferrer">java11新特性---Nest-Based Access Control(嵌套访问控制)|宋兵甲</a><br>
<!-- -->[11]<a href="https://www.youtube.com/watch?v=7z_R2Aq-Fl8" target="_blank" rel="noopener noreferrer">JDK11 - Introduction to JDK Flight Recorder|Java Community and Oracle|youtube</a><br>
<!-- -->[12]<a href="https://www.youtube.com/watch?v=88E86quLmQA" target="_blank" rel="noopener noreferrer">ZGC: The Next Generation Low-Latency Garbage Collector|Java Community and Oracle|youtube</a><br>
<!-- -->[13]<a href="https://blog.caoxudong.info/blog/2017/12/07/jvmti_reference#1.6" target="_blank" rel="noopener noreferrer">JVMTI 参考|javase8 jvmti文档翻译</a><br>
<!-- -->[14]<a href="https://docs.oracle.com/javase/8/docs/platform/jvmti/jvmti.html" target="_blank" rel="noopener noreferrer">JVMTM Tool Interface|oracle</a><br>
<!-- -->[15]<a href="https://tech.meituan.com/2020/08/06/new-zgc-practice-in-meituan.html" target="_blank" rel="noopener noreferrer">新一代垃圾回收器ZGC的探索与实践|美团技术团队</a><br>
<!-- -->[16]<a href="http://cr.openjdk.java.net/~pliden/slides/ZGC-PLMeetup-2019.pdf" target="_blank" rel="noopener noreferrer">The Design of ZGC|Per Lidén (@perliden)Consulting Member of Technical Staff,Java Platform Group, Oracle</a><br>
<!-- -->[17]<a href="https://wiki.openjdk.java.net/" target="_blank" rel="noopener noreferrer">openjdk wiki</a><br>
<!-- -->[18]<a href="https://cr.openjdk.java.net/~pliden/slides/ZGC-OracleDevLive-2020.pdf" target="_blank" rel="noopener noreferrer">ZGC-OracleDevLive-2020.pdf|Java Platform Group</a><br>
<!-- -->[19]<a href="https://www.infoq.cn/article/suthxzwaoeijigdp11bj" target="_blank" rel="noopener noreferrer">Tencent Kona JDK11 无暂停内存管理 -ZGC 生产实践|InfoQ</a><br>
<!-- -->[20]<a href="https://openjdk.java.net/projects/jdk9/" target="_blank" rel="noopener noreferrer">JDK 9|java.net</a><br>
<!-- -->[21]<a href="https://darian1996.github.io/2020/05/28/Java9-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B9%8B%E6%A0%B8%E5%BF%83%E5%BA%93/" target="_blank" rel="noopener noreferrer">Java 9 新特性之核心库（上）|darian1996</a><br>
<!-- -->[22]<a href="https://darian1996.github.io/2020/05/27/Java9-%E6%A8%A1%E5%9D%97%E5%8C%96/" target="_blank" rel="noopener noreferrer">Java9 模块化|darian1996</a><br>
<!-- -->[23]<a href="http://cr.openjdk.java.net/~mr/jigsaw/spec/java-se-9-jls-diffs.pdf" target="_blank" rel="noopener noreferrer">The Java® Language Specification|Java SE 9 Edition</a><br>
<!-- -->[24]<a href="https://spring-source-code-learning.gitbook.teaho.net/webflux/project-reactor%E5%8E%9F%E7%90%86.html" target="_blank" rel="noopener noreferrer">Project Reactor原理|teaho.net</a></p>
<p>其他参考：</p>
<p><a href="https://www.jdon.com/49683" target="_blank" rel="noopener noreferrer">真棒：使用Java 11实现应用的模块化|banq</a><br>
<a href="https://juejin.cn/post/6844904002727968782" target="_blank" rel="noopener noreferrer">本文将帮助你如何将应用程序从Java 8迁移到java11（纯干货分享）|程序猿阿洐</a><br>
<a href="https://cdmana.com/2021/06/20210610210415763m.html" target="_blank" rel="noopener noreferrer">JDK8升级JDK11过程记录|cdmana.com</a></p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="java" term="java"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[魅族魅蓝2拆机]]></title>
        <id>https://blog.teaho.net/article/phone-arch</id>
        <link href="https://blog.teaho.net/article/phone-arch"/>
        <updated>2021-04-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[一台魅蓝2手机的自白]]></summary>
        <content type="html"><![CDATA[<p>一台魅蓝2手机的自白</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="前言">前言<a href="https://blog.teaho.net/article/phone-arch#%E5%89%8D%E8%A8%80" class="hash-link" aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h2>
<p>魅蓝2这台手机是我参加工作后买的第一台手机， 换机后中间有一段时间我用它作为测试和体验APP的机子，到后来闲置在箱子里一段时间了。 前些天我突然好奇起来：我用了手机这么些年了，我真的了解手机的组成吗。遂拆之，并把它装裱在框里挂在家里墙上。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="各部分分析">各部分分析<a href="https://blog.teaho.net/article/phone-arch#%E5%90%84%E9%83%A8%E5%88%86%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 各部分分析" title="Direct link to 各部分分析">​</a></h2>
<p>下图是我拆机并装裱起来的最终效果图。</p>
<p><img loading="lazy" src="https://blog.teaho.net/assets/images/phone-arch-marked-3cce30eb1aee236b6c606a0edae2b916.jpg" width="8000" height="6000" class="img_zKyM"></p>
<p>各部分分别是：</p>
<ol>
<li>手机后盖</li>
<li>麦克风防尘塞</li>
<li>电池及电池排线</li>
<li>背板螺丝</li>
<li>左边是2GB的SD卡，右边是固定外壳的螺丝（其中一颗遗失了）</li>
<li>SIM卡槽</li>
<li>左边蓝条是声音调节按键，右边是主板螺丝</li>
<li>主板（我没把遮蔽罩拆掉）<!-- -->
<ul>
<li>MT6735四核1.3GHz处理器</li>
<li>16GB三星的eMMC存储芯片</li>
<li>2GB LPDDR3 内存</li>
<li>1300万像素后置摄像头和500万像素前置摄像头</li>
</ul>
</li>
<li>背板</li>
<li>主板上感光元件的一个软塞</li>
<li>3.5mm耳机孔及固定螺丝</li>
<li>扬声器单元</li>
<li>副板</li>
<li>HOME键</li>
<li>铝镁合金框架</li>
<li>射频线</li>
<li>5英寸720p、296PPI的屏幕集成</li>
</ol>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="phone" term="phone"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[NBA的球队战绩是否与城市经济挂钩]]></title>
        <id>https://blog.teaho.net/article/nba-team-achievement-related-to-economic</id>
        <link href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic"/>
        <updated>2019-10-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[NBA的球队战绩是否与城市经济挂钩]]></summary>
        <content type="html"><![CDATA[<p>回想小时候，我常常会觉得西强东弱，并且产生NBA球队战绩和城市经济相关的猜想。
究竟真相是什么？我尝试通过数据和代码统计去解答。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="计划">计划<a href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic#%E8%AE%A1%E5%88%92" class="hash-link" aria-label="Direct link to 计划" title="Direct link to 计划">​</a></h2>
<p>问题是，nba的球队战绩是否和经济有关。那么</p>
<ol>
<li>收集战绩数据，经济数据用GDP衡量</li>
<li>数据分析</li>
</ol>
<p>分析公式：分别将球队战绩、球队所在城市GDP做两个排名，做一个线性回归分析。</p>
<p>第二问题，NBA是否西强东弱（顺带分析）</p>
<ol>
<li>收集战绩数据</li>
<li>数据分析</li>
</ol>
<p>分析公式： 首先，NBA有些球队不是一个赛季只碰面两次的。 一般同分区的球队，一个赛季可能有四次碰面。 而一支球队与不同分区的球队一个赛季只会碰2次（主客场）。</p>
<p>那问题就是，怎么抵消同分区的战绩干扰，分析不同分区球队的对战战绩。 最后想到用胜场系数来评判，即是用同分区的胜场数减去同分区的负场数，那么就得出了该分区对战另一分区的总战绩了。 然后逐年的总战绩拉一个趋势出来就可以看出是不是有西强或者东强的痕迹了。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="遇到的情况">遇到的情况<a href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic#%E9%81%87%E5%88%B0%E7%9A%84%E6%83%85%E5%86%B5" class="hash-link" aria-label="Direct link to 遇到的情况" title="Direct link to 遇到的情况">​</a></h2>
<ul>
<li>数据获取</li>
</ul>
<p>数据获取用了两个月时间。球队战绩容易些。 而球队所在城市GDP是则是意料之外的难找到。找不到旧数据，GDP很多没有以市单位的。我尝试了google、quora等，在虎扑、知乎寻求了些 在国外城市数据有相关回答经验的大佬也没有找到。</p>
<p>最终在google公共数据库里，找到了2001-2016的美国各市GDP数据。所以，分析会局限在这个时间区间。</p>
<ul>
<li>球队改城市、改名字、变分区、2011-2012为缩水赛季</li>
</ul>
<p>主要影响数据库表结构，和数据爬取程序出错。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="结果分析">结果分析<a href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic#%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 结果分析" title="Direct link to 结果分析">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="nba的球队战绩是否和经济有关">nba的球队战绩是否和经济有关<a href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic#nba%E7%9A%84%E7%90%83%E9%98%9F%E6%88%98%E7%BB%A9%E6%98%AF%E5%90%A6%E5%92%8C%E7%BB%8F%E6%B5%8E%E6%9C%89%E5%85%B3" class="hash-link" aria-label="Direct link to nba的球队战绩是否和经济有关" title="Direct link to nba的球队战绩是否和经济有关">​</a></h3>
<p>好，脚本拉去整理数据，排序然后seaborn线性回归分析。如下图，</p>
<p><img loading="lazy" src="https://blog.teaho.net/assets/images/nba_stat_economic_analyse-b07a56a1da8d16ce426a847079d18a8c.png" width="6418" height="6418" class="img_zKyM"></p>
<p>额，脸好疼，谁打我脸。。我一直以为是成正相关的。 可是咋一看图，点乱麻麻的分布在各处，这貌似显示战绩和经济没有关系。</p>
<p>为什么我觉得和经济相关呢？ 事实上，从总冠军数据来看，整个历史长河，赢得大于两个总冠军的球队，除了圣安东尼奥，其余都是GDP名列前茅的。 从个体来看，拿湖人来说，贾巴尔（天勾，历史得分榜第一名），奥尼尔（我认为是历史第一中锋），勒布朗詹姆斯（算历史第一大前锋）都选择了转会湖人， 并且对湖人夺冠起了直接作用。 大城市对于球星的吸引力，看每年的交易期可容易看到。 大城市的人口，消费水平，影响力，曝光，辐射力都是小城市不能比拟的。</p>
<p>综上，我认为，<strong>经济和战绩没有必然关系，只是影响战绩的其中一个因素。</strong> 为什么呢，因为影响战绩的因素还有，每年的乐透选秀（我认为算是小球市球队夺冠的较重要事件）， 球队的教练团队水平（比如，五冠马刺），球队总经理的运营能力，球队老板的考量，甚至还有地理因素、城市关注度（因为会有NFL等职业比赛分流了）等较外围因素。btw, <strong>联盟不断保证竞技的公平性，这正是竞技体育的魅力所在。</strong></p>
<p>如果要严谨的测算的话，需要控制好其他变量的影响。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="千禧年后东西强弱分析">千禧年后东西强弱分析<a href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic#%E5%8D%83%E7%A6%A7%E5%B9%B4%E5%90%8E%E4%B8%9C%E8%A5%BF%E5%BC%BA%E5%BC%B1%E5%88%86%E6%9E%90" class="hash-link" aria-label="Direct link to 千禧年后东西强弱分析" title="Direct link to 千禧年后东西强弱分析">​</a></h3>
<p>这是附带分析，想着既然把战绩找来了，正好可以分析下西强东弱究竟是感官上的错觉，还是确有其事呢。</p>
<p>结果如图，可知，在千禧年后，西部整体对阵东部球队除2009年外都是领先的，而且不少年份还大幅领先（大于50场）。
<img loading="lazy" src="https://blog.teaho.net/assets/images/nba_conference_analyse-8bb8a3dc5161740ddbe19e122c56ca58.png" width="2560" height="1920" class="img_zKyM"></p>
<p>结论，千禧年后，整体来看联盟实力西强东弱。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="回顾">回顾<a href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic#%E5%9B%9E%E9%A1%BE" class="hash-link" aria-label="Direct link to 回顾" title="Direct link to 回顾">​</a></h2>
<p>对于数据，我获取的时间线还不够长。时间线拉的不够长会导致不利于观察和分析规律。 另一方面来讲，数据挺重要的。找数据用了两个多月，编码（爬数据入库、数据分析、图表生成）加上写文章大约1个星期。</p>
<p>对于结果后续， 可以尝试把教练团队水平，乐透秀，总经理交易水平，球迷人数考虑进去。 这样能相对抹平其他变量对于这个问题的干扰。 不过那些因素其实很难衡量，没有一个绝对的衡量标准， 我认为可以通过建立一个自己的打分系统去做（将教练水平打分，球员潜力兑现打分，每笔交易打分）。</p>
<p>对于经济， 看到GDP数据比较，感叹洛杉矶和纽约的辐射能力，也从明尼苏达中感到了城市群里分工明确， 我个人以为在进入城镇化晚期的我国，估计最终也会呈现这个局面。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="后记">后记<a href="https://blog.teaho.net/article/nba-team-achievement-related-to-economic#%E5%90%8E%E8%AE%B0" class="hash-link" aria-label="Direct link to 后记" title="Direct link to 后记">​</a></h2>
<p>在写之前，我问过自己一些问题：为什么写这篇文，我希望写成什么样子呢？我想，大概要从前几年说起。</p>
<p>读书时期，身边总有些看NBA的朋友，我或多或少看了些，出名的球星可以叫出来些。 大概到毕业出来工作16年那会，才开始大规模看球。也得益于移动互联网，看球方便多了。</p>
<p>大概到18年赛季结束，我想着也看了一段时间了，心里有个念想，想起码输出点东西作为我看球的记忆点也好正反馈也好。</p>
<p>好，那么问题就到了我希望写成什么样子呢？</p>
<p>18年那会看了《约翰·伍登的UCLA大学进攻战术体系》，会有时看下basketball reference等数据网站。 恰逢刚看完总决赛，就觉得勇士太厉害了，想着就分析勇士的战术吧。</p>
<p>可是，分析战术在文章里截出大堆比赛截图，我总觉得有点别扭。 更重要的是，我希望结合我自己的专业去解决些问题会有意思些。
另外看NBA的朋友大概会有东部强还西部强的探讨，其实争论从NBA远古时代就有。<br>
<!-- -->记得小时候零几年时，从全明星，我们喜欢的科比、奥尼尔、甜瓜、马刺以及很多国人关注的火箭大概总围绕西部，当然东部也有答案、真理、詹姆斯。
但是体感上西部每年赛季末争抢季后赛的名额总比较激烈。不过，网上却众说纷纭。我当时就想，可不可能和经济有关系呢，于是，想从这个角度做一些自己的阐述。</p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="basketball" term="basketball"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[权限模型分析]]></title>
        <id>https://blog.teaho.net/article/access-control-model</id>
        <link href="https://blog.teaho.net/article/access-control-model"/>
        <updated>2019-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[一个系统的权限模型调研和设计]]></summary>
        <content type="html"><![CDATA[<p>一个系统的权限模型调研和设计。<br>
<!-- -->记录下之前为团队设计一个权限功能对权限模型做的一些调研。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="前言">前言<a href="https://blog.teaho.net/article/access-control-model#%E5%89%8D%E8%A8%80" class="hash-link" aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h2>
<p>之前为团队设计一个权限功能对权限模型做了些调研。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="aclaccess-control-list">ACL(Access Control list)<a href="https://blog.teaho.net/article/access-control-model#aclaccess-control-list" class="hash-link" aria-label="Direct link to ACL(Access Control list)" title="Direct link to ACL(Access Control list)">​</a></h2>
<p>ACL是对一个对象附加一系列的权限（permission），比较常见。例如：Zookeeper的节点（Node）ACL属性</p>
<p><img loading="lazy" src="data:image/jpeg;base64,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" width="461" height="51" class="img_zKyM"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="blpbell-lapadula-model">BLP(Bell-LaPadula Model)<a href="https://blog.teaho.net/article/access-control-model#blpbell-lapadula-model" class="hash-link" aria-label="Direct link to BLP(Bell-LaPadula Model)" title="Direct link to BLP(Bell-LaPadula Model)">​</a></h2>
<p>BLP是严密的信息安全模型。 定义： * 主体--人、对象 * 客体--数据</p>
<p><img loading="lazy" src="https://blog.teaho.net/assets/images/BLP_model-acf2e9e2049964186aea57651a61f220.jpg" width="631" height="279" class="img_zKyM"></p>
<p>我认为BLP是缺乏灵活性的，该模型能满足军事组织（模型设计初衷）的由低到高的数据传递，但对于同级访问描述、自由授权等是比较僵化的。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="biba模型">Biba模型<a href="https://blog.teaho.net/article/access-control-model#biba%E6%A8%A1%E5%9E%8B" class="hash-link" aria-label="Direct link to Biba模型" title="Direct link to Biba模型">​</a></h2>
<p>Biba模型的规则是类似于BLP模型。</p>
<p><img loading="lazy" src="https://blog.teaho.net/assets/images/Biba_model-40eef76fede00e5ae80d9f1b5dfe5dd8.jpg" width="631" height="279" class="img_zKyM"></p>
<p>就是将BLP上下级的读写互换。因为Biba模型主要针对外部威胁，所以模型中上级也即外部。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="dacdiscretionary-access-control">DAC（Discretionary Access Control）<a href="https://blog.teaho.net/article/access-control-model#dacdiscretionary-access-control" class="hash-link" aria-label="Direct link to DAC（Discretionary Access Control）" title="Direct link to DAC（Discretionary Access Control）">​</a></h2>
<p>自主控制模型是通过维护访问控制矩阵和访问控制列表完成的。
模型如下：</p>
<table><thead><tr><th>用户subject\目标object</th><th>1</th><th>2</th></tr></thead><tbody><tr><td>a</td><td>Own、write、read</td><td></td></tr><tr><td>b</td><td>read</td><td>write、read</td></tr></tbody></table>
<p>自主访问控制通常假定所有客体都有属主，并且属主能够修改访问该客体的权限，这可能因为大部分系统的确通过属主的概念来实现的。 但是Evaluation Criteria中并没有关于属主的说明，所以技术上访问控制系统并非必须拥有属主。 基于这种实现下，用户（属主）能够修改安全属性。一个直接的例子是 Unix 的文件模式。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="macmandatory-access-control强制访问控制">MAC（Mandatory Access Control）强制访问控制<a href="https://blog.teaho.net/article/access-control-model#macmandatory-access-control%E5%BC%BA%E5%88%B6%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6" class="hash-link" aria-label="Direct link to MAC（Mandatory Access Control）强制访问控制" title="Direct link to MAC（Mandatory Access Control）强制访问控制">​</a></h2>
<p>简单来说，系统将用户和文件赋予不同的访问级别，基于一些标记去决定访问模式。</p>
<blockquote>
<p>强制访问控制（英语：mandatory access control，缩写MAC）在计算机安全领域指一种由操作系统约束的访问控制，目标是限制主体或发起者访问或对对象或目标执行某种操作的能力。 在实践中，主体通常是一个进程或线程，对象可能是文件、目录、TCP/UDP端口、共享内存段、I/O设备等。主体和对象各自具有一组安全属性。每当主体尝试访问对象时，都会由操作系统内核强制施行授权规则——检查安全属性并决定是否可进行访问。 任何主体对任何对象的任何操作都将根据一组授权规则（也称策略）进行测试，决定操作是否允许。在数据库管理系统中也存在访问控制机制，因而也可以应用强制访问控制；在此环境下，对象为表、视图、过程等。<br>
<!-- -->通过强制访问控制，安全策略由安全策略管理员集中控制；用户无权覆盖策略，例如不能给被否决而受到限制的文件授予访问权限。 相比而言，自主访问控制（DAC）也控制主体访问对象的能力，但允许用户进行策略决策和/或分配安全属性。（传统Unix系统的用户、组和读-写-执行就是一种DAC。）启用MAC的系统允许策略管理员实现组织范围的安全策略。 在MAC（不同于DAC）下，用户不能覆盖或修改策略，无论为意外或故意。这使安全管理员定义的中央策略得以在原则上保证向所有用户强制实施。</p>
</blockquote>
<p>类似DAC,但是授权的比较强制。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="rbacrole-base-access-control">RBAC（Role Base Access Control）<a href="https://blog.teaho.net/article/access-control-model#rbacrole-base-access-control" class="hash-link" aria-label="Direct link to RBAC（Role Base Access Control）" title="Direct link to RBAC（Role Base Access Control）">​</a></h2>
<p>以角色为基础的访问控制（英语：Role-based access control，RBAC），是资讯安全领域中， 一种较新且广为使用的访问控制机制，其不同于强制访问控制以及自由选定访问控制直接赋予使用者权限，而是将权限赋予角色。1996年，莱威·桑度（Ravi Sandhu）等人在前人的理论基础上，提出以角色为基础的访问控制模型，故该模型又被称为RBAC96。 之后，美国国家标准局重新定义了以角色为基础的访问控制模型，并将之纳为一种标准，称之为NIST RBAC。</p>
<p>以角色为基础的访问控制模型是一套较强制访问控制以及自由选定访问控制更为中性且更具灵活性的访问控制技术。</p>
<p>RBAC的发展过程中有几个：</p>
<ol>
<li>
<p>RBAC0<br>
<img loading="lazy" src="https://blog.teaho.net/assets/images/RBAC0_model-b0e29ffcae465c3c3654df74c7b43087.jpg" width="741" height="268" class="img_zKyM"></p>
</li>
<li>
<p>RBAC1模型，基于RBAC0上增加了多层次角色，比如，有些系统增加子角色，子角色可以继承父角色的所有权限。<br>
<img loading="lazy" src="https://blog.teaho.net/assets/images/RBAC1_model-113bff682a12279a7700d604c6dfd746.jpg" width="741" height="268" class="img_zKyM"></p>
</li>
<li>
<p>RBAC2模型，基于RBAC0的基础上，增加了静态和动态职责，举例来说，静态职责可以是规定一个用户只能有3个以内的角色。动态职责可以是同一角色同一时间下只能有三个用户登录系统。<br>
<img loading="lazy" src="https://blog.teaho.net/assets/images/RBAC2_model-7d545b7d233b5c450d0642ce01dbb318.jpg" width="741" height="371" class="img_zKyM"></p>
</li>
<li>
<p>RBAC3模型，基于RBAC0的基础上加上RBAC1和RBAC2的特性。<br>
<img loading="lazy" src="https://blog.teaho.net/assets/images/RBAC3_model-67e28f8e24270d96d6853dab36c6f875.jpg" width="741" height="371" class="img_zKyM"></p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="最终设计">最终设计<a href="https://blog.teaho.net/article/access-control-model#%E6%9C%80%E7%BB%88%E8%AE%BE%E8%AE%A1" class="hash-link" aria-label="Direct link to 最终设计" title="Direct link to 最终设计">​</a></h2>
<p>我们最终采用了RBAC0的模型，设计并开发了权限系统供内部系统使用。</p>
<p>结构图如下：
<img loading="lazy" src="https://blog.teaho.net/assets/images/%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1-939f9dde6a5d476a3352cac008f1e831.jpg" width="871" height="421" class="img_zKyM"></p>
<p>注：其中，页面和API的权限分开治理，二者关联点在于多页面持有的相同API，多个页面的展示权限都没有了，才会关闭API权限。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">Reference<a href="https://blog.teaho.net/article/access-control-model#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2>
<p>[1]<a href="https://media.techtarget.com/searchSecurity/downloads/29667C05.pdf" target="_blank" rel="noopener noreferrer">CISSP Certification All-in-One Exam Guide|Chapter 5</a><br>
<!-- -->[2]<a href="https://tech.youzan.com/sam/" target="_blank" rel="noopener noreferrer">有赞权限系统(SAM)</a><br>
<!-- -->[3]<a href="https://web.archive.org/web/20060527214348/http://www.radium.ncsc.mil/tpep/library/rainbow/5200.28-STD.html" target="_blank" rel="noopener noreferrer">Department of Defense Trusted Computer System Evaluation Criteria</a><br>
<!-- -->[4]<a href="https://zh.wikipedia.org/wiki/%E4%BB%A5%E8%A7%92%E8%89%B2%E7%82%BA%E5%9F%BA%E7%A4%8E%E7%9A%84%E5%AD%98%E5%8F%96%E6%8E%A7%E5%88%B6" target="_blank" rel="noopener noreferrer">基于角色的访问控制</a></p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="code" term="code"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[是枝裕和--镜头渗透着人文情怀]]></title>
        <id>https://blog.teaho.net/article/shi-zhi-yu-he</id>
        <link href="https://blog.teaho.net/article/shi-zhi-yu-he"/>
        <updated>2017-06-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[从镜头的角度解读是枝裕和]]></summary>
        <content type="html"><![CDATA[<p>从镜头的角度解读是枝裕和</p>
<p>是枝裕和近几年可谓高产，而且质量保持的很好。</p>
<p>我是怎么知道是枝裕和的呢？ 其实，我最先在网上看到的是枝的作品是《步伐不停》，还有从身边听说的《空气人偶》。不过，真正打算去翻是枝的作品倒是直到《海街日记》在豆瓣看到一位我敬仰的大v说，是枝越来越像大师了。话不多说，先立个flag，我觉得是枝裕和最引人入胜的是他的镜头，最令人动容的是他的作品总吐露着一颗人文关怀的心。</p>
<p>分析下，是枝广受关注的近几部电影。</p>
<p>无人知晓
<img loading="lazy" alt="img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjsAAAAUCAIAAADk0WvGAAAIH0lEQVR4Xu2bLZekOBSG+RfIki1LIpElkSWRSCR2zmmBGIFogRiBWIFYgWhRogUSsQIxoiRiBGIEYgViBJubBEhC+Kja3u2i5z6nRZPcG7gk5M1XGR2CIAiC7AFDTUAQBEGQhwQVC0EQBNkHqFgIgiDIPkDFQhAEmVCERlioichHg4qFIO9PlZzcrFFTZbbY7JfdR4eK1XN3Vd7tuMCCYpWh8cWQ//oa/FXnf3qnZ5MmPp3iOK/nvA7WS1T81GbxAotESnReWVnN9S10wyeTJprPtpukpVLOC38b9asDl4ncvjS3o3/MbC6EZa+ua4uAPdIxLYdb9V7Ywn8r2mvqnw6GYZhPJz+9tmNOnTpOWtNeT2FsIr0NoSki1/EC33XkYjpob6Eleu0FIbrdUV1C14J6JRws242Koddt68wzSfJMbCRqqbZHS6HMg+V4STl25CtlUhZsWAtR8uo89pw+hq2tpylij7Zn2UOpSngS5THWHTUtXH1XG59yXbEmBbVlFJKO3jy/VnBZpWcws6Pv9EEkryZPjnAZxlc1S0bNqtIItMSKs4qW2lxTL+zFjBub5pdj9B0S9IrVw3Mj4SUvh0DReAFt/o2JnGE8R6Nkqc+PfH6ai2daIevMSAsyj2N70HfX4DAmjzaQ7l1o07vGtiU0KyjXtvaoWPo3sAegNsgYxM8vdI7VXLPAzyASqYedCY7bqLmsTOMY5A1MPKjNKaluKnPGBlqekscl7CQI7QbAywoutTxg6qSqHB5FfIwNjtoWDoVNwlnndsWqshOkf4UXzuCdO0tRvP4KxsuZAgE5q3lzVUkg/EjDC42PGUdR9GKaL5fmdsVaCUFMURSrzX14Ts97AckMh+dbCA35pMAX5+f8O1UvNJ9iGR2PYdF/16MNaVPjl0smZYPykc7ocE4rmKc9aMOCR/NiNtE8OHE5dFriGyjjYW7hCiaPCpsW2wm8d81rn9EkzkxuGVJVCVhx7A5C7zHjJaG1odpknsNAzLvGoFfC+GkTVXLSu0was6I0Gxz1Lfz/Uqw6i2CGIa2JXaMjWJ6zn7LXrzqL6VTpD9pQ9QVSpCx+C/MP3XvoBsVKq+/kvjBUuVGx1kJgRqoX0Lx5kPgtr2iu+a3voxZCQz4rdeYezFOQFnVzjc921PfGTebSAbQE+T7JMHMY9Ao2kthV5IJ2bKQzsm0qcA+uWDC87tiDD1Fr3wDpSk+gBGryg8E6fKKvh4NxCrOSLfIMaJVjgOcyxrXitqSzHpsuNZGXY5i2f6lUr5kyGRobOr0is/xWyqsSm174wfkJJovkIYRbzVFnZ8Px/BO4HESPaVXKSrPFUd/Cx3dlPp23zwfXFUv4A0moU9rd97tNFHJvMKBhqF5P3ltvqWYJGiMrlngLcZdLWhUELWmyF5ANph/bFWslBJagenVQCTC1MnzSj5CRBdgHvB5Qsf4twre++OU+ElXuO47vw/7E0Rs2oJqLN+mXySjTFJf7RBvSlEZFYt1BVSVnJlfdwytW/2jC/7o3AHx0JNvaWHtNXOh/Bw5uVg25GuXQ0vbLdfzoAalRVphFWgsRLHG/ckuZqg2fXqWVmse3TlnPxFcgLSqVS0ARbkpX9lpw6j00Vako1gZHTQuXIq0vgTUOd1ZYV6y751htwTex+i9VX+A0azrHkjVmVCwYvBy/OGFym2KthMCMVK+u+5m5YMNGylUS9urVLYaGfFLKyBqWQ5o8tMwz3e7QfONgag6DzE6x0YxAha51YLE/+yD0iqW8gaZIfNe2uQjs5RMhiuMaJ8dhC5rj7FhVjgW4dpCISf2Tf2BNuG3K1KOTOGHGvaVM1YYXrhIW410BaE/GStEAFK8RFV1jnirWmqOmhfOcHpgYCisQS9ysWJpNIClF9Pq7CJ6hW7cS2q/PFAjIWbzAcR9rVrGGLPjbqlhrIVCmXjxF+aMbaUuhIZ8T9nVW/WXfYWu+cZJkSiNI2Ua/yj/y0TOTBbSKJUcHr8kKLlXTPnQkGgrYx+JCcZu6cIoALM2wVHz45biRtaXMJRspj68K8idechMhlTYagahQf01jFmUJ2OK41sJhSHecypie2xVLOWgHs18w054VpAu4cGmFZTtbYKd6Qej8rGBKT4EuKNZ43Hy7Yq2EoPeqkq9wF/etb7t8Wuaqu3fI7wFseFghnP7q6LoGHTSTj1P5HtsiFE9cQIpiA4o2OUk18sD9vE6xlOjG0TNd+3nUSEbqzPeTomohoOCSB0d6cHCovqkEQG/Lj/4V4Sm8XGmL6FcFaXWyORZfw2tomSyDsVjmrM2InAdrcP0zt0RPlIJmgEbITr42RcjaslqVHFmxNjnqWnidhVHODhjSk7bSJ7LAHYrVzf+YqZt6tUVi0RQ/L1iW+Admc7/HKl/H32Mdnh0vSfIfgihOtOQGxeoWQ6CoXnzjSmwxZURnkKBhPGo1NORTAz8yoefgYHub7nWonyrrP+RuZmpD2nqs/lplZF+KNYmuLSI4SghbN7H3sJGMQKXa/S+ZzKfx11hcF0SgYqm48P62yjynX/6Eo5FhNmxuFuPvow4WVDMtdEOZczYCqppVF9824dnhWUybnqlfpy1jflbjzI50TqpSeZT+fhscNS28LROPntcAv3DD4RDOgmIhCHITmk91whab/fKJoqOrgmriBBAX8RDoe/AuZbYNRR3/bOfuqrzbcROoWAjyTrR5MFnTU9lis18+U3SbFAsWPTesud3Ef1Hm7dxdlXc7bgMVC0EQBNkHqFgIgiDIPkDFQhAEQfbBP6CihXZDV+c3AAAAAElFTkSuQmCC" width="571" height="20" class="img_zKyM"></p>
<p>步伐不停
<img loading="lazy" alt="img" src="data:image/png;base64,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" width="582" height="26" class="img_zKyM"></p>
<p>空气人偶
<img loading="lazy" alt="img" src="data:image/png;base64,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" width="583" height="18" class="img_zKyM"></p>
<p>奇迹
<img loading="lazy" alt="img" src="data:image/png;base64,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" width="581" height="19" class="img_zKyM"></p>
<p>如父如子
<img loading="lazy" alt="img" src="data:image/png;base64,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" width="608" height="22" class="img_zKyM"></p>
<p>海街日记
<img loading="lazy" alt="img" src="data:image/png;base64,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" width="616" height="18" class="img_zKyM"></p>
<p>比海更深
<img loading="lazy" alt="img" src="data:image/png;base64,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" width="574" height="20" class="img_zKyM"></p>
<p>可以看出是枝自《如父如子》后，开始获得商业上的成功。</p>
<p>在戛纳上，是枝总共获得4个提名，2个奖。基本是大奖，是枝屡受戛纳的青睐。虽《空气人偶》把控力不足更像是是枝的一个新探索，但也将裴斗娜带向国际。仅《比海更深》 从主竞赛单元降格到了二级单元（一种关注单元 ）。</p>
<p>从内容表达上来讲，《无人知晓》是对社会事件的再讲述；因母亲过世为创作缘起的《步履不停》是他对三代关系中情感故事的演绎与互动，拍得克制而收敛；《空气人偶》则是较为特别地没有讲述家庭，转而细道社会独立（或者说是孤立）个体的描述和对存在、自我的探索；《奇迹》再回归到家庭亲子关系，是一个少有的很温情的治愈系的故事；《如父如子》是讲述一位事业成功的父亲对父亲角色的审视与纠正，同时延伸了不少社会父子问题的思考；《海街日记》则是讲述镰仓四姐妹，囿于家庭和现实的隐隐无奈，同时又有亲人嬉戏的温暖，当然也是羁绊、关系交错的真实人生写照；《比海更深》以废柴作家的角度重现了一个破裂家庭的温情时刻。</p>
<p>是枝裕和以纪录片导演出身，后又成为20世纪90年代晚期“新日本电影新浪潮”的代表。是枝导演与台湾的联系是密切的，他曾拍摄记录片《当电影映照时代：侯孝贤和杨德昌》，并参演《 光阴的故事－台湾新电影 》。据说他的偶像是侯孝贤。所以是枝导演的手法思想是受上世纪70、80年代台湾新浪潮的影响的。虽说偶像是侯孝贤，但我总觉得他的镜头里有一些杨德昌的味道，特别是一些讲故事的态度上。</p>
<p>是枝裕和每部电影总有用空镜头，但作用却有所不同。</p>
<p>大多时候，是枝裕和的空镜头使用中长焦，拍摄全景或远景，烘托情感并控制节奏的。例如，</p>
<p>《无人知晓》中，当孩子跑下楼梯，冲出楼道去玩耍后，会留一个空镜。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi8-3fc43bc4e0f641b6eb47b78c723fb108.png" width="1252" height="705" class="img_zKyM"></p>
<p>当孩子在街上奔跑前，会先留个空镜，画外音会听到孩子们的笑声，然后片刻，孩子才出现在镜头前。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi9-0fcb4e841b823be4796cb63470d5104e.png" width="1253" height="704" class="img_zKyM"></p>
<p>《步伐不停》，伴随着家人的谈话，家中门关及摆设的空镜。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi10-804ff8f8068e89a296300d0f433d29c7.png" width="1310" height="703" class="img_zKyM"></p>
<p>炸玉米饼。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi11-0b39a2b9fef228addbd69a5628224a19.png" width="1314" height="703" class="img_zKyM"></p>
<p>浴室里的几块碎瓷片和用脸盆冰着的西瓜。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi12-d2e5a1e811230bb4a95ee75557e3e646.png" width="1311" height="702" class="img_zKyM"></p>
<p>《奇迹》中片尾的留白。引人联想。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi13-162e1c398df0df26397ee46e9abf241e.png" width="1304" height="704" class="img_zKyM"></p>
<p>此外，在《海街日记》中，有一个空镜用来暗示季节的变化。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi14-3990bd4b05ca7f2a70f4840eec63de18.png" width="1253" height="702" class="img_zKyM"></p>
<p>也会有不同用途的近镜，不如《海街日记》里有个镜头是浴室的下水道，爬着一只虫子的小细节。这个空镜不仅是烘托情感，还推动了情节发展，更表达了一种生活感，写实感。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi15-1c5a385a2092ff2e17d4b44b8954f858.png" width="1255" height="705" class="img_zKyM"></p>
<p>在《比海更深》里，有一个伴随着天气播报台风情况的近景，相当的写实，随台风的余韵而摇摆的衣服，彩票，具有记录感，并且将贯穿全片的一个意象--彩票再一次放到观众眼前，渲染了意境，情景交融，观众一瞬间就进入到这个情景中。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi16-85efae483a8f48848be6e85a29cda25c.png" width="1254" height="702" class="img_zKyM"></p>
<p>从以上可看出是枝裕和的镜头是朴实不过的了，他经常会在空镜头时插入一些家人的对话、电视声音、缓缓飘过的音乐来引导观众。他的空镜头大多是定镜，时不时和空镜头组合在一起的定镜头，也是是枝裕和的常有手法之一，从《步伐不停》确立风格后，那种带有浓浓日本情怀的定镜可算是他的烙印。</p>
<p>以最为人称道的《步伐不停》为例。《步伐不停》中的移动镜头屈指可数，只有捕捉蝴蝶（符号之一）时和开头煮菜移动了镜头。</p>
<p>中距的定镜再搭配日常的日式饭席，有点发旧的拉门，平常的榻榻米等等，这些元素加起来，写实平和。浓烈的生活气息。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi17-eba560266688c56ece44a475f0948211.png" width="1311" height="706" class="img_zKyM"></p>
<p>使用定镜，符号式的，寓意人生路途，步伐不停的多次出现的楼梯。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi18-47ceb79e2a3091e7bcf4b358d511ed71.png" width="1311" height="703" class="img_zKyM"></p>
<p>《海街日记》中，用中远距离捎带上一些夏季花火大会的传统吉祥物？，梅子酒，当然还有四姐妹美美哒和服。色调为淡蓝（可能也有夜晚的考虑），辅助光和轮廓光打的恰到好处，写实感满分。同时，使用该构图（注意两只伸出来碍眼的门）而不直接拉近景，有表达一种全片的命题：在姐妹亲情的嬉闹温暖中，又有无奈于各种亲人关系，恋人关系的真实人生写照。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi19-1fbbb755310e6d061ea3f67dcf3b8f10.png" width="1253" height="704" class="img_zKyM"></p>
<p>《无人知晓》也是用了一个定镜来表达孩童游戏。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi20-900b41e69edb0153bbe46649f6bf953b.png" width="1253" height="704" class="img_zKyM"></p>
<p>除却定镜，我想谈论下是枝导演最令我动容、黯然神伤的背影与意味深长的收尾。</p>
<p>《无人知晓》</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi21-21ed4da143c21dd7ea022e806acc2d06.png" width="600" height="392" class="img_zKyM"></p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi22-d19871a4a5397b9e1be82a9277266d6d.png" width="1254" height="703" class="img_zKyM"></p>
<p>《步伐不停》</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi23-fbeb2c786b7d8dbca34952f4f0681e86.png" width="1366" height="738" class="img_zKyM"></p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi24-a3b5df5ba5e5a2c7be759b9e0a431d1e.png" width="768" height="432" class="img_zKyM"></p>
<p>《空气人偶》</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi25-4682590ff15a88a8873011c5361ed5f5.png" width="572" height="180" class="img_zKyM"></p>
<p>《奇迹》</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi26-8c07a5c70d2d2db7ba1f8871c1ef83f9.gif" width="540" height="302" class="img_zKyM"></p>
<p>《海街日记》</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi27-197af0c8c1189a5e391612fdd8507d3b.png" width="600" height="401" class="img_zKyM"></p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi28-20e9956e889b125d0934a101de4414ac.png" width="1253" height="703" class="img_zKyM"></p>
<p>《比海更深》</p>
<p>这张让人想起桃姐。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi29-ec97ad560938cf19bcb661f7e1229efe.png" width="1249" height="704" class="img_zKyM"></p>
<p>一般，背影总让人联想到离别、分离，而是枝的镜头更时不时透露这一种关怀。当镜头缓缓拉过，我们更多体验到一种感同身受。</p>
<p>我认为讨论下是枝裕和的《如父如子》里镜头的对比也是很有趣的。《如父如子》诉说的是医院意外造成的儿子互换的事故，数年后，在两个家庭的发现并对待这一事件的态度和心理变化来道出一些亲子的至理，这些至理并不总是通过内容而是通过多种细节去传递给观众。其中，在镜头下的两个家庭的对比是枝处理得挺入微。</p>
<p>先看下海报，其实从海报我们已经可以管中窥豹。海报左侧是野野宫一家，海报右侧是斋木一家，左边福山雅治扮演的野野宫良多一脸严肃，其妻子双手放于身前，显得贤淑文静，而儿子庆太略略低头则显得内向。而右边斋木一家，他们不太端正的站姿，脸上的笑颜，可知他们是比较不拘一格，比较easy going的一家。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi30-e7d7d98949bf12d4b46f8c502cbecf1c.png" width="600" height="850" class="img_zKyM"></p>
<p>当然，对比不至于海报。</p>
<p>由以下两图可比较家庭关系。</p>
<p>此图，使用了长焦远距离拍主要人物，架构得比较远which也让人觉得远，并且背景为蓝色调的有一种和众生远离，孤独在空中的感觉，以上的这些表现了这一家的疏离感。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi31-d70a5801f51d144558ea72edcbe08711.png" width="1254" height="679" class="img_zKyM"></p>
<p>用平胸，短焦距表现人气接地气和亲和力，一种温馨的家庭就餐跃然画面。（其实这里我并不理解用冷光，难道是以孩子庆太的视角调光的？）</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi32-8b43566fc8ce385a9122ad19172c4e64.png" width="1254" height="680" class="img_zKyM"></p>
<p>当然，是枝还有个比较大的特点是异于常人的冷静和克制，比如《无人知晓 》中，主角小妹妹的死亡刻画。</p>
<p>首先出现的是妹妹的画</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi33-8679fc9c8846781348d87959468f3ece.png" width="1252" height="703" class="img_zKyM"></p>
<p>第二是，妹妹的静止不动的手。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi34-56093779009ffb32a23934afed55223b.png" width="1250" height="704" class="img_zKyM"></p>
<p>轻抚妹妹的头发。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi35-3b45a4c3477ddcd382210deb5245ef65.png" width="1254" height="700" class="img_zKyM"></p>
<p>姐姐还说了句。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi36-fb9dc7a97ea899fca2db24de72591c34.png" width="1253" height="702" class="img_zKyM"></p>
<p>最后，下葬妹妹的地方--机场附近（因为妹妹喜欢看飞机）。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi37-230dcabca1d85c52de405f5c2bcf89f4.png" width="1253" height="703" class="img_zKyM"></p>
<p>主角仰望天空时对妹妹的缅怀。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi38-a21d4aca7b73ee20ffcf01b6130829fd.png" width="1252" height="701" class="img_zKyM"></p>
<p>整个过程，其他兄妹没有悲伤的哭泣，没有脸部表情，导演的拍摄也只是扫了下公园停下来的游乐设施，妹妹的画、手、额头，然后整个送别过程也是伴随几句对白，几个苍白的动作而过。整个过程，死去的妹妹一个正面的镜头，亲兄妹的悲伤与不舍，妹妹弥留的镜头，这些统统都没有。有的只是导演写实自然的镜头，对事件不予置评的冷静（毕竟纪录片导演出身），克制的表达。</p>
<p>但有时，是枝拍摄的戛纳最年轻影帝--柳乐优弥的一个表情，却不得不令你动容。</p>
<p><img loading="lazy" alt="img" src="https://blog.teaho.net/assets/images/shizhi39-f0d23a39ef1b23e5eee19789815ca33b.gif" width="640" height="360" class="img_zKyM"></p>
<p>虽说了是枝百般好，但我对是枝的作品还是有不满的：缺少时代感。例如杨德昌导演的《 牯岭街少年杀人事件》会有罕见的时代背景下的审视与冷静。当然这只不过是我的喜好，专注于家庭关系的是枝也是顶好的。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="ending">ending<a href="https://blog.teaho.net/article/shi-zhi-yu-he#ending" class="hash-link" aria-label="Direct link to ending" title="Direct link to ending">​</a></h2>
<p>之前有朋友跟我说看电影写点评很废，且很多人过分解读，但我觉得看电影写文章就像翻译，由电影创作者去创作，而由观众去审视、解读。已故文学工作者曾希邦先生发过一条微博来形容翻译：</p>
<blockquote>
<p>我几乎天天接触翻译，所以，我的微博话题，总离不开翻译。我一再强调，翻译是不可能的，翻译只是从不可能中，寻求可能，如此而已。我相信，我这几句话，是可以传世的诤言，因为，它包含了真理。翻译永远无法超越原文。翻译，充其量只能重现原文的意境。一个真正懂得翻译的人，决不敢轻易批评他人翻译。</p>
</blockquote>
<p>所以，文章不可能超过电影本身，我写影评更多是为了再理解，和实践。</p>
<p>一口气看了七部是枝裕和的作品，不想写得空泛，又因为我看了些电影的书，所以希望写篇文章实践下，就找了个摄影的角度入手（额，貌似也有点空）。</p>
<p>其实，是枝裕和的作品还有不少给我留下深刻印象的东西： 柳乐优弥的表演，树木希林大神级接地气的演技，还有如上稍微提及的对比，符号，打光等等。主题里的人文关怀，是枝当然不止以上的所说的镜头，还有，其实日本文化里对食十分讲究，是枝的这几部电影都有不止一个关于食的镜头，对原生家庭的问题，传承都有提及。</p>
<p>很多时候，他影片中，或许一声孩子的嬉笑声，或许一位电车乘务员的一个手势，或许一罐淡淡的梅子酒，或许一个微不足道的角色朝镜头的一个驻足观望就已经征服观众了。以上，在我看来，是枝裕和是个严谨，注重细节，充满人文气息的导演。《第三次的杀人》要来了，期待吗？</p>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="film" term="film"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[设计模式学习笔记]]></title>
        <id>https://blog.teaho.net/article/design-pattern</id>
        <link href="https://blog.teaho.net/article/design-pattern"/>
        <updated>2017-04-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[设计模式(Design pattern)是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。]]></summary>
        <content type="html"><![CDATA[<p>设计模式(Design pattern)是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。</p>
<p>首先呢，本来开发这个blog的目的是对知识的自我学习，归纳总结的。没想到原型、基本的框架都搞好后，才发现gitbook是真爱。。洗湿了头，所以就继续开发出来罗。</p>
<p>喜欢gitbook主要是因为，我更偏向于不断积累穷尽知识点，形成体系。所以之后的blog，只要是大的知识点都会用gitbook实例。</p>
<p>本文档是设计模式的学习笔记，主要目的是自我学习设计模式。文章主体请 <a href="https://design-pattern-learning.gitbook.teaho.net/" target="_blank" rel="noopener noreferrer">点击这里</a> 。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="模式列表">模式列表<a href="https://blog.teaho.net/article/design-pattern#%E6%A8%A1%E5%BC%8F%E5%88%97%E8%A1%A8" class="hash-link" aria-label="Direct link to 模式列表" title="Direct link to 模式列表">​</a></h2>
<p>我主要是按《深入浅出设计模式》的顺序来写的，书中说到目前还受欢迎的设计模式也是我目前所写到的10多个，当然以后有空还会将GoF那本书余下的模式一个个补上。</p>
<ul>
<li>
<p>创建型： 单例模式 工厂方法模式 抽象工厂模式 建造者模式 原型模式</p>
</li>
<li>
<p>结构型： 代理模式 适配器模式 装饰模式 桥接模式 组合模式 享元模式 外观模式</p>
</li>
<li>
<p>行为型： 观察者模式 模板方法模式 命令模式 状态模式 职责链模式 解释器模式 中介者模式 访问者模式  策略模式 备忘录模式 迭代器模式</p>
</li>
</ul>]]></content>
        <author>
            <name>teaho2015</name>
            <uri>https://github.com/teaho2015</uri>
        </author>
        <category label="design-pattern" term="design-pattern"/>
    </entry>
</feed>