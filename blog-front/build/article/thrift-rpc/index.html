<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">Thrift传输原理 | Tea&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.teaho.net/article/thrift-rpc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Thrift传输原理 | Tea&#x27;s Blog"><meta data-rh="true" name="description" content="Thrift传输原理"><meta data-rh="true" property="og:description" content="Thrift传输原理"><meta data-rh="true" name="keywords" content="thrift"><meta data-rh="true" property="og:image" content="https://blog.teaho.net/img/blog/thrift/header.png"><meta data-rh="true" name="twitter:image" content="https://blog.teaho.net/img/blog/thrift/header.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-05-06T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/teaho2015"><meta data-rh="true" property="article:tag" content="thrift"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://blog.teaho.net/article/thrift-rpc"><link data-rh="true" rel="alternate" href="https://blog.teaho.net/article/thrift-rpc" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.teaho.net/article/thrift-rpc" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0T8ST6E0FN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0T8ST6E0FN",{})</script>







<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?751fad25d8bfffcee48a1a764be9d401";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#12affa">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="teaho2015 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="teaho2015 Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="teaho2015 JSON Feed">
<meta name="description" content="headTagsContent">
<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/misans@4.0.0/lib/Normal/MiSans-Normal.min.css">
<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/misans@4.0.0/lib/Normal/MiSans-Semibold.min.css"><link rel="stylesheet" href="/assets/css/styles.b54a7859.css">
<script src="/assets/js/runtime~main.5a1c687d.js" defer="defer"></script>
<script src="/assets/js/main.62481473.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_VIjG" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_DtP3"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Tea&#x27;s Blog" class="themedComponent_TcKe themedComponent--light_eba_"><img src="/img/logo.png" alt="Tea&#x27;s Blog" class="themedComponent_TcKe themedComponent--dark_CFQW"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Tea&#x27;s Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/collections">合集</a><ul class="dropdown__menu"><li><a href="https://spring-source-code-learning.gitbook.teaho.net" target="_blank" rel="noopener noreferrer" class="dropdown__link">Spring、Spring Boot、Spring Cloud剖析<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://design-pattern-learning.gitbook.teaho.net" target="_blank" rel="noopener noreferrer" class="dropdown__link">Design Pattern分析<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://java-api-learning.gitbook.teaho.net" target="_blank" rel="noopener noreferrer" class="dropdown__link">Java8基础API分析<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://offer-prepare.teaho.net" target="_blank" rel="noopener noreferrer" class="dropdown__link">Java开发知识点总结<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://travel-around-china.gitbook.teaho.net" target="_blank" rel="noopener noreferrer" class="dropdown__link">环游中国多省的一些记录<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://mysql.gitbook.teaho.net" target="_blank" rel="noopener noreferrer" class="dropdown__link">Mysql query optimization summary<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://dubbo-learning.gitbook.teaho.net" target="_blank" rel="noopener noreferrer" class="dropdown__link">dubbo一些笔记<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/docs/ai-arch">算法架构和人工智能</a></li><li><a class="dropdown__link" href="/docs/k8s">容器和Kubernetes</a></li></ul></div><a class="navbar__item navbar__link" href="/archive">归档</a><a class="navbar__item navbar__link" href="/about">关于/联系</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">更多</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/changelog">changelog</a></li></ul></div><div class="navbarSearchContainer__XZP"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LBCs"><div class="container margin-vert--md"><div class="row"><aside class="col col--2"><nav class="sidebar_me8e thin-scrollbar" aria-label="Blog recent posts navigation" style="opacity:0"><div class="backButton_Rxyd"><span></span></div><a class="sidebarItemTitle_MDMA margin-bottom--sm" href="/blog">Blogs</a><ul class="sidebarItemList_t5AC clean-list"><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/teamwork-measure">技术支撑团队的指标评估和实施</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/maotai2023sudu">茅台2023财报速读</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/house-market">中国的房市是怎么运转的？</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/europe">欧洲旅游疑问集</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/tea-and-wink">茶饮和酒饮的分类</a></li><li class="sidebarItem_PSMt"><a aria-current="page" class="sidebarItemLink_nW7C sidebarItemLinkActive_hG8J" href="/article/thrift-rpc">Thrift传输原理</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/sentinel-core">Sentinel core原理分析</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/java-container-args">容器环境下的相关JVM参数</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/java-modular">Java模块化</a></li><li class="sidebarItem_PSMt"><a class="sidebarItemLink_nW7C" href="/article/java11-feature">Java11特性分析</a></li></ul></nav></aside><main class="col col--8" itemscope="" itemtype="h ttp://schema.org/Blog"><article class="article_y69D" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://blog.teaho.net/img/blog/thrift/header.png"><div class="cover_ksob"><div class="coverMask_km0g" style="background-image:url(&quot;/img/blog/thrift/header.png&quot;)"></div></div><div style="height:120px"></div><header style="position:relative;z-index:2"><h1 itemprop="headline">Thrift传输原理</h1><div class="container_iJTo margin-bottom--md"><div class="date_ZxYJ"><span></span><time datetime="2024-05-06T00:00:00.000Z" itemprop="datePublished" class="truncate">May 6, 2024</time></div><div class="tagInfo_Ym7h"><span></span><div class="truncate tagList_aAIV"><div><a class="tag_b1dr tagRegular_t85v tag" href="/tags/thrift">thrift</a></div></div></div><div class="date_ZxYJ"><span></span><span class="truncate">6 min read</span></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody" style="position:relative"><p>Thrift算是一种常见的RPC框架，我工作中也常常接触到。</p>
<br>
<blockquote>
<p>基于0.5.0版本</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="简介">简介<a href="#简介" class="hash-link" aria-label="Direct link to 简介" title="Direct link to 简介">​</a></h2>
<p>Thrift作为一种接口定义语言（IDL）和二进制通信协议被应用在程序设计的服务创建和定义中，我们更常见称呼Thrift为RPC框架。
在使用Thrift中，我认为Thrift有如下特点：</p>
<ol>
<li>支持语言众多。拥有自成一体的IDL，各种语言C++、Java、Python等都有实现。</li>
<li>传输性能优秀。RPC性能对比不错，很多大公司，还有组件（Hadoop、Hive等）都使用它。</li>
</ol>
<p><img loading="lazy" alt="img.png" src="/assets/images/wiki_thrift-67b0c5a19cd16cda2c641006d6fed464.png" width="546" height="987" class="img_zKyM"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="组件职责和传输">组件职责和传输<a href="#组件职责和传输" class="hash-link" aria-label="Direct link to 组件职责和传输" title="Direct link to 组件职责和传输">​</a></h2>
<p>Thrift官网有介绍Thrift Server的网络层和各组件作用，我们跟着顺藤摸瓜：</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Server</span><span class="token plain">                                    </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">single</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">threaded</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> event</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token plain">driven etc</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Processor</span><span class="token plain">                                 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">compiler generated</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">                      </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Protocol</span><span class="token plain">                                  </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token known-class-name class-name" style="color:hsl(29, 54%, 61%)">JSON</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> compact etc</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">                       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token maybe-class-name" style="color:hsl(29, 54%, 61%)">Transport</span><span class="token plain">                                 </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">raw </span><span class="token constant" style="color:hsl(29, 54%, 61%)">TCP</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(29, 54%, 61%)">HTTP</span><span class="token plain"> etc</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">                       </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">--</span><span class="token operator" style="color:hsl(207, 82%, 66%)">-</span><span class="token operator" style="color:hsl(207, 82%, 66%)">+</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="img.png" src="/assets/images/thrift_invoke_process-933b42345aedd4a5563dfd108c7ef059.png" width="1333" height="683" class="img_zKyM">
上图给出整体流程图，我这里一一说下：</p>
<ul>
<li><strong>Transport</strong> 网络传输封装，TCP、HTTP之类。最终传输层协议实现有在类中生成socket，也有会抽象一层TSocket去做。<!-- -->
<ul>
<li>TFramedTransport</li>
<li>TNonblockingTransport</li>
<li>THttpClient</li>
</ul>
</li>
<li><strong>Protocol</strong> 传输序列化协议<!-- -->
<ul>
<li>TBinaryProtocol</li>
<li>TCompactProtocol</li>
<li>TJSONProtocol</li>
</ul>
</li>
<li><strong>TProcessor</strong> thrift代码生成，传输及序列化流程处理</li>
<li><strong>TServer</strong> 处理网络流程执行，数据处理整个流程<!-- -->
<ul>
<li>TSimpleServer</li>
<li>TThreadPoolServer</li>
<li>TNonblockingCompleteServer</li>
</ul>
</li>
<li><strong>Client和TServiceClient</strong> thrift生成的代码，client端调用使用</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="协议分析">协议分析<a href="#协议分析" class="hash-link" aria-label="Direct link to 协议分析" title="Direct link to 协议分析">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="strict-binary协议">Strict Binary协议<a href="#strict-binary协议" class="hash-link" aria-label="Direct link to Strict Binary协议" title="Direct link to Strict Binary协议">​</a></h3>
<p>调用示例</p>
<div class="language-Thrift language-thrift codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-thrift codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">enum TypeEnum {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">UNKNOWN = 0;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">ADMIN = 1;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">NORMAL = 2;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">struct Req {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">1:i32 id;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">2:TypeEnum type;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">3:string name;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">4:map&lt;string, string&gt; parameters;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">5:bool fill_info;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">struct UserInfo {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">1:i32 id;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">2:TypeEnum type;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">3:string name;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">4:map&lt;string, string&gt; parameters;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">5:bool status;</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">service SimpleThriftService {</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">string knock(1:string msg);</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">UserInfo getUserInfo(1:Req req);</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-Java language-java codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-java codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token class-name" style="color:hsl(29, 54%, 61%)">TTransport</span><span class="token plain"> transport </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TSocket</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;localhost&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">9090</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TProtocol</span><span class="token plain"> protocol </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TBinaryProtocol</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">transport</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">SimpleThriftService</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Client</span><span class="token plain"> client </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">SimpleThriftService</span><span class="token class-name punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Client</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">protocol</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">transport</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">open</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Req</span><span class="token plain"> req </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">Req</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">TypeEnum</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token constant" style="color:hsl(29, 54%, 61%)">NORMAL</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;test&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">HashMap</span><span class="token generics punctuation" style="color:hsl(220, 14%, 71%)">&lt;</span><span class="token generics class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token generics punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:hsl(29, 54%, 61%)">String</span><span class="token generics punctuation" style="color:hsl(220, 14%, 71%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token function" style="color:hsl(207, 82%, 66%)">put</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;k&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(95, 38%, 62%)">&quot;v&quot;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(29, 54%, 61%)">false</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token class-name" style="color:hsl(29, 54%, 61%)">UserInfo</span><span class="token plain"> userInfo </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">.</span><span class="token function" style="color:hsl(207, 82%, 66%)">getUserInfo</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">req</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="分析字节码">分析字节码<a href="#分析字节码" class="hash-link" aria-label="Direct link to 分析字节码" title="Direct link to 分析字节码">​</a></h4>
<p>以使用最广的<code>strict Binary</code>协议为例，基于上面示例调用，进行了抓包，结合文档对字节码进行直观分析。
注：wireshark抓包的话自带了一些方便的标注。
这里只标注了client请求协议体，<strong>server reply返回的消息格式相同</strong>。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">//Message</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">80</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 10000000 00000001 首位1标识为strict binary protocol, 其余15位标识版本号</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 无用字节</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// message type消息类型 1：CALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> 0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//  方法名长度 11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">67</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">65</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">74</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">55</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">73</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">65</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">72</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">49</span><span class="token plain"> 6e </span><span class="token number" style="color:hsl(29, 54%, 61%)">66</span><span class="token plain"> 6f </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 方法名：getUserInfo</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// seq id顺序id，client用这个号去处理消息的失序响应</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">//Struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0c </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：T_STRUCT</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 类型: T_STOP</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0c </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：T_STRUCT</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">08</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：I32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// int32值=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">08</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：I32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">02</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">02</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// int32值=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：BINARY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">03</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field id: 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">04</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// BINARY field会带length，为4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">74</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">65</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">73</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">74</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//string值为test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0d </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：MAP</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">04</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//field id: 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//key type: BINARY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">0b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//value type: BINARY</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//map的item数，该例子为1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//length：1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">6b </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//值为 k</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//value length：1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">76</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// 值为 v</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">02</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">// field类型：BOOL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">05</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//field id: 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//值为FALSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//T_STOP 标识STRUCT结束</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">00</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 40%)">//T_STOP 标识整体数据结束</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="协议格式">协议格式<a href="#协议格式" class="hash-link" aria-label="Direct link to 协议格式" title="Direct link to 协议格式">​</a></h4>
<p><img loading="lazy" alt="img.png" src="/assets/images/strict_binary_protocol-e8c5a4ec5066a2ef4a41f8684f7b4a3a.png" width="713" height="483" class="img_zKyM"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="1-协议头">1. 协议头<a href="#1-协议头" class="hash-link" aria-label="Direct link to 1. 协议头" title="Direct link to 1. 协议头">​</a></h5>
<p>分为这四种消息类型</p>
<ul>
<li><em>Call</em>: 1 client发送的消息类型，指代需要响应的消息。</li>
<li><em>Reply</em>: 2  server回复响应的消息。</li>
<li><em>Exception</em>: 3 server异常消息。</li>
<li><em>Oneway</em>: 4  client发送的单向消息，不需要返回。</li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="2-协议体">2. 协议体<a href="#2-协议体" class="hash-link" aria-label="Direct link to 2. 协议体" title="Direct link to 2. 协议体">​</a></h5>
<p><img loading="lazy" alt="img.png" src="/assets/images/binary_protocol_body-905212976e488df3563f01d7bb2c9a00.png" width="1163" height="363" class="img_zKyM"></p>
<ul>
<li>一般定长数据：i32、i64、BOOL等，采用TV模式，字段类型（1字节）+ field id（2字节）+ 值</li>
<li>变长数据：STRUCT、BINARY、MAP、LIST、SET等，采用TLV模式，字段类型（1字节）+ field id（2字节）+ field length (4字节) + 值</li>
</ul>
<p>定长数据类型</p>
<table><thead><tr><th style="text-align:center">数据类型</th><th style="text-align:center">字段类型（1个字节）</th><th style="text-align:center">类型尺寸（单位：字节）</th></tr></thead><tbody><tr><td style="text-align:center">bool</td><td style="text-align:center">2</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">byte</td><td style="text-align:center">3</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">double</td><td style="text-align:center">4</td><td style="text-align:center">8</td></tr><tr><td style="text-align:center">i16</td><td style="text-align:center">6</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">i32</td><td style="text-align:center">8</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">i64</td><td style="text-align:center">10</td><td style="text-align:center">8</td></tr></tbody></table>
<p>变长数据类型</p>
<table><thead><tr><th style="text-align:center">数据类型</th><th style="text-align:center">字段类型（1个字节）</th><th style="text-align:center">类型尺寸（长度 + 值）</th></tr></thead><tbody><tr><td style="text-align:center">string</td><td style="text-align:center">11</td><td style="text-align:center">4 + N</td></tr><tr><td style="text-align:center">struct</td><td style="text-align:center">12</td><td style="text-align:center">嵌套数据 + 1个字节停止符STOP（00）</td></tr><tr><td style="text-align:center">map</td><td style="text-align:center">13</td><td style="text-align:center">1 + 1 + 4 + n*(k+v)</td></tr><tr><td style="text-align:center">set</td><td style="text-align:center">14</td><td style="text-align:center">1 + 4 + N 【val类型 + item数 + 值】</td></tr><tr><td style="text-align:center">list</td><td style="text-align:center">15</td><td style="text-align:center">1 + 4 + N 【val类型 + item数 + 值】</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="老non-strictbinary协议">老（non-strict）Binary协议<a href="#老non-strictbinary协议" class="hash-link" aria-label="Direct link to 老（non-strict）Binary协议" title="Direct link to 老（non-strict）Binary协议">​</a></h3>
<p><img loading="lazy" alt="img.png" src="/assets/images/non-strict-binary-protocol-89591d96fc71ee77be46584901dd96ea.png" width="633" height="403" class="img_zKyM">
字段分析同上。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="compact协议">Compact协议<a href="#compact协议" class="hash-link" aria-label="Direct link to Compact协议" title="Direct link to Compact协议">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="协议格式-1">协议格式<a href="#协议格式-1" class="hash-link" aria-label="Direct link to 协议格式" title="Direct link to 协议格式">​</a></h4>
<p><img loading="lazy" alt="img.png" src="/assets/images/compact-protocol-2578f8f409a8e41e1f183f934efa565c.png" width="633" height="393" class="img_zKyM"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="1-协议头-1">1. 协议头<a href="#1-协议头-1" class="hash-link" aria-label="Direct link to 1. 协议头" title="Direct link to 1. 协议头">​</a></h5>
<p>对比Binary协 议，将消息类型和版本做了压缩，头字段排列做了优化。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="2-协议体-1">2. 协议体<a href="#2-协议体-1" class="hash-link" aria-label="Direct link to 2. 协议体" title="Direct link to 2. 协议体">​</a></h5>
<p>协议体的压缩主要是通过<code>zigzag</code>和<code>var int</code>（protobuf也用到这两算法去做压缩），对<strong>数字类型</strong>和变长字段的<strong>length头</strong>做压缩。</p>
<p><strong>Zigzag</strong></p>
<p>作用：能够将有符号数压缩为无符号整数。从而减少存储和传输空间。<br>
<!-- -->int32算法：<code>(n &lt;&lt; 1) ^ (n &gt;&gt; 31)</code><br>
<!-- -->举例：处理整数 1和-1。</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">原始：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000001</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">左移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000010</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">右移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">31</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">异或：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000010</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">原始：</span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">左移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111110</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">右移位n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">31</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">11111111</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">异或：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000001</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>经过编码后，-1转换为无符号整数，方便压缩。</p>
<p><strong>Var int</strong><br>
<!-- -->作用：能够将正整数压缩字节数，结合zigzag能够减少存储和传输空间。<br>
<!-- -->例子：转换数字123456 -&gt; 结果10111001 01100000</p>
<div class="language-javascript codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-javascript codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token comment" style="color:hsl(220, 10%, 40%)">//算法：复制自TCompactProtocol</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">static</span><span class="token plain"> byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">toVarint32</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token parameter">int n</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> i32buf </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">new</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token number" style="color:hsl(29, 54%, 61%)">5</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">int idx </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token boolean" style="color:hsl(29, 54%, 61%)">true</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">~</span><span class="token number" style="color:hsl(29, 54%, 61%)">0x7F</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">i32buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token plain">idx</span><span class="token operator" style="color:hsl(207, 82%, 66%)">++</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain">n</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">// writeByteDirect((byte)n);</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">break</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">// return;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">i32buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">[</span><span class="token plain">idx</span><span class="token operator" style="color:hsl(207, 82%, 66%)">++</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">byte</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0x7F</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">|</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">0x80</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 40%)">// writeByteDirect((byte)((n &amp; 0x7F) | 0x80));</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">n </span><span class="token operator" style="color:hsl(207, 82%, 66%)">&gt;&gt;&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">7</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:hsl(286, 60%, 67%)">return</span><span class="token plain"> i32buf</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">数字</span><span class="token number" style="color:hsl(29, 54%, 61%)">123456</span><span class="token plain">：</span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00000000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00110000</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">00111001</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">1</span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">次循环</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token number" style="color:hsl(29, 54%, 61%)">10111001</span><span class="token plain">  </span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token number" style="color:hsl(29, 54%, 61%)">2</span><span class="token literal-property property" style="color:hsl(355, 65%, 65%)">次循环</span><span class="token operator" style="color:hsl(207, 82%, 66%)">:</span><span class="token number" style="color:hsl(29, 54%, 61%)">10111001</span><span class="token plain"> </span><span class="token number" style="color:hsl(29, 54%, 61%)">01100000</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="img.png" src="/assets/images/varint-4d9712cd1e3954532b16638b364b6fe5.png" width="400" height="247" class="img_zKyM"></p>
<p><strong>需要注意</strong>：compact协议的对小数值数字，压缩能力好，但是对于大数，压缩能力有限。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="json协议">JSON协议<a href="#json协议" class="hash-link" aria-label="Direct link to JSON协议" title="Direct link to JSON协议">​</a></h3>
<p>json协议编码在Thrift不常用且不建议用，这里不打算说。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_wgfK" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2>
<p>[1]<a href="https://en.wikipedia.org/wiki/Apache_Thrift" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Apache_Thrift</a><br>
<!-- -->[2]<a href="https://thrift.apache.org/docs/concepts.html" target="_blank" rel="noopener noreferrer">https://thrift.apache.org/docs/concepts.html</a><br>
<!-- -->[3]<a href="https://developer.aliyun.com/article/643859" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/article/643859</a><br>
<!-- -->[4]Thrift spec <span style="display:inline-flex;gap:0.25rem"><span></span><a href="https://github.com/apache/thrift/blob/master/doc/specs/thrift-rpc.md" target="_blank" rel="noopener noreferrer">https://github.com/apache/thrift/blob/master/doc/specs/thrift-rpc.md</a></span><br>
<!-- -->[5]<span style="display:inline-flex;gap:0.25rem"><span></span><a href="https://github.com/apache/thrift/blob/master/doc/specs/thrift-binary-protocol.md" target="_blank" rel="noopener noreferrer">https://github.com/apache/thrift/blob/master/doc/specs/thrift-binary-protocol.md</a></span><br>
<!-- -->[6]<a href="https://zhuanlan.zhihu.com/p/476213759" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/476213759</a><br>
<!-- -->[7]<a href="https://www.linux88.com/zigzag/" target="_blank" rel="noopener noreferrer">https://www.linux88.com/zigzag/</a></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_CYj5"></footer></article><div class="margin-bottom--md"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/article/tea-and-wink"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">茶饮和酒饮的分类</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/article/sentinel-core"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Sentinel core原理分析</div></a></nav></div><div>Loading Comments...</div><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_prlU" type="button"></button></main><div class="col col--2"><div class="tableOfContents_jeP5 thin-scrollbar" style="opacity:0;transform:translateX(100px) translateZ(0)"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#组件职责和传输" class="table-of-contents__link toc-highlight">组件职责和传输</a></li><li><a href="#协议分析" class="table-of-contents__link toc-highlight">协议分析</a><ul><li><a href="#strict-binary协议" class="table-of-contents__link toc-highlight">Strict Binary协议</a><ul><li><a href="#分析字节码" class="table-of-contents__link toc-highlight">分析字节码</a></li><li><a href="#协议格式" class="table-of-contents__link toc-highlight">协议格式</a></li></ul></li><li><a href="#老non-strictbinary协议" class="table-of-contents__link toc-highlight"> 老（non-strict）Binary协议</a></li><li><a href="#compact协议" class="table-of-contents__link toc-highlight">Compact协议</a><ul><li><a href="#协议格式-1" class="table-of-contents__link toc-highlight">协议格式</a></li></ul></li><li><a href="#json协议" class="table-of-contents__link toc-highlight">JSON协议</a></li></ul></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul><hr class="hr_UhE0"><span class="percent_H6RK">0%<!-- --> </span></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">站内</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/collections">合集</a></li></ul></div><div class="col footer__col"><div class="footer__title">联系</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" position="right" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/teaho2015" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_eMB3"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                  <a href="mailto:teaho2015@gmail.com" title="gmail" target="_blank" rel="noreferrer noopener" aria-label="gmail">
                    <img src="https://cdn.simpleicons.org/Gmail#EA4335" alt="Deploys by Netlify" width="25" height="25">
                  </a>
                </li><li class="footer__item">
                  <div style="top:50%;">
                  <img src="https://cdn.simpleicons.org/wechat##07C160" alt="wechat:hotingleong" width="15" height="15"> hotingleong

                  </div>
                </li></ul></div><div class="col footer__col"><div class="footer__title">条款</div><ul class="footer__items clean-list"><li class="footer__item">
                  <a href="https://www.netlify.com" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                    <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51">
                  </a>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <p>Copyright © Tea's Blog 2016-2025.All rights reserved. My works are licensed under CC BY-NC-SA 4.0 .</p>
        </div></div></div></footer></div>
</body>
</html>